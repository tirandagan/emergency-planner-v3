<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session c988f461-7e83-4e41-9704-f80629593408 (2025-12-09 02:39Z) -->

# General app pages (2025-12-09 02:39Z)

_**User (2025-12-09 02:39Z)**_

@ai_docs/prep_templates/05_generate_app_pages_and_functionality.md  



always refer to @ai_docs/prep/master_idea.md 



We already have a lot of existing code implementing the backend admin function that I don't want to break. However all the frontend has to be rewritten so assume you are creating the app as new and remember that database structure and admin functions (everything in the admin menu) exist so we will need to carefully build on top of it.

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user is asking me to use the template `05_generate_app_pages_and_functionality.md` to generate an app pages and functionality blueprint based on their `master_idea.md`. 

Key constraints:
1. Backend admin functions already exist - don't want to break them
2. Frontend needs to be completely rewritten
3. Database structure exists
4. Admin functions (everything in admin menu) exist
5. Need to carefully build on top of existing infrastructure

The template tells me to follow a structured process:
- Step 0: Analyze Master Idea & Template Context
- Step 1: Universal Foundation + Core Pages
- Step 2: Smart Navigation Structure
- Step 3: Page Functionality Mapping
- Step 4: Next.js Routes & Layout Groups
- Step 5: Business Model Integration
- Step 6: Final Validation & Refinement

From the master idea document, I can see:
- This is a disaster preparedness planning app
- Template type: This appears to be a "rag-saas" (RAG-based SaaS) given the AI generation features
- Business model: Freemium with 3 tiers (Free, Basic $9.99/mo, Pro $49.99/mo) + marketplace commissions
- Multiple user types: Preppers (3 tiers), Vendors, Influencers, Service Providers, Store Administrators
- Core functionality: AI survival plan generation â†’ Bundle recommendations â†’ Customization â†’ Purchase tracking
- Currently in Phase 1: Core MVP - Bundle Marketplace

I should start with Step 0, analyzing their master idea and then proceed through the steps systematically.</details></think>

---

I'll guide you through creating a complete App Pages & Functionality Blueprint based on your Emergency Planner master idea. Since you have existing backend/admin infrastructure, I'll design the frontend user experience to integrate seamlessly with what you've built.

---

### Step 0 â€“ Analyze Master Idea & Template Context

**Analysis Complete**

I can see you're building a sophisticated disaster preparedness platform with:

**Core Functionality:** AI-powered survival plan generation â†’ Curated bundle recommendations â†’ Bundle customization â†’ Purchase tracking and inventory management

**Template Type:** RAG-SaaS (AI generation with semantic search/matching)

**Business Model:** Freemium subscription (Free, Basic $9.99/mo, Pro $49.99/mo) + marketplace commissions

**User Roles:**
- Preppers (3 tiers: Novice, Serious, High-Value)
- Store Administrators (existing backend - preserve!)
- Vendors, Influencers, Service Providers (Phase 2+)

**Current Phase:** Phase 1 MVP - Bundle Marketplace

**Existing Infrastructure to Preserve:**
- Database schema and admin backend functions
- Bundle creation/management system
- Product catalog and master item resolution
- Vendor/supplier tracking
- Mission report CRUD operations
- AI plan generation engine

---

### Step 1 â€“ Universal Foundation + Core Pages

Perfect! I'll create your complete page structure that builds on your existing backend while providing a fresh, user-focused frontend experience.

**Purpose** â€“ Generate your complete page foundation that makes your preparedness platform concrete and actionable for users at every tier.

**My Analysis**

Based on your master idea, you're building a multi-tier preparedness platform where users progress from "completely overwhelmed beginner" â†’ "AI-guided plan generation" â†’ "curated bundle selection" â†’ "inventory tracking and network building". The frontend needs to support this journey while your existing admin backend manages the marketplace infrastructure.

**Smart Recommendations**
- âœ… **Universal SaaS Foundation** - Auth, legal, responsive design (every SaaS needs these)
- âœ… **User-Centric Core Pages** - Focus on prepper journey (plan â†’ bundles â†’ inventory â†’ readiness)
- âœ… **Progressive Feature Disclosure** - Free tier sees everything, upgrade prompts appear contextually
- âœ… **Admin Layout Group** - Separate (admin) routes preserve your existing backend functionality
- âœ… **Tier-Based Access Gates** - Soft gates with clear upgrade value propositions
- âš ï¸ **Phase 1 Scope Only** - Vendor/Influencer portals deferred to Phase 2
- âŒ **Unnecessary Duplication** - Don't rebuild admin functions, just create user-facing frontend

**AI Draft (editable)**

**ğŸŒ Universal Foundation (Auto-Included)**

**Public Marketing**
- **Landing Page** (Hero â†’ Problem Statement â†’ How It Works â†’ Features by Tier â†’ Pricing â†’ Trust Signals â†’ FAQ â†’ CTA)
- **Privacy Policy** (Legal requirement, GDPR compliance)
- **Terms of Service** (Legal requirement)
- **Cookie Policy** (GDPR compliance)

**Authentication Flow**
- Login (`/auth/login`)
- Sign Up (`/auth/sign-up`)
- Forgot Password (`/auth/forgot-password`)
- Sign Up Success (`/auth/sign-up-success`)

---

**âš¡ Core Application (User-Facing Prepper Journey)**

**Mission Planning & Generation**
- **Plan Generator** - Multi-step wizard for creating new survival plans
  - Scenario selection (all 6 scenarios available to all tiers)
  - Personnel configuration (family members, ages, medical needs)
  - Location input (for context-specific recommendations)
  - AI generation trigger and progress
  
- **Mission Dashboard** - Central hub showing all saved plans
  - Plan cards with scenario badges, readiness scores, last updated dates
  - Quick actions: View, Edit, Delete, Share (tier-gated)
  - "Create New Plan" prominent CTA
  - Free tier: Shows "1/1 saved" with upgrade prompt on 2nd save attempt

**Bundle Selection & Customization**
- **Bundle Recommendations** - AI-curated bundles for active plan
  - 3-5 recommended bundles per category
  - Bundle cards: image, name, price, item count, scenario tags
  - Filter by budget tier, duration, family size
  - "View Details" â†’ Bundle detail page
  
- **Bundle Details** - Deep dive into specific bundle
  - Master items list with photos, names, quantities, prices
  - Customization interface (swap alternatives, remove optional items)
  - Real-time price calculation
  - Purchase action buttons (mark as Purchased/In Cart/Wishlist)
  - Customization rules enforced (locked items, swappable items, removable items)

**Inventory & Readiness**
- **Inventory Tracker** - What you own vs. what you need
  - Visual breakdown by category (shelter, water, food, medical, etc.)
  - Mark items as Owned/Needed/Ordered
  - Spending tracker (Basic+ only: historical spending over time)
  - Expiration tracking (Phase 2/Pro: MRE dates, batteries, medications)
  
- **Readiness Dashboard** - Your preparedness score and progress
  - Overall readiness score (0-100)
  - Granular breakdown by scenario (Phase 1 enhancement)
  - Visual progress charts
  - Skills assessment gaps
  - Actionable next steps

**Supporting Features**
- **Evacuation Routes** - Interactive maps with waypoints
  - Map view with recommended routes
  - Waypoint details and instructions
  - Custom waypoint editing (Pro tier)
  
- **Survival Simulation** - Day-by-day scenario walkthrough
  - Narrative simulation logs
  - Decision points and outcomes
  - Skill requirements highlighted
  
- **Skills Training** - Resource library for learning critical skills
  - YouTube video embeds
  - Article links with summaries
  - PDF downloads (first aid guides, survival manuals)
  - Organized by skill category

**Community & Coordination**
- **Plan Sharing** - Collaborate with family/friends (Basic+ only)
  - Share via email/link (up to 5 people Basic, 50 people Pro)
  - Network dashboard (Pro tier: group coordination view)
  - Emergency contact protocols
  
- **Expert Access** - Calls and webinars (tier-specific)
  - Founder group calls calendar (Basic: monthly, Pro: quarterly 1-on-1)
  - Expert group calls calendar (Pro: monthly rotating experts)
  - Recorded webinar library (Pro tier)
  - Pay-per-call option for Free tier ($100-200)

**User Account**
- **Unified Profile Dashboard** - Account, subscription, usage, billing
  - Profile settings (personal info, location, preferences)
  - Subscription management (current plan, upgrade/downgrade, payment method)
  - Usage tracking (plans created, bundles saved, readiness trends)
  - Billing history and invoices
  - Link to Stripe customer portal for complex billing features
  - Email preferences and notifications

---

**ğŸ‘‘ Admin Section (Existing Backend - Preserve Structure)**

**Bundle Management**
- Create/edit bundles (metadata, scenario tags, budget tiers)
- Add master items with default products
- Set customization rules per item
- Preview bundles (default and customization modes)

**Product & Vendor Management**
- Master item catalog management
- Vendor/supplier information tracking
- Product performance analytics
- Affiliate link management

**User Management**
- View users by tier and subscription status
- Flag high-value Pro users for outreach
- Send targeted bulk emails to segments
- AI-driven email customization tool

**Analytics & Reporting**
- Platform analytics (users, MRR, churn, conversions)
- Bundle performance (impressions, selections, customization patterns)
- Revenue tracking (subscriptions, affiliate commissions)
- User behavior insights

**Call Scheduling**
- Founder call scheduling (Basic tier)
- Expert call scheduling (Pro tier)
- 1-on-1 call management (Pro tier)
- Calendar integration

**Your Validation**
1. Does this structure support your users' journey from overwhelmed â†’ prepared?
2. Does the admin section alignment preserve your existing backend functionality?
3. Any critical pages missing for Phase 1 MVP?

---

_**User (2025-12-09 02:39Z)**_

1. yes. 

2. functionality of admin functions (including how we tag items, edit them, use of popup modal windows, etc - all need to remain. However the look and feel should be made to conform to the new site look and feel defined in @ai_docs/prep/ui_theme.md 

3. not that i can think of

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
Great! The user has confirmed:
1. The structure supports the user journey
2. Admin functionality (tagging, editing, modals, etc.) must remain but should be restyled to match the Trust Blue theme
3. No critical pages missing

Now I should proceed to Step 2 - Smart Navigation Structure. I need to design a navigation that:
- Puts core functionality (plan generation â†’ bundles â†’ inventory â†’ readiness) front and center
- Uses the Trust Blue theme
- Has mobile-responsive sidebar
- Role-based access for admin features
- Clear, action-oriented labels
- Splits admin navigation into specific nav items (not generic "Admin")</details></think>

---

Perfect! Moving forward with your feedback - admin functionality preserved with Trust Blue theme styling applied.

---

### Step 2 â€“ Smart Navigation Structure

Excellent! Now I'll create your navigation structure that guides users through their preparedness journey while keeping admin functions organized and accessible.

**Purpose** â€“ Design navigation that makes your core value proposition (AI plans â†’ Curated bundles â†’ Inventory tracking â†’ Readiness improvement) immediately accessible and intuitive.

**My Analysis**

Your app's main user journey is: **Overwhelmed â†’ Generate Plan â†’ Select Bundles â†’ Track Inventory â†’ Improve Readiness**. Navigation should support this linear flow while allowing quick access to supporting features (maps, simulations, skills, expert calls). Admin functions stay separate but styled consistently with Trust Blue theme.

**Smart Recommendations**
- âœ… **Mobile-First Responsive** - Collapsible sidebar with hamburger menu, works on all devices
- âœ… **Value-Prop Priority** - "Create Plan" is the hero action, followed by core features
- âœ… **Split Admin Navigation** - Individual items (Bundle Manager, Product Catalog, User Analytics, Email Tools) vs generic "Admin"
- âœ… **Role-Based Access** - Admin features only show for admin users
- âœ… **User-Friendly Labels** - Action-oriented ("Create Plan" not "Plan Generator")
- âœ… **Trust Blue Accents** - Active states, hover effects, and icons use HSL(220, 85%, 55%)
- âŒ **Navigation Bloat** - Keeping it clean, focused on Phase 1 MVP scope

**AI Draft (editable)**

**ğŸ“± Main Navigation (Responsive Sidebar)**

**Top Section - Primary Actions**
- **Create Plan** (Hero CTA button - prominent Trust Blue background)
  - Icon: Sparkles/AI wand
  - Always visible, launches multi-step plan generator wizard
  
**Core Features Section**
- **My Plans** (Dashboard homepage)
  - Icon: Folder/Document grid
  - Shows all saved mission reports with readiness scores
  - Badge: Plan count for Free tier "1/1"
  
- **Bundles** (Bundle recommendations & customization)
  - Icon: Shopping bag/Package
  - Access AI-recommended bundles for active plan
  - Badge: Number of bundles in cart/wishlist
  
- **Inventory** (Track owned items)
  - Icon: Checklist/Clipboard
  - Mark items as owned, track spending (Basic+ shows history)
  - Badge: Percentage of readiness
  
- **Readiness** (Score dashboard)
  - Icon: Shield with checkmark
  - Overall score + granular breakdown by scenario
  - Visual progress charts

**Supporting Features Section** (Collapsed by default on mobile)
- **Maps & Routes** (Evacuation planning)
  - Icon: Map pin/Route
  - Interactive maps with waypoints
  
- **Simulation** (Day-by-day scenario walkthrough)
  - Icon: Play button/Timeline
  - Narrative simulation logs
  
- **Skills Training** (Resource library)
  - Icon: Graduation cap/Book
  - Videos, articles, PDFs organized by category
  
- **Expert Calls** (Tier-specific access)
  - Icon: Video camera/Calendar
  - Founder calls (Basic+), Expert calls (Pro), 1-on-1 scheduling (Pro)
  - Badge: Upcoming call count

**Bottom Section - Account & Admin**
- **Profile** (Account settings & subscription)
  - Icon: User avatar/Settings
  - Unified dashboard: account + usage + billing
  
- **Divider Line** (Visual separation for admin)

**Admin Section** (Role-Based Visibility - Only for Admin Users)
- **Bundle Manager** 
  - Icon: Package with edit icon
  - Create/edit bundles, preview, set customization rules
  
- **Product Catalog**
  - Icon: Database/Grid
  - Master items, vendor tracking, product analytics
  
- **User Analytics**
  - Icon: Chart bar/Dashboard
  - User tiers, MRR, churn, platform metrics
  
- **Email Tools**
  - Icon: Mail/Megaphone
  - Bulk emails, AI customization, segment targeting
  
- **Call Scheduling**
  - Icon: Calendar clock
  - Manage founder/expert/1-on-1 calls

---

**ğŸ”’ Role-Based Access**

**All Users (Free, Basic, Pro):**
- Create Plan, My Plans, Bundles, Inventory, Readiness
- Maps & Routes, Simulation, Skills Training
- Profile

**Basic Tier Users:**
- Expert Calls (founder group calls only)

**Pro Tier Users:**
- Expert Calls (all expert access + 1-on-1)

**Admin Users Only:**
- Bundle Manager, Product Catalog, User Analytics, Email Tools, Call Scheduling

---

**ğŸ“± Mobile Navigation Behavior**

**Collapsed State (Default on mobile):**
- Hamburger menu icon (top left)
- "Create Plan" sticky CTA button visible
- Current page title in header

**Expanded State (Tapped hamburger):**
- Slide-out sidebar overlay (full height)
- All navigation items visible
- Tap outside or X button to close
- Trust Blue active state on current page

**Desktop/Tablet (â‰¥768px):**
- Persistent sidebar (left side, ~240px width)
- Hover effects with Trust Blue accent
- Active page highlighted with Trust Blue background
- Collapsible sections (Supporting Features can collapse)

---

**ğŸ¨ Trust Blue Theme Application**

**Active Navigation Item:**
- Background: `bg-primary/10` (Trust Blue at 10% opacity)
- Text: `text-primary` (HSL 220, 85%, 55%)
- Border left: 3px solid Trust Blue

**Hover State:**
- Background: `bg-muted`
- Slight scale animation (1.02x)

**Icons:**
- Default: `text-muted-foreground`
- Active: `text-primary`
- Size: 20px (consistent throughout)

**Badges (Plan count, readiness %):**
- Background: `bg-primary`
- Text: `text-primary-foreground`
- Rounded pill shape

**Create Plan CTA:**
- Background: `bg-primary`
- Text: `text-primary-foreground`
- Hover: Slightly darker shade + scale
- Icon: AI sparkles (animated on hover)

---

**Your Validation**
1. Does this navigation support your users' main workflow (plan â†’ bundles â†’ inventory â†’ readiness)?
2. Are the admin functions organized logically with clear separation?
3. Any adjustments needed for mobile experience or feature prioritization?

---

_**User (2025-12-09 02:39Z)**_

1. i like it.

2. what about supplier/vendor management? What about managing categories? (currently we have a separate admin function for categories, but perhaps there is a way to consolidate it in the product catalog

3. let's make sure we accomodate small screens, tablets (mobile medium size) and desktop (wide and extra wide). The larger the screen the more dense our information can be since it is spread out on a larger real estate

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
Great feedback! The user wants to:
1. Add vendor/supplier management to admin nav
2. Consider consolidating categories into product catalog
3. Ensure responsive design works across all screen sizes with appropriate information density

Let me refine the navigation structure and add responsive breakpoint guidance.</details></think>

---

Perfect feedback! Let me refine the navigation and add comprehensive responsive design guidance.

---

### Step 2 (Refined) â€“ Smart Navigation Structure

**Updates Based on Your Feedback:**
- âœ… Added **Vendor Management** as separate admin nav item
- âœ… **Consolidated Categories** into Product Catalog (tab-based interface)
- âœ… **Four Responsive Breakpoints** with density scaling (mobile â†’ tablet â†’ desktop â†’ wide)

---

**ğŸ“± Main Navigation (Responsive Sidebar) - UPDATED**

**Top Section - Primary Actions**
- **Create Plan** (Hero CTA button - prominent Trust Blue background)
  - Icon: Sparkles/AI wand
  - Always visible, launches multi-step plan generator wizard
  
**Core Features Section**
- **My Plans** (Dashboard homepage)
- **Bundles** (Bundle recommendations & customization)
- **Inventory** (Track owned items)
- **Readiness** (Score dashboard)

**Supporting Features Section** (Collapsed by default on mobile)
- **Maps & Routes** (Evacuation planning)
- **Simulation** (Day-by-day scenario walkthrough)
- **Skills Training** (Resource library)
- **Expert Calls** (Tier-specific access)

**Bottom Section - Account & Admin**
- **Profile** (Account settings & subscription)
- **Divider Line** (Visual separation for admin)

**Admin Section** (Role-Based Visibility - Only for Admin Users)
- **Bundle Manager** 
  - Create/edit bundles, preview, set customization rules
  
- **Product Catalog** â­ UPDATED
  - Tab 1: Master Items (item list with inline editing)
  - Tab 2: Categories (category management consolidated here)
  - Tab 3: Analytics (product performance metrics)
  
- **Vendor Management** â­ NEW
  - Vendor/supplier directory
  - Contact info, payment terms, product associations
  - Vendor performance tracking
  
- **User Analytics**
  - User tiers, MRR, churn, platform metrics
  
- **Email Tools**
  - Bulk emails, AI customization, segment targeting
  
- **Call Scheduling**
  - Manage founder/expert/1-on-1 calls

---

**ğŸ“ Responsive Design Strategy - Four Breakpoints**

### 1. **Mobile Small** (320px - 639px) - Maximum Simplicity

**Sidebar Behavior:**
- âœ… Hidden by default (hamburger menu)
- âœ… Full-screen overlay when expanded
- âœ… Single column layout everywhere
- âœ… Supporting Features section collapsed by default

**Information Density:**
- âœ… **Cards:** Full width, stacked vertically
- âœ… **Lists:** 1 item per row, large touch targets (min 44px height)
- âœ… **Tables:** Convert to card layouts (no horizontal scrolling)
- âœ… **Forms:** Full width inputs, stacked labels
- âœ… **Images:** Hero images at 16:9 aspect ratio

**Navigation Width:** Full screen overlay (100vw)

**Typography:**
- Headings: H1 2rem, H2 1.5rem, H3 1.25rem
- Body: 0.875rem (14px) base
- Buttons: Full width with large text

**Example - Bundle Cards (Mobile Small):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Bundle Image 16:9]    â”‚
â”‚                         â”‚
â”‚  Bundle Name            â”‚
â”‚  $299                   â”‚
â”‚  â­â­â­â­â­             â”‚
â”‚  24 items               â”‚
â”‚                         â”‚
â”‚  [View Details Button]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. **Tablet/Mobile Large** (640px - 1023px) - Moderate Density

**Sidebar Behavior:**
- âœ… Collapsible sidebar (not full overlay)
- âœ… Toggles to ~60px icon-only mode when collapsed
- âœ… Expands to ~240px full width when open
- âœ… Swipe gesture support for toggle

**Information Density:**
- âœ… **Cards:** 2 columns grid (50% width each)
- âœ… **Lists:** Still 1 item per row, but more compact spacing
- âœ… **Tables:** Show 3-4 key columns, hide secondary data
- âœ… **Forms:** Start using 2-column layouts for related fields
- âœ… **Images:** Maintain 16:9 but smaller

**Navigation Width:** 240px expanded, 60px collapsed (icon-only)

**Typography:**
- Headings: H1 2.25rem, H2 1.75rem, H3 1.5rem
- Body: 0.9375rem (15px) base
- Buttons: Inline buttons start appearing

**Example - Bundle Cards (Tablet):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Image 16:9]  â”‚ â”‚ [Image 16:9]  â”‚
â”‚               â”‚ â”‚               â”‚
â”‚ Bundle Name   â”‚ â”‚ Bundle Name   â”‚
â”‚ $299 â€¢ 24 itm â”‚ â”‚ $450 â€¢ 35 itm â”‚
â”‚ â­â­â­â­â­   â”‚ â”‚ â­â­â­â­      â”‚
â”‚ [View Button] â”‚ â”‚ [View Button] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. **Desktop** (1024px - 1535px) - Comfortable Density

**Sidebar Behavior:**
- âœ… Persistent sidebar (always visible at 240px)
- âœ… Hover effects and smooth transitions
- âœ… Supporting Features section expanded by default
- âœ… Subtle shadow/border separating content area

**Information Density:**
- âœ… **Cards:** 3 columns grid (33% width each)
- âœ… **Lists:** Can show 2-column layouts for comparison
- âœ… **Tables:** Full tables with 6-8 columns visible
- âœ… **Forms:** Multi-column layouts (2-3 columns)
- âœ… **Dashboard:** Side-by-side widgets (2-3 per row)

**Navigation Width:** 240px persistent

**Content Area:** Remaining width (calc(100vw - 240px))

**Typography:**
- Headings: H1 2.5rem, H2 2rem, H3 1.75rem
- Body: 1rem (16px) base
- Buttons: Standard sizing, inline positioning

**Example - Bundle Cards (Desktop):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚[Img 3:2] â”‚ â”‚[Img 3:2] â”‚ â”‚[Img 3:2] â”‚
â”‚          â”‚ â”‚          â”‚ â”‚          â”‚
â”‚Bundle 1  â”‚ â”‚Bundle 2  â”‚ â”‚Bundle 3  â”‚
â”‚$299      â”‚ â”‚$450      â”‚ â”‚$199      â”‚
â”‚24 items  â”‚ â”‚35 items  â”‚ â”‚18 items  â”‚
â”‚â­â­â­â­â­â”‚ â”‚â­â­â­â­   â”‚ â”‚â­â­â­â­â­â”‚
â”‚[Details] â”‚ â”‚[Details] â”‚ â”‚[Details] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. **Wide/Ultra-Wide** (1536px+) - Maximum Density

**Sidebar Behavior:**
- âœ… Persistent sidebar at 280px (slightly wider)
- âœ… Optional secondary sidebar for context (e.g., bundle preview)
- âœ… Dual-pane layouts for admin functions

**Information Density:**
- âœ… **Cards:** 4 columns grid (25% width each)
- âœ… **Lists:** Multi-column comparison views
- âœ… **Tables:** Full tables with 10+ columns, frozen headers
- âœ… **Forms:** 3-4 column layouts with inline validation
- âœ… **Dashboard:** Dense widget grids (3-4 per row)
- âœ… **Admin:** Split-screen editing (list + detail view side-by-side)

**Navigation Width:** 280px persistent

**Content Area:** Max-width container (1600px) centered with padding

**Typography:**
- Headings: H1 3rem, H2 2.25rem, H3 2rem
- Body: 1rem (16px) base
- Buttons: Grouped inline with icons

**Example - Bundle Cards (Wide Desktop):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚[3:2]   â”‚ â”‚[3:2]   â”‚ â”‚[3:2]   â”‚ â”‚[3:2]   â”‚
â”‚        â”‚ â”‚        â”‚ â”‚        â”‚ â”‚        â”‚
â”‚Bundle 1â”‚ â”‚Bundle 2â”‚ â”‚Bundle 3â”‚ â”‚Bundle 4â”‚
â”‚$299    â”‚ â”‚$450    â”‚ â”‚$199    â”‚ â”‚$599    â”‚
â”‚24 itemsâ”‚ â”‚35 itemsâ”‚ â”‚18 itemsâ”‚ â”‚42 itemsâ”‚
â”‚â­â­â­â­â­â”‚ â”‚â­â­â­â­ â”‚ â”‚â­â­â­â­â­â”‚ â”‚â­â­â­â­â­â”‚
â”‚[View]  â”‚ â”‚[View]  â”‚ â”‚[View]  â”‚ â”‚[View]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Example - Admin Product Catalog (Wide Desktop Split View):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Master Items List   â”‚ Edit Item Details    â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”   â”‚
â”‚ â˜‘ Water Filter      â”‚ Name: Water Filter   â”‚
â”‚   First Aid Kit     â”‚ Category: Water      â”‚
â”‚   MRE Pack          â”‚ Price: $79.99        â”‚
â”‚   Flashlight        â”‚ Vendor: AquaGear     â”‚
â”‚   ...more items     â”‚ [Image Preview]      â”‚
â”‚                     â”‚ [Save] [Cancel]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ¨ Responsive Navigation Visual States**

**Mobile (< 640px):**
```
Collapsed:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â˜°  beprepared   â”‚ â† Header with hamburger
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ [Content Area]  â”‚
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Expanded:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Full Sidebar]  â”‚ â† Full screen overlay
â”‚ â€¢ Create Plan   â”‚
â”‚ â€¢ My Plans      â”‚
â”‚ â€¢ Bundles       â”‚
â”‚ ...             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Tablet (640px - 1023px):**
```
Collapsed:
â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”‚â”‚ [Content]   â”‚ â† 60px icon-only sidebar
â”‚â˜°â”‚â”‚             â”‚
â”‚ â”‚â”‚             â”‚
â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Expanded:
â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nav  â”‚ Content â”‚ â† 240px full sidebar
â”‚â€¢ Planâ”‚         â”‚
â”‚â€¢ Bundâ”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Desktop (1024px+):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nav      â”‚ Content Area   â”‚ â† 240px persistent
â”‚ â€¢ Plan   â”‚                â”‚
â”‚ â€¢ Bundle â”‚                â”‚
â”‚ â€¢ Invent â”‚                â”‚
â”‚ ...      â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Wide Desktop (1536px+):**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Nav        â”‚ Max-Width Content      â”‚ â† 280px persistent
â”‚ (280px)    â”‚ (1600px max centered)  â”‚
â”‚ â€¢ Create   â”‚                        â”‚
â”‚ â€¢ Plans    â”‚    [Dense Grids]       â”‚
â”‚ â€¢ Bundles  â”‚    [Side-by-side]      â”‚
â”‚ ...        â”‚                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**ğŸ¯ Product Catalog Consolidation Strategy**

**Before (Separate Admin Functions):**
- Product Catalog (items only)
- Categories (separate page)

**After (Unified Product Catalog with Tabs):**

**Tab 1: Master Items**
- Item list with search/filter
- Inline editing for quick updates
- Bulk actions (delete, change category, change vendor)
- Mobile: Card view with expand/collapse
- Desktop: Full table with frozen headers
- Wide: Split view (list + detail panel)

**Tab 2: Categories** â­ CONSOLIDATED
- Category tree/hierarchy view
- Drag-and-drop reordering
- Edit category names, descriptions, icons
- View item count per category
- Mobile: Accordion list
- Desktop: Tree view with inline editing
- Wide: Split view (tree + category details)

**Tab 3: Analytics**
- Product performance metrics
- Top-selling items, conversion rates
- Revenue by category
- Mobile: Stacked metric cards
- Desktop: Dashboard grid (2-3 columns)
- Wide: Dense dashboard (3-4 columns)

**Benefit:** Single source of truth for all product-related management, reduces navigation complexity, easier to maintain item-category relationships.

---

**Your Validation**
1. Does the consolidated Product Catalog (with Categories tab) work better than separate pages?
2. Is the Vendor Management positioning appropriate in the admin nav?
3. Does the four-breakpoint responsive strategy (mobile â†’ tablet â†’ desktop â†’ wide) give you the density control you need?

---

_**User (2025-12-09 02:39Z)**_

1. this is good - we want simplicity and powerful features "all at your fingertips"

2. yes

3. yes

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
Great! The user has confirmed all three validations for Step 2. Now I should do a brief reflection/segue and move to Step 3 - Page Functionality Mapping.

This is where I need to create dev-ready specifications that deliver their unique value proposition. I should map specific functionality for each page, directly tied to their preparedness platform value proposition and user stories.

Key things to remember:
- Use (Frontend)/(Backend)/(Background Job) indicators
- Value-prop focused - every feature connects to solving users' main problem
- User story driven based on their master idea
- MVP scope - essential features only, mark advanced as "Phase 2"
- Action-oriented clear verb + object bullets
- Default simplicity - search/filter/export typically not MVP unless core
- No generic features - specific to their use case

Their core problem: Decision paralysis from information overload â†’ AI solves by generating location-specific survival strategies with curated bundles

Their value proposition: Build complete disaster readiness plans within minutes using AI that generates bundles with calculated quantities, budget-optimized recommendations

Let me create detailed functionality mapping for each page they need.</details></think>

---

Great! Captured: Navigation structure with consolidated Product Catalog (tabs for Items/Categories/Analytics), separate Vendor Management, and four responsive breakpoints for optimal density scaling.

Next step coming up...

---

### Step 3 â€“ Page Functionality Mapping

Perfect navigation! Now I'll map the specific functionality for each page, directly tied to your value proposition: **transforming 40-60 hours of fragmented research into actionable survival plans within minutes**.

**Purpose** â€“ Create dev-ready specifications that deliver your unique value to preppers at every tier, from overwhelmed novices to high-value users making major investments.

**My Analysis**

Your users come to solve **decision paralysis caused by information overload**. Each page needs to either advance that goal (generate plans â†’ select bundles â†’ track readiness) or support the user journey (maps, skills, expert guidance). I'm mapping functionality that directly serves your core promise: AI-powered preparedness in minutes, not months.

**Smart Recommendations**
- âœ… **Value-Prop Focused** - Every feature connects to solving information overload and decision paralysis
- âœ… **User Story Driven** - Based on your 80 user stories across 3 phases
- âœ… **MVP Scope** - Phase 1 essentials only, mark Phase 2/3 features clearly
- âœ… **Action-Oriented** - Clear verb + object bullets with (Frontend)/(Backend)/(Background Job) indicators
- âœ… **Default Simplicity** - Search/filter only when core to value prop (bundle selection, inventory tracking)
- âœ… **Trust Blue Theme** - All components styled with HSL(220, 85%, 55%) accents
- âŒ **Generic Features** - Skipping anything not specific to preparedness use case

---

**AI Draft (editable)**

## ğŸŒ Universal Pages

### Landing Page (`/`)

**Hero Section** (Frontend)
- Display headline: "Build Complete Disaster Readiness Plans in Minutes, Not Months"
- Show subheadline: "AI-powered survival plans with curated bundles for your location, family size, and budget"
- Render hero CTA button: "Start Your Free Plan" â†’ `/auth/sign-up` (Frontend)
- Display trust signals: User count, plans generated, readiness score improvements (Backend â†’ fetch platform stats)
- Show hero image: Family with emergency supplies (existing `collaboration-planning.png`)

**Problem Statement Section** (Frontend)
- Highlight pain points: 40-60 hours research, $200-500 wasted, 72% lack complete kits
- Show visual comparison: "Before" (overwhelmed by fragmented info) vs "After" (clear actionable plan)

**How It Works Section** (Frontend)
- Display 4-step process with icons:
  1. Answer simple questions (scenarios, family, location)
  2. AI generates personalized survival plan
  3. Get curated bundle recommendations
  4. Track readiness and improve over time
- Show screenshot/mockup of plan generator interface

**Features by Tier Section** (Frontend)
- Render 3-column comparison table: Free vs Basic vs Pro
- Highlight key differentiators: Free (1 saved plan), Basic (unlimited + sharing), Pro (expert access + networks)
- Show upgrade value props: "Save unlimited plans for $9.99/mo" (Basic), "Monthly expert calls included" (Pro)

**Pricing Section** (Frontend)
- Display pricing cards: Free ($0), Basic ($9.99/mo or $99/yr), Pro ($49.99/mo or $499/yr)
- Show annual savings badge: "Save 17% with annual billing"
- Render feature bullets per tier
- Include CTA buttons: "Start Free" â†’ `/auth/sign-up`

**Trust Signals Section** (Frontend)
- Display testimonials (placeholder for Phase 2 real testimonials)
- Show security badges: Secure checkout, data privacy, GDPR compliant
- Render press mentions (when available)

**FAQ Section** (Frontend)
- Display accordion-style Q&A:
  - "How does AI plan generation work?"
  - "What scenarios are covered?"
  - "Can I share plans with family?"
  - "What if I'm already partially prepared?"
  - "How do bundle recommendations work?"
- Expand/collapse functionality (Frontend state management)

**Final CTA Section** (Frontend)
- Show headline: "Start Your Family's Preparedness Journey Today"
- Render prominent CTA: "Create Your Free Plan" â†’ `/auth/sign-up`

---

### Authentication Pages

**Login (`/auth/login`)** (Frontend + Backend)
- Render email/password input fields (Frontend)
- Show "Remember me" checkbox (Frontend)
- Display "Forgot password?" link â†’ `/auth/forgot-password` (Frontend)
- Show OAuth options: Google, Facebook (Phase 2) (Frontend + Backend OAuth flow)
- Handle login submission â†’ verify credentials â†’ create session â†’ redirect to `/dashboard` (Backend)
- Display validation errors inline (Frontend)
- Apply Trust Blue theme to buttons and focus states (Frontend)

**Sign Up (`/auth/sign-up`)** (Frontend + Backend)
- Render email, password, confirm password fields (Frontend)
- Show password strength indicator (Frontend)
- Display terms acceptance checkbox with links to `/privacy`, `/terms` (Frontend)
- Handle sign-up submission â†’ create user account â†’ send verification email â†’ redirect to `/auth/sign-up-success` (Backend)
- Set default tier to "Free" (Backend)
- Create welcome email job â†’ queue background task (Background Job)
- Display validation errors inline (Frontend)

**Forgot Password (`/auth/forgot-password`)** (Frontend + Backend)
- Render email input field (Frontend)
- Handle submission â†’ generate password reset token â†’ send reset email (Backend)
- Show success message: "Check your email for reset link" (Frontend)
- Queue password reset email (Background Job)

**Sign Up Success (`/auth/sign-up-success`)** (Frontend)
- Display confirmation message: "Welcome! Check your email to verify your account" (Frontend)
- Show "Continue to Dashboard" button â†’ `/dashboard` (Frontend)
- Display "Resend verification email" link (Frontend + Backend)

---

## âš¡ Core Application Pages (User-Facing)

### Mission Dashboard (`/dashboard` - Homepage for authenticated users)

**Header Section** (Frontend)
- Display welcome message: "Welcome back, [User Name]" (Backend â†’ fetch user data)
- Show overall readiness score badge: Large circular progress (0-100) with Trust Blue fill (Frontend + Backend)
- Render "Create New Plan" hero CTA button (Frontend)

**Saved Plans Grid** (Frontend + Backend)
- Fetch all mission reports for current user (Backend query)
- Display plan cards in responsive grid (1 col mobile, 2 col tablet, 3 col desktop, 4 col wide)
- Show per card:
  - Plan name/title (editable inline)
  - Scenario badges (colored pills for Natural Disaster, EMP, etc.)
  - Readiness score (small circular progress)
  - Last updated timestamp
  - Quick actions: View, Edit, Delete, Share (tier-gated)
- Render empty state for new users: "Create your first plan to get started" (Frontend)

**Free Tier Save Limit** (Frontend + Backend)
- Show plan count badge: "1/1 Plans Saved" when at limit (Frontend)
- Display upgrade prompt modal when attempting to save 2nd plan: "Upgrade to Basic to save unlimited plans" (Frontend)
- Track save attempts and enforce limit (Backend)

**Plan Card Actions** (Frontend + Backend)
- **View:** Navigate to `/plans/[planId]` (Frontend routing)
- **Edit:** Navigate to `/plans/[planId]/edit` (Frontend routing)
- **Delete:** Show confirmation modal â†’ delete plan from database â†’ refresh grid (Frontend + Backend)
- **Share (Basic+):** Open share modal with email/link options â†’ generate shareable link â†’ send invites (Frontend + Backend)
- **Share (Free):** Show upgrade prompt: "Upgrade to Basic to share with 5 people" (Frontend)

**Readiness Summary Widget** (Frontend + Backend)
- Fetch aggregated readiness data across all plans (Backend)
- Display scenario breakdown: Visual bars showing readiness per scenario (Frontend)
- Show top gaps: "3 critical items missing from water supply" (Frontend + Backend analysis)
- Render "Improve Readiness" CTA â†’ `/readiness` (Frontend)

---

### Plan Generator (`/plans/new` - Multi-step wizard)

**Step 1: Scenario Selection** (Frontend)
- Display all 6 scenarios as selectable cards with icons:
  - Natural Disaster (hurricane, earthquake, flood)
  - EMP/Grid Down
  - Pandemic
  - Nuclear Event
  - Civil Unrest
  - Multi-Year Sustainability
- Allow multiple scenario selection (checkboxes, Trust Blue when selected) (Frontend)
- Show scenario descriptions on hover/tap (Frontend)
- Validate at least 1 scenario selected (Frontend)
- Render "Next Step" button â†’ Step 2 (Frontend)

**Step 2: Personnel Configuration** (Frontend)
- Display "Add Family Member" button (Frontend)
- Show form fields per person:
  - Name (optional, defaults to "Person 1")
  - Age (dropdown or number input)
  - Gender (dropdown: Male, Female, Prefer not to say)
  - Medical conditions (multi-select: Diabetes, Heart condition, Mobility issues, Allergies, None)
  - Special needs (text area for details)
- Allow add/remove family members dynamically (Frontend)
- Show visual count: "Planning for 4 people" (Frontend)
- Validate at least 1 person configured (Frontend)
- Render "Next Step" button â†’ Step 3 (Frontend)

**Step 3: Location & Context** (Frontend + Backend)
- Render location input with autocomplete (Google Places API) (Frontend + Backend)
- Show detected location button: "Use Current Location" (Frontend geolocation API)
- Display location-specific context questions:
  - Home type (House, Apartment, Rural property)
  - Climate zone (auto-detected from location, editable)
  - Existing preparedness level (None, Basic 72-hr kit, Intermediate, Advanced)
  - Budget tier (Tight budget, Moderate, Premium - no shame)
- Validate location entered (Frontend)
- Render "Generate Plan" button â†’ Step 4 (Frontend)

**Step 4: AI Generation Progress** (Frontend + Backend + Background Job)
- Show loading animation with Trust Blue accent (Frontend)
- Display progress messages:
  - "Analyzing your scenarios..."
  - "Calculating supply quantities for 4 people..."
  - "Generating location-specific strategies..."
  - "Matching bundles to your needs..."
- Trigger AI generation job (Backend â†’ Gemini API)
  - Generate survival plan narrative
  - Calculate supply items with quantities
  - Perform semantic matching for bundles (Backend â†’ vector search)
  - Calculate readiness score
  - Generate evacuation routes
  - Create simulation logs
  - Fetch skills training resources
- Poll for completion status (Frontend â†’ Backend API)
- On completion: Save mission report to database â†’ redirect to `/plans/[newPlanId]` (Backend + Frontend)

---

### Plan Details (`/plans/[planId]`)

**Plan Overview Section** (Frontend + Backend)
- Fetch mission report data (Backend query)
- Display plan name (editable inline) (Frontend + Backend update)
- Show scenario badges (colored pills) (Frontend)
- Render readiness score: Large circular progress with Trust Blue (Frontend)
- Display last updated timestamp (Frontend)
- Show action buttons: Edit, Share, Delete, Download PDF (Phase 2) (Frontend)

**Quick Stats Cards** (Frontend + Backend)
- Display metric cards (4 cards responsive grid):
  - Total items needed (count)
  - Total estimated cost (sum)
  - Items owned (count from inventory)
  - Days of supplies (calculated based on items)
- Use Trust Blue accents for icons (Frontend)

**Recommended Bundles Section** (Frontend + Backend)
- Fetch AI-recommended bundles for this plan's scenarios (Backend â†’ bundle matching algorithm)
- Display "Top Bundles for Your Plan" heading (Frontend)
- Render bundle cards in grid (3-5 bundles):
  - Bundle image
  - Bundle name
  - Price
  - Item count
  - Scenario match badges
  - Star rating (future: user ratings)
  - "View Details" button â†’ `/bundles/[bundleId]` (Frontend)
- Show "See All Bundles" link â†’ `/bundles?planId=[planId]` (Frontend)

**Tabs Navigation** (Frontend)
- Render tab bar: Overview (active) | Map & Routes | Simulation | Skills | Contacts (Frontend)
- Switch active tab on click (Frontend state)

**Tab: Overview (Active by Default)** (Frontend)
- Display AI-generated survival plan narrative (formatted text with headings) (Frontend)
- Show critical priorities list (bullet points with Trust Blue checkmarks) (Frontend)
- Render "Next Steps" action items (Frontend)

**Tab: Map & Routes** (Frontend + Backend)
- Render interactive map (Google Maps or Mapbox) (Frontend)
- Display recommended evacuation routes (Backend â†’ generated waypoints)
- Show waypoints with descriptions (Frontend markers)
- Allow custom waypoint editing (Pro tier): Add/edit/delete waypoints (Frontend + Backend)
- Show custom waypoint upgrade prompt for Free/Basic tiers (Frontend)

**Tab: Simulation** (Frontend + Backend)
- Fetch day-by-day simulation logs (Backend query)
- Display timeline view with expandable days (Frontend)
- Show per day:
  - Day number and title (e.g., "Day 1: Immediate Response")
  - Narrative description
  - Key actions required
  - Supplies used
  - Skills needed (highlighted)
- Render as scrollable timeline with Trust Blue accents (Frontend)

**Tab: Skills** (Frontend + Backend)
- Fetch skills training resources (Backend query â†’ YouTube API, curated articles)
- Display skills organized by category:
  - First Aid & Medical
  - Water Purification
  - Shelter Building
  - Food Preparation
  - Communication
  - Self-Defense
  - Fire Starting
- Show per resource:
  - Title
  - Type icon (Video, Article, PDF)
  - Duration/length
  - Difficulty level
  - "View Resource" button (opens in modal or new tab)
- Render as filterable grid (Frontend)

**Tab: Contacts (Phase 1 Enhancement)** (Frontend + Backend)
- Display "Emergency Contact Protocol" form (Frontend)
- Show input fields:
  - Primary contacts (name, phone, relationship)
  - Out-of-state coordinator (FEMA recommendation)
  - Meeting locations (primary, secondary)
  - Communication schedule
- Save contacts to mission report (Backend update)
- Render saved contacts as editable list (Frontend + Backend)

---

### Bundle Browse & Recommendations (`/bundles`)

**Filter Sidebar** (Frontend + Backend)
- Display filter options (collapsed on mobile, persistent on desktop):
  - Scenarios (checkboxes for 6 scenarios)
  - Budget Tier (Tight, Moderate, Premium)
  - Duration (72-hour, 1-week, 1-month, Multi-year)
  - Family Size (1-2, 3-4, 5+)
  - Use Case (Bug-out, Shelter-in-place, Vehicle kit)
- Apply filters â†’ re-fetch bundles (Backend query with filters)
- Show active filter count badge (Frontend)
- Render "Clear All Filters" button (Frontend)

**Bundle Grid** (Frontend + Backend)
- Fetch bundles based on active filters or plan context (Backend â†’ AI matching algorithm)
- Display bundle cards in responsive grid (1 col mobile, 2 col tablet, 3 col desktop, 4 col wide):
  - Bundle image
  - Bundle name
  - Price (large, prominent)
  - Original price (if discounted, strikethrough)
  - Item count
  - Scenario badges
  - Use case tags
  - Star rating (Phase 2: user reviews)
  - "View Details" button â†’ `/bundles/[bundleId]` (Frontend)
- Show sort options dropdown: Relevance, Price (low-high), Price (high-low), Most Items (Frontend + Backend)
- Render pagination controls (Frontend + Backend)

**Empty State** (Frontend)
- Display when no bundles match filters: "No bundles found. Try adjusting your filters." (Frontend)
- Show "View All Bundles" button to reset filters (Frontend)

---

### Bundle Details (`/bundles/[bundleId]`)

**Bundle Hero Section** (Frontend + Backend)
- Fetch bundle data with master items and default products (Backend query)
- Display bundle image gallery (main image + thumbnails) (Frontend)
- Show bundle name (large heading) (Frontend)
- Render price (prominent, Trust Blue accent) (Frontend)
- Display scenario badges and use case tags (Frontend)
- Show item count: "Contains 24 essential items" (Frontend)
- Render action buttons:
  - "Customize This Bundle" â†’ customization mode (Frontend)
  - "Mark as Purchased" â†’ update inventory (Frontend + Backend)
  - "Add to Wishlist" â†’ save for later (Frontend + Backend)

**Bundle Description** (Frontend)
- Display admin-curated description (formatted text) (Frontend)
- Show "Why This Bundle" section explaining rationale (Frontend)
- Render "Best For" scenarios/use cases (Frontend)

**Master Items List** (Frontend + Backend)
- Display all master items in bundle as expandable cards:
  - Master item name (e.g., "Water Filter")
  - Quantity needed (e.g., "2 filters")
  - Category (e.g., "Water Supply")
  - Default product:
    - Product image
    - Product name
    - Price
    - Amazon affiliate link (Phase 1)
  - Customization indicator: Locked, Swappable, Removable (based on admin rules)
- Show total price calculation at bottom (Frontend â†’ sum of all items)
- Render sticky total bar on scroll (Frontend)

**Customization Mode** (Frontend + Backend)
- Enter customization interface (toggle state) (Frontend)
- Show editable items with actions:
  - **Locked items:** Display lock icon, no actions available (Frontend)
  - **Swappable items:** Show "Swap" button â†’ modal with alternative products (Frontend)
    - Fetch alternative products for master item (Backend query)
    - Display alternatives with prices, images, ratings
    - Select alternative â†’ update bundle selection â†’ recalculate price (Frontend + Backend)
  - **Removable items:** Show "Remove" button â†’ remove from bundle â†’ recalculate price (Frontend)
- Display real-time price updates as user customizes (Frontend)
- Show savings/increase badge: "You saved $45 with your customizations" (Frontend)
- Render "Save Customizations" button â†’ update mission report with bundle selections (Backend)

**Purchase Tracking** (Frontend + Backend)
- Show purchase status options: Not Purchased, In Cart, Purchased, Wishlist (Frontend)
- Allow status change via dropdown or buttons (Frontend + Backend update)
- Update inventory when marked "Purchased" (Backend â†’ create inventory entries)
- Recalculate readiness score when items purchased (Backend)
- Show purchase date when marked "Purchased" (Frontend + Backend)

---

### Inventory Tracker (`/inventory`)

**Inventory Summary Cards** (Frontend + Backend)
- Fetch user inventory data across all plans (Backend query)
- Display metric cards (responsive grid):
  - Total items needed (count)
  - Items owned (count + percentage)
  - Estimated remaining cost (sum of unpurchased items)
  - Readiness improvement: "+15 points from last month" (Basic+ only) (Frontend + Backend)
- Use Trust Blue accents and progress rings (Frontend)

**Inventory by Category** (Frontend + Backend)
- Display categories as expandable sections (accordion):
  - Water Supply
  - Food Storage
  - Shelter & Warmth
  - First Aid & Medical
  - Tools & Equipment
  - Communication
  - Sanitation
  - Security & Defense
  - Barter & Trade Goods (Phase 1 feature)
- Show per category:
  - Item count: "8 of 12 items owned"
  - Visual progress bar (Trust Blue fill)
  - Percentage complete
- Expand category â†’ show items list (Frontend)

**Item List (Per Category)** (Frontend + Backend)
- Display items as cards or table rows:
  - Master item name
  - Quantity needed
  - Quantity owned (editable inline)
  - Status: Owned, Needed, Ordered, Partial
  - Purchase date (if owned)
  - Estimated price
  - Product link (to Amazon or bundle detail)
  - Actions: Mark as Owned, Remove, Edit Quantity
- Allow bulk actions: Mark multiple as owned, export to shopping list (Frontend + Backend)
- Show filter/search: Filter by status, search by item name (Frontend + Backend)

**Spending Tracker (Basic+ Only)** (Frontend + Backend)
- Fetch historical inventory changes (Backend query)
- Display spending over time chart (line graph with Trust Blue) (Frontend)
- Show spending by category (pie chart) (Frontend)
- Render total spent badge: "$1,245 invested in preparedness" (Frontend)
- Show upgrade prompt for Free tier: "Track spending history with Basic ($9.99/mo)" (Frontend)

**Expiration Tracking (Phase 2 - Pro Only)** (Frontend + Backend)
- Display items with expiration dates: MREs, batteries, medications (Frontend)
- Show expiration warnings: "2 items expiring in next 30 days" (Frontend + Backend)
- Render calendar view of expirations (Frontend)
- Send expiration reminder emails (Background Job)

---

### Readiness Dashboard (`/readiness`)

**Overall Readiness Score** (Frontend + Backend)
- Fetch current readiness score (Backend calculation)
- Display large circular progress (0-100) with Trust Blue fill (Frontend)
- Show trend: "+8 points since last month" with up arrow (Frontend + Backend)
- Render score interpretation: "You're moderately prepared" (Frontend)

**Granular Readiness by Scenario** (Frontend + Backend)
- Fetch readiness breakdown per scenario (Backend calculation)
- Display scenario cards in grid (2 col mobile, 3 col tablet/desktop):
  - Scenario name
  - Circular progress (0-100)
  - Status badge: Critical, Moderate, Good, Excellent (colored)
  - Top gaps: "Missing water purification" (bullet list)
  - "Improve" button â†’ recommendations modal (Frontend)
- Use color coding: Red (<50), Yellow (50-74), Green (75-89), Trust Blue (90-100) (Frontend)

**Readiness Components Breakdown** (Frontend + Backend)
- Display component categories with scores:
  - Supplies & Equipment (weighted by scenario priorities)
  - Skills & Knowledge (based on training resources accessed)
  - Planning & Documentation (mission reports saved, contacts added)
  - Network & Support (sharing enabled, contacts added)
- Show per component:
  - Score out of 100
  - Progress bar (Trust Blue)
  - Missing items count
  - "Take Action" button â†’ specific page (supplies â†’ inventory, skills â†’ training)
- Render as expandable cards (Frontend)

**Actionable Next Steps** (Frontend + Backend)
- Fetch AI-generated recommendations to improve readiness (Backend analysis)
- Display prioritized action items (max 5-7):
  - Action description: "Add 2 water filters to reach 2-week supply"
  - Impact: "+12 points to readiness score"
  - Effort: Low, Medium, High
  - Recommended bundles or items to purchase
  - "Complete" button (Frontend + Backend)
- Order by impact vs effort (quick wins first) (Frontend)
- Show Trust Blue checkmarks for completed actions (Frontend)

**Readiness Analytics (Basic+ Only)** (Frontend + Backend)
- Fetch historical readiness data (Backend query)
- Display readiness over time chart (line graph with Trust Blue) (Frontend)
- Show milestone timeline: "First plan created", "50% readiness achieved" (Frontend)
- Render category trends: Which categories improved most (Frontend)
- Show upgrade prompt for Free tier: "Track progress over time with Basic" (Frontend)

---

### Maps & Routes (`/maps` or within `/plans/[planId]` tab)

**Interactive Map** (Frontend + Backend)
- Render map centered on user's location (Frontend â†’ Google Maps / Mapbox)
- Display recommended evacuation routes (Backend â†’ generated from AI plan)
- Show waypoints with markers:
  - Start point (home)
  - Safe destinations
  - Resource locations (water sources, hospitals, supply stores)
  - Hazard zones (flood plains, high-crime areas)
- Allow zoom, pan, satellite view toggle (Frontend)

**Route Details Panel** (Frontend + Backend)
- Display route information:
  - Route name: "Primary Evacuation Route"
  - Distance and estimated travel time
  - Mode: Driving, Walking, Biking
  - Waypoint list (ordered)
  - Special instructions per waypoint
- Show "Print Route" button â†’ printable PDF (Phase 2) (Frontend + Backend)

**Custom Waypoints (Pro Tier)** (Frontend + Backend)
- Allow adding custom waypoints: Click map â†’ add marker â†’ enter details (Frontend + Backend)
- Enable editing existing waypoints: Drag to reposition, edit details (Frontend + Backend)
- Allow deleting waypoints (Frontend + Backend)
- Save custom routes to mission report (Backend)
- Show upgrade prompt for Free/Basic tiers: "Customize routes with Pro" (Frontend)

**Offline Map Download (Phase 2 - Pro Tier)** (Frontend + Background Job)
- Show "Download for Offline Use" button (Frontend)
- Generate map tiles and route data (Background Job)
- Save to PWA cache for offline access (Frontend service worker)

---

### Survival Simulation (`/simulation` or within `/plans/[planId]` tab)

**Timeline View** (Frontend + Backend)
- Fetch simulation logs (Backend query â†’ AI-generated)
- Display day-by-day timeline (vertical scrollable):
  - Day number (large, Trust Blue)
  - Day title: "Day 1: Immediate Response"
  - Narrative description (formatted text)
  - Key actions required (bullet list)
  - Supplies used (item list with quantities)
  - Skills needed (highlighted with badges)
  - Challenges faced (potential problems)
  - Success conditions (what good looks like)
- Expand/collapse days (accordion style) (Frontend)
- Use Trust Blue progress line connecting days (Frontend)

**Simulation Controls** (Frontend)
- Show "Restart Simulation" button (reload data) (Frontend)
- Render "Take Notes" text area per day (Frontend + Backend save)
- Display "Share Simulation" button (Basic+ only) (Frontend)

**Interactive Simulation (Phase 3)** (Frontend + Backend + AI)
- Display decision points: "Day 3: Do you evacuate or shelter in place?"
- Show choices as buttons (Frontend)
- Process choice â†’ generate branching outcomes (Backend â†’ Gemini API)
- Update simulation narrative based on choices (Frontend + Backend)
- Track simulation history per user (Backend)

---

### Skills Training (`/skills`)

**Skills Overview** (Frontend + Backend)
- Display skill assessment summary:
  - Total skills in library (count)
  - Skills you've started (count from user progress)
  - Completion percentage
  - Recommended priority skills (AI-suggested based on plan)
- Use Trust Blue accents for progress indicators (Frontend)

**Skills by Category** (Frontend + Backend)
- Fetch skills training resources (Backend query)
- Display category sections (expandable):
  - First Aid & Medical
  - Water Purification & Storage
  - Shelter Building
  - Food Preparation & Preservation
  - Communication (HAM radio, signals)
  - Fire Starting & Maintenance
  - Navigation & Wayfinding
  - Self-Defense & Security
  - Bartering & Trade
  - Psychological Resilience
- Show per category:
  - Skill count
  - Your progress (percentage)
  - Priority badge (Critical, Recommended, Optional)

**Resource Cards** (Frontend + Backend)
- Display resources as cards in grid (1 col mobile, 2 col tablet, 3 col desktop):
  - Resource type icon (Video, Article, PDF)
  - Title
  - Description (truncated)
  - Duration/length
  - Difficulty level (Beginner, Intermediate, Advanced)
  - Source (YouTube, blog, official guide)
  - "View Resource" button (Frontend)
  - Bookmark icon to save favorites (Frontend + Backend)
- Show progress indicator for videos: "Watched 45%" (Frontend + Backend tracking)

**Resource Detail Modal/Page** (Frontend + Backend)
- Display resource content:
  - **Video:** Embedded YouTube player (Frontend)
  - **Article:** External link with preview (Frontend)
  - **PDF:** Embedded PDF viewer or download link (Frontend)
- Show related resources: "You might also like..." (Frontend + Backend)
- Allow marking complete (Frontend + Backend â†’ update user progress)
- Enable note-taking: "My notes on this skill" (Frontend + Backend save)

**Search & Filter** (Frontend + Backend)
- Provide search bar: Search by skill name or keyword (Frontend + Backend query)
- Show filters: Category, Type, Difficulty, Priority (Frontend + Backend)
- Display search results with relevance sorting (Frontend + Backend)

---

### Expert Calls (`/expert-calls`)

**Upcoming Calls Section** (Frontend + Backend)
- Fetch scheduled calls for user's tier (Backend query)
- Display call cards (upcoming calls first):
  - Call type: Founder Group Call, Expert Call (Pro), 1-on-1 Call (Pro)
  - Date and time (with timezone)
  - Expert name and photo (if applicable)
  - Topic/agenda
  - Zoom link (visible 30 min before call)
  - "Add to Calendar" button (Frontend â†’ generate .ics file)
  - Attendee count (for group calls)
- Show empty state for Free tier: "Upgrade to Basic for monthly founder calls" (Frontend)

**Call History** (Frontend + Backend)
- Fetch past calls user attended (Backend query)
- Display past call cards:
  - Call details (type, date, expert)
  - Recording link (if available) (Frontend)
  - Notes section: "My takeaways" (Frontend + Backend save)
  - Related resources shared during call (Frontend)
- Show "Recorded Webinar Library" section (Pro only) (Frontend + Backend)

**Schedule 1-on-1 (Pro Tier)** (Frontend + Backend)
- Display available 1-on-1 slots (Pro tier quarterly quota) (Frontend + Backend)
- Show quota usage: "1 of 4 quarterly calls used" (Frontend)
- Render calendar picker for available time slots (Frontend + Backend â†’ founder availability)
- Allow scheduling call â†’ send confirmation email â†’ add to calendars (Backend + Background Job)
- Show upgrade prompt for Basic tier: "Get quarterly 1-on-1 calls with Pro" (Frontend)

**Pay-Per-Call (Free Tier)** (Frontend + Backend)
- Display pay-per-call option: "$150 for 60-minute founder call" (Frontend)
- Show "Book Paid Call" button â†’ Stripe checkout (Frontend + Backend)
- Process payment â†’ schedule call â†’ send confirmation (Backend + Background Job)

**Call Reminders** (Background Job)
- Send email reminder 24 hours before call (Background Job)
- Send email reminder 30 minutes before call with Zoom link (Background Job)

---

### Profile & Settings (`/profile`)

**Profile Tab** (Frontend + Backend)
- Fetch user data (Backend query)
- Display editable profile fields:
  - Full name
  - Email (with verification status)
  - Location (city/region)
  - Phone number (optional)
  - Timezone (auto-detected, editable)
  - Profile photo upload (Phase 2) (Frontend + Backend)
- Show "Save Changes" button (Frontend + Backend update)
- Display validation errors inline (Frontend)

**Subscription Tab** (Frontend + Backend)
- Fetch subscription data (Backend query â†’ Stripe API)
- Display current plan card:
  - Tier name (Free, Basic, Pro)
  - Price and billing cycle
  - Next billing date (if paid tier)
  - Payment method (last 4 digits of card)
  - "Manage Payment Method" link â†’ Stripe customer portal (Frontend + Backend)
- Show plan comparison table (Frontend)
- Render upgrade/downgrade buttons:
  - Free â†’ "Upgrade to Basic" or "Upgrade to Pro" (Frontend + Backend â†’ Stripe checkout)
  - Basic â†’ "Upgrade to Pro" or "Downgrade to Free" (Frontend + Backend â†’ Stripe API)
  - Pro â†’ "Downgrade to Basic" or "Cancel Subscription" (Frontend + Backend â†’ Stripe API)
- Display cancellation policy and prorated refunds info (Frontend)

**Usage Tab** (Frontend + Backend)
- Fetch usage data (Backend query)
- Display usage metrics:
  - Plans created (count, tier limit)
  - Plans shared (count, tier limit)
  - Storage used (MB, Phase 2 when relevant)
  - Calls attended (count)
  - Expert calls quota (Pro tier: 4/year)
- Show usage charts over time (Basic+ only) (Frontend)
- Render tier-specific limits with upgrade prompts (Frontend)

**Billing History Tab** (Frontend + Backend)
- Fetch invoices (Backend query â†’ Stripe API)
- Display invoice table:
  - Date
  - Description (subscription renewal, upgrade, etc.)
  - Amount
  - Status (Paid, Failed, Pending)
  - Download PDF link â†’ Stripe-hosted invoice (Frontend)
- Show upcoming invoice preview (if available) (Frontend)

**Notification Preferences Tab** (Frontend + Backend)
- Display notification toggles:
  - **Email Notifications:**
    - Weekly newsletter (on by default)
    - Scenario-specific email series (Basic+)
    - Bundle highlight emails
    - Call reminders
    - Expiration alerts (Pro, Phase 2)
    - Platform updates and new features
  - **Push Notifications (Phase 2 - PWA):**
    - Threat alerts (Pro)
    - Readiness milestones
    - Shared plan updates
- Save preferences (Frontend + Backend update)

**Account Settings Tab** (Frontend + Backend)
- Show "Change Password" button â†’ password change modal (Frontend + Backend)
- Display "Delete Account" button â†’ confirmation modal with warnings (Frontend + Backend)
  - Warn about data loss (all plans, inventory, history)
  - Require password confirmation
  - Cancel active subscription (if any)
  - Queue account deletion job (Background Job â†’ delete after 30-day grace period)
- Show "Export My Data" button (GDPR compliance) â†’ download JSON (Frontend + Backend)

---

## ğŸ‘‘ Admin Section Pages

### Bundle Manager (`/admin/bundles`)

**Bundle List View** (Frontend + Backend)
- Fetch all bundles (Backend query)
- Display bundles table (Desktop) or cards (Mobile):
  - Bundle name
  - Image thumbnail
  - Price
  - Item count
  - Scenarios (badges)
  - Status: Active, Draft, Archived
  - Last updated date
  - Quick actions: Edit, Preview, Duplicate, Archive
- Show "Create New Bundle" button â†’ bundle editor (Frontend)
- Enable search and filters: By scenario, status, price range (Frontend + Backend)
- Use Trust Blue accents for active bundles (Frontend)

**Bundle Editor** (Frontend + Backend)
- Display bundle form in sections:

**Section 1: Basic Information**
- Bundle name (text input)
- Description (rich text editor)
- Price (number input with $ prefix)
- Hero image upload (Frontend + Backend storage)
- Status: Draft or Active (dropdown)

**Section 2: Tagging for AI Matching**
- Scenario tags (multi-select checkboxes: Natural Disaster, EMP, etc.)
- Use case tags (multi-select: Bug-out, Shelter-in-place, Vehicle kit, etc.)
- Budget tier (select: Tight, Moderate, Premium)
- Duration tags (multi-select: 72-hour, 1-week, 1-month, Multi-year)
- Family size tags (multi-select: 1-2, 3-4, 5+)

**Section 3: Master Items** (Frontend + Backend)
- Display "Add Master Item" button â†’ item selector modal (Frontend)
- Show added items list (sortable, drag-to-reorder):
  - Master item name
  - Category
  - Quantity (editable)
  - Default product selection (dropdown, fetch from product catalog)
  - Customization rules per item:
    - **Locked:** User cannot modify (checkbox)
    - **Swappable:** User can choose alternatives (checkbox + define alternative products)
    - **Removable:** User can remove from bundle (checkbox)
  - Actions: Edit, Remove
- Calculate and display total price (sum of default products) (Frontend)

**Section 4: Alternative Products** (Frontend + Backend)
- Show section for items marked "Swappable"
- Per swappable item, display "Add Alternative" button (Frontend)
- Allow selecting alternative products from catalog (Frontend + Backend query)
- Display alternatives list with:
  - Product name
  - Price
  - Price difference from default (Â± $X)
  - Remove button

**Section 5: Preview** (Frontend)
- Render bundle preview as users would see it:
  - Default view (all items with defaults)
  - Customization view (with swap/remove options visible)
- Toggle between preview modes (Frontend)

**Save & Publish** (Frontend + Backend)
- Show "Save as Draft" button â†’ save without activating (Backend)
- Show "Publish Bundle" button â†’ save and set status to Active (Backend)
- Display success message with link to preview (Frontend)
- Validate required fields before save (Frontend)

---

### Product Catalog (`/admin/products`)

**Tab 1: Master Items** (Frontend + Backend)

**Items Table/Grid** (Responsive)
- Fetch all master items (Backend query)
- Display items table (Desktop wide: split view, Desktop: table, Mobile: cards):
  - Item name
  - Category
  - Default product
  - Vendor
  - Avg price
  - Used in bundles (count)
  - Actions: Edit, Delete
- Show "Add Master Item" button â†’ item editor (Frontend)
- Enable search: By item name, category (Frontend + Backend)
- Enable bulk actions: Delete selected, Change category (Frontend + Backend)
- Use Trust Blue for active selection states (Frontend)

**Item Editor (Modal or Split Panel on Wide)** (Frontend + Backend)
- Display item form:
  - Master item name (text input)
  - Category (dropdown, fetch from categories)
  - Description (text area)
  - Default product (dropdown, fetch from products)
  - Vendor (dropdown, fetch from vendors)
  - Tags (multi-select: Essential, Optional, Specialized)
  - Image upload (Frontend + Backend storage)
- Show "Save" and "Cancel" buttons (Frontend + Backend)
- Validate required fields (Frontend)

**Tab 2: Categories** (Frontend + Backend)

**Category Tree View** (Frontend + Backend)
- Fetch categories with hierarchy (Backend query)
- Display category tree (expandable):
  - Category name
  - Parent category (if nested)
  - Item count
  - Icon/emoji
  - Actions: Edit, Delete, Add Subcategory
- Enable drag-and-drop reordering (Frontend + Backend)
- Show "Add Category" button â†’ category editor (Frontend)
- Use Trust Blue for active category (Frontend)

**Category Editor (Inline or Modal)** (Frontend + Backend)
- Display category form:
  - Category name (text input)
  - Parent category (dropdown for nesting, optional)
  - Description (text area)
  - Icon/emoji picker (Frontend)
  - Sort order (number input)
- Show "Save" and "Cancel" buttons (Frontend + Backend)
- Prevent deletion if category has items (validate) (Frontend + Backend)

**Tab 3: Analytics** (Frontend + Backend)

**Product Performance Dashboard** (Frontend + Backend)
- Fetch product analytics (Backend query)
- Display metrics (responsive grid):
  - Total products in catalog (count)
  - Total master items (count)
  - Avg price per category
  - Most used items in bundles (top 10 list)
  - Least used items (candidates for removal)
- Show top-selling products table:
  - Product name
  - Category
  - Times recommended
  - Times purchased (when tracking available)
  - Revenue generated (Phase 2)
- Render charts (Trust Blue accents):
  - Products by category (pie chart)
  - Price distribution (histogram)
  - Bundle usage over time (line chart)
- Use Trust Blue for chart elements (Frontend)

---

### Vendor Management (`/admin/vendors`)

**Vendor List** (Frontend + Backend)
- Fetch all vendors (Backend query)
- Display vendors table (Desktop) or cards (Mobile):
  - Vendor name
  - Contact person
  - Email
  - Phone
  - Products supplied (count)
  - Payment terms (Net 30, Net 60, etc.)
  - Status: Active, Inactive
  - Actions: Edit, View Products, Archive
- Show "Add Vendor" button â†’ vendor editor (Frontend)
- Enable search: By vendor name, contact (Frontend + Backend)
- Use Trust Blue for active vendors (Frontend)

**Vendor Editor** (Frontend + Backend)
- Display vendor form:
  - Vendor name (text input)
  - Contact person name (text input)
  - Email (email input)
  - Phone (phone input with formatting)
  - Address (text area)
  - Website (URL input)
  - Payment terms (dropdown: Net 30, Net 60, COD, etc.)
  - Commission structure (percentage input, Phase 2)
  - Notes (text area)
  - Status: Active or Inactive (toggle)
- Show "Save" and "Cancel" buttons (Frontend + Backend)
- Validate required fields (Frontend)

**Vendor Products View** (Frontend + Backend)
- Fetch products associated with vendor (Backend query)
- Display products list:
  - Product name
  - Category
  - Price
  - Used in bundles (count)
  - Link to product in catalog
- Show "Associate Product" button â†’ product selector (Frontend + Backend)
- Enable removing product associations (Frontend + Backend)

**Vendor Performance (Phase 2)** (Frontend + Backend)
- Display vendor analytics:
  - Total products supplied
  - Total revenue generated
  - Average product rating
  - Fulfillment rate
  - Payment history
- Render performance charts (Frontend)

---

### User Analytics (`/admin/users`)

**User Overview Dashboard** (Frontend + Backend)
- Fetch user statistics (Backend query)
- Display metric cards (responsive grid):
  - Total users (count)
  - Free tier (count + percentage)
  - Basic tier (count + percentage)
  - Pro tier (count + percentage)
  - MRR (Monthly Recurring Revenue) (calculated sum)
  - Churn rate (percentage, Phase 2)
  - New signups this month (count)
- Use Trust Blue for progress bars and highlights (Frontend)

**User List** (Frontend + Backend)
- Fetch users with pagination (Backend query)
- Display users table (Desktop) or cards (Mobile):
  - Name
  - Email
  - Tier (badge with color coding)
  - Subscription status (Active, Canceled, Past Due)
  - Signup date
  - Last active date
  - Total plans created (count)
  - Total spent (sum, Phase 2)
  - Actions: View Details, Flag, Send Email
- Enable search: By name, email (Frontend + Backend)
- Enable filters: By tier, status, signup date range (Frontend + Backend)
- Show bulk action: "Send Email to Selected" (Frontend)

**User Detail View** (Frontend + Backend)
- Fetch user details (Backend query)
- Display user profile:
  - Personal info (name, email, location, signup date)
  - Subscription details (tier, billing cycle, next payment)
  - Usage stats (plans created, bundles purchased, calls attended)
  - Activity timeline (recent actions)
  - Notes (admin-only notes, text area) (Frontend + Backend save)
- Show action buttons:
  - "Flag as High-Value" (Pro tier users for outreach) (Frontend + Backend)
  - "Send Email" â†’ email composer (Frontend)
  - "View Plans" â†’ user's mission reports (Frontend)
  - "Upgrade/Downgrade Tier" (admin override, Phase 2) (Frontend + Backend)

**Tier Conversion Funnel** (Frontend + Backend)
- Fetch conversion data (Backend query)
- Display funnel visualization:
  - Signups â†’ Free tier active users â†’ Basic upgrades â†’ Pro upgrades
  - Conversion rates per stage
  - Drop-off points highlighted
- Use Trust Blue for funnel stages (Frontend)

---

### Email Tools (`/admin/email`)

**Email Campaigns List** (Frontend + Backend)
- Fetch past email campaigns (Backend query)
- Display campaigns table:
  - Campaign name
  - Sent date
  - Recipients (count)
  - Open rate (percentage)
  - Click rate (percentage)
  - Status: Sent, Scheduled, Draft
  - Actions: View, Duplicate, Archive
- Show "Create Email Campaign" button â†’ email composer (Frontend)

**Email Composer - AI-Driven Customization** (Frontend + Backend + AI)
- Display email form:

**Section 1: Recipients**
- Select target segment (dropdown):
  - All users
  - Free tier only
  - Basic tier only
  - Pro tier only
  - High-value flagged users
  - Custom segment (filter builder)
- Show recipient count preview (Frontend + Backend query)

**Section 2: Email Content**
- Subject line (text input)
- Preview text (text input)
- Email body (rich text editor with drag-and-drop fields):
  - **User Data Fields (Draggable Tokens):**
    - {{user_name}}
    - {{user_tier}}
    - {{readiness_score}}
    - {{plans_created}}
    - {{top_scenario}} (most selected scenario)
    - {{missing_items_count}}
    - {{days_since_signup}}
  - Drag tokens into email body â†’ will be replaced per user (Frontend)

**Section 3: AI Customization Prompt** â­ UNIQUE FEATURE
- Display AI prompt text area (Frontend)
- Admin writes prompt: "For each user, recommend 2 bundles that match their top scenarios and budget tier. Explain why each bundle fits their specific needs." (Frontend)
- Show "Preview AI Output" button â†’ generate sample for 3 random users (Frontend + Backend â†’ Gemini API)
- Display sample outputs in preview panel (Frontend)
- Adjust prompt based on preview results (Frontend)

**Section 4: Send Options**
- Schedule: Send now or schedule for later (datetime picker) (Frontend)
- Test send: Enter test email addresses (Frontend + Backend)
- Show "Send Test" button (Frontend + Backend)
- Show "Send Campaign" button (Frontend + Backend â†’ queue bulk email job)

**Email Sending (Background Job)**
- Process recipients in batches (Background Job)
- For each user:
  - Replace {{tokens}} with user data (Backend)
  - If AI customization enabled: Call Gemini API with prompt + user context â†’ generate personalized content section (Backend)
  - Send email via email service (SendGrid, AWS SES, etc.) (Backend)
  - Track send status (Backend)
- Update campaign status and metrics (Backend)

**Campaign Analytics** (Frontend + Backend)
- Display campaign performance:
  - Total sent (count)
  - Delivered (count)
  - Bounced (count)
  - Opened (count + rate)
  - Clicked (count + rate)
  - Unsubscribed (count)
  - Conversions (upgrades attributed to campaign, Phase 2)
- Show email client breakdown (Gmail, Outlook, Apple Mail, etc.)
- Render charts (Trust Blue accents) (Frontend)

---

### Call Scheduling (`/admin/calls`)

**Call Types Overview** (Frontend + Backend)
- Display call type cards:
  - **Founder Group Calls (Basic Tier)**
    - Monthly frequency
    - Avg attendees per call
    - Next scheduled date
    - "Schedule New Call" button
  - **Expert Group Calls (Pro Tier)**
    - Monthly frequency
    - Rotating experts
    - Next scheduled date + expert name
    - "Schedule New Call" button
  - **1-on-1 Calls (Pro Tier)**
    - Quarterly quota per user
    - Upcoming 1-on-1s count
    - "View Schedule" button

**Schedule Founder Group Call** (Frontend + Backend)
- Display call form:
  - Call date and time (datetime picker with timezone)
  - Topic/agenda (text input)
  - Duration (dropdown: 30, 60, 90 minutes)
  - Zoom link (auto-generated or manual input)
  - Max attendees (number input, optional)
  - Description (text area)
- Show "Save & Send Invites" button (Frontend + Backend)
- Queue email invitations to all Basic+ users (Background Job)
- Add call to calendar (Backend â†’ generate .ics file)

**Schedule Expert Group Call** (Frontend + Backend)
- Display call form (similar to founder call)
- Additional fields:
  - Expert name (text input)
  - Expert photo upload (Frontend + Backend)
  - Expert bio (text area)
  - Topic specialty (dropdown: Medical, HAM Radio, Tactics, Psychology, etc.)
- Show "Save & Send Invites" button (Frontend + Backend)
- Queue email invitations to all Pro users (Background Job)

**1-on-1 Call Management** (Frontend + Backend)
- Fetch upcoming 1-on-1 calls (Backend query)
- Display calendar view:
  - User name
  - Call date and time
  - Zoom link
  - User's tier (should be Pro)
  - User's question/topic (if provided)
  - Actions: Reschedule, Cancel
- Show "Set Availability" button â†’ availability calendar editor (Frontend + Backend)
- Admin blocks out available time slots (recurring or one-time) (Frontend + Backend)
- Pro users see available slots when scheduling (Frontend)

**Call History** (Frontend + Backend)
- Fetch past calls (Backend query)
- Display calls list:
  - Call type
  - Date
  - Attendee count
  - Recording link (if available)
  - Notes (admin notes, text area)
  - Feedback summary (Phase 2: from attendee surveys)
- Enable filtering by type, date range (Frontend + Backend)

**Call Reminders (Background Job)**
- Send reminder emails 24 hours before call (Background Job)
- Send reminder emails 30 minutes before call with Zoom link (Background Job)
- Update call status after completion (Background Job)

---

## ğŸ”§ Backend Architecture & System Functions

**API Endpoints (External Communication Only)**

`/api/webhooks/stripe/route.ts` (Backend)
- Handle Stripe webhook events:
  - `checkout.session.completed` â†’ Upgrade user tier, send welcome email
  - `invoice.payment_succeeded` â†’ Renew subscription, update next billing date
  - `invoice.payment_failed` â†’ Send dunning email, flag subscription at risk
  - `customer.subscription.deleted` â†’ Downgrade user to Free tier, send cancellation confirmation
- Verify webhook signature (Backend)
- Process event â†’ update database â†’ queue follow-up jobs (Backend + Background Job)

`/api/webhooks/email/route.ts` (Backend - Phase 2)
- Handle email service webhooks (SendGrid, AWS SES):
  - Email delivered, opened, clicked, bounced, unsubscribed
- Update campaign metrics in database (Backend)

---

**Server Actions (Internal App Functionality)**

`app/actions/mission-reports.ts` (Backend)
- `createMissionReport()` â†’ Validate user tier limit â†’ Save to database â†’ Return report ID
- `updateMissionReport()` â†’ Validate ownership â†’ Update database
- `deleteMissionReport()` â†’ Validate ownership â†’ Soft delete from database
- `shareMissionReport()` â†’ Validate tier (Basic+) â†’ Generate share token â†’ Send email invites

`app/actions/bundles.ts` (Backend)
- `getBundleRecommendations()` â†’ Fetch user's scenarios â†’ Query AI matching algorithm â†’ Return top bundles
- `customizeBundle()` â†’ Validate customization rules â†’ Calculate new price â†’ Save to report
- `markBundlePurchased()` â†’ Update inventory â†’ Recalculate readiness score

`app/actions/inventory.ts` (Backend)
- `updateInventoryItem()` â†’ Validate ownership â†’ Update quantity/status â†’ Recalculate readiness
- `getInventorySummary()` â†’ Aggregate all items â†’ Calculate totals and percentages

`app/actions/readiness.ts` (Backend)
- `calculateReadinessScore()` â†’ Fetch mission report + inventory â†’ Apply scoring algorithm â†’ Return score
- `getReadinessRecommendations()` â†’ Analyze gaps â†’ Generate AI suggestions â†’ Return action items

`app/actions/subscription.ts` (Backend)
- `createCheckoutSession()` â†’ Call Stripe API â†’ Return checkout URL
- `createCustomerPortalSession()` â†’ Call Stripe API â†’ Return portal URL
- `cancelSubscription()` â†’ Call Stripe API â†’ Schedule downgrade

`app/actions/admin.ts` (Backend)
- `flagUserAsHighValue()` â†’ Update user record â†’ Add admin note
- `sendBulkEmail()` â†’ Validate segment â†’ Queue background job with user IDs and content

---

**Lib Queries (Database & Business Logic)**

`lib/queries/users.ts` (Backend)
- `getUserById()` â†’ Fetch user by ID
- `getUserByEmail()` â†’ Fetch user by email
- `updateUserTier()` â†’ Update subscription tier
- `getUsersByTier()` â†’ Fetch users filtered by tier

`lib/queries/mission-reports.ts` (Backend)
- `getMissionReportsByUserId()` â†’ Fetch all reports for user
- `getMissionReportById()` â†’ Fetch single report with relations (bundles, scenarios)
- `countMissionReportsByUserId()` â†’ Count for tier limit enforcement

`lib/queries/bundles.ts` (Backend)
- `getBundleById()` â†’ Fetch bundle with master items and products
- `getBundlesByScenarios()` â†’ Filter bundles by scenario tags
- `getBundleRecommendations()` â†’ AI matching algorithm using semantic search

`lib/queries/products.ts` (Backend)
- `getAllMasterItems()` â†’ Fetch master item catalog
- `getProductsByCategory()` â†’ Filter products by category
- `getAlternativeProducts()` â†’ Fetch alternatives for master item

`lib/queries/analytics.ts` (Backend)
- `getPlatformMetrics()` â†’ Calculate MRR, user counts, churn
- `getBundleAnalytics()` â†’ Aggregate bundle impressions, selections, revenue
- `getUserAnalytics()` â†’ Fetch user activity, conversion funnel data

---

**Background Jobs**

`jobs/email.ts` (Background Job)
- `sendWelcomeEmail()` â†’ Queue after signup
- `sendWeeklyNewsletter()` â†’ Cron job (weekly) â†’ Send to all opted-in users
- `sendScenarioEmailSeries()` â†’ Drip campaign after plan generation
- `sendCallReminders()` â†’ Cron job (check upcoming calls) â†’ Send reminders
- `sendBulkAICustomizedEmail()` â†’ Process batch â†’ For each user: generate AI content â†’ send email

`jobs/subscriptions.ts` (Background Job)
- `processDunningEmails()` â†’ Cron job (daily) â†’ Find failed payments â†’ Send reminder emails
- `downgradeExpiredSubscriptions()` â†’ Cron job (daily) â†’ Find expired subscriptions â†’ Downgrade tier

`jobs/readiness.ts` (Background Job)
- `recalculateReadinessScores()` â†’ Triggered after inventory update or bundle purchase
- `sendReadinessMilestones()` â†’ Trigger when user reaches 50%, 75%, 90% readiness

`jobs/ai.ts` (Background Job)
- `generateMissionReport()` â†’ Call Gemini API â†’ Save to database â†’ Notify user
- `generateBundleRecommendations()` â†’ Semantic matching â†’ Cache results

---

**Your Validation**
1. Does this functionality deliver your core value proposition (AI plans â†’ curated bundles â†’ readiness tracking)?
2. Any critical features missing for Phase 1 MVP launch?
3. Are the (Frontend)/(Backend)/(Background Job) indicators clear for development?
4. Does the admin functionality preserve your existing backend while styling with Trust Blue theme?

---

_**User (2025-12-09 02:39Z)**_

This all looks good. I want you to store a report of existing files (routes, modules, library, etc) because at some point i will want to remove files that are not used any longer (because they are no longer needed, were recreated using a different file name, etc). We should never attempt to conform to the previous version and look/feel. The only consideration is migrating admin functionality and data models to whatever works for us, without corrupting the supabase database we have

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user wants me to:
1. Create a report of existing files (routes, modules, library, etc.) 
2. Save this for future reference when cleaning up unused files
3. They want to ensure we don't accidentally break the admin functionality or corrupt the Supabase database
4. They're clear that we should NOT conform to the previous version's look/feel - we're building new frontend
5. Only consideration is preserving admin functionality and data models

I should:
1. List the directory structure to understand what exists
2. Create a comprehensive inventory of existing files organized by type
3. Save this as a reference document
4. Then continue with Step 4 of the page functionality mapping process

Let me start by exploring the project structure.</details></think>

---

Perfect! I'll create a comprehensive inventory of existing files so we can safely identify what to keep (admin backend, database models) vs what can be cleaned up later (old frontend, unused routes).

Let me explore your project structure:

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Let me continue exploring the key directories to get a complete picture.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Good, I'm getting a good picture. Let me explore a few more key areas including the database structure and deeper admin routes.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Let me also check the data directory and get some key database-related files to understand the schema.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** â€¢ Listed directory undefined â€¢ **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** â€¢ Read file: /home/tiran/emergency-planner-v2/src/lib/db.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** â€¢ Read file: /home/tiran/emergency-planner-v2/src/types.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I have a good understanding of the project structure. Let me continue exploring to get a complete picture of all the files that exist.</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** â€¢ Searched codebase "**/*.tsx" â€¢ **60** results in **1** directory</summary>

Directory: **\home\tiran\emergency-planner-v2\src** (60 files)

| File |
|------|
| `context\AuthContext.tsx` |
| `app\about\page.tsx` |
| `app\admin\categories\page.tsx` |
| `app\admin\layout.tsx` |
| `app\admin\page.tsx` |
| `app\admin\AdminShell.tsx` |
| `app\admin\debug\page.tsx` |
| `app\admin\approvals\page.tsx` |
| `app\admin\bundles\page.client.tsx` |
| `app\admin\import\page.client.tsx` |
| `app\admin\import\page.tsx` |
| `app\admin\bundles\page.tsx` |
| `app\admin\products\page.client.tsx` |
| `app\admin\products\page.tsx` |
| `app\admin\bundles\components\MultiSelectPills.tsx` |
| `app\admin\bundles\components\CompactTagFilter.tsx` |
| `app\admin\products\components\AddProductChoiceModal.tsx` |
| `app\admin\products\components\TagSelector.tsx` |
| `app\admin\products\components\MasterItemModal.tsx` |
| `app\admin\products\components\ProductCatalogFilter.tsx` |
| `app\admin\products\components\VariationsTable.tsx` |
| `app\admin\products\components\SupplierModal.tsx` |
| `app\admin\products\components\VariationsTableModal.tsx` |
| `app\admin\products\components\CompactCategoryTreeSelector.tsx` |
| `app\admin\products\components\AmazonSearchDialog.tsx` |
| `app\admin\products\components\VariationsModal.tsx` |
| `app\admin\products\components\InheritanceWarningModal.tsx` |
| `app\admin\products\components\ProductEditDialog.tsx` |
| `app\admin\products\components\ProductFormElements.tsx` |
| `app\admin\products\components\AddToBundleModal.tsx` |
| `app\admin\products\modals\ProductSearchModal.tsx` |
| `app\admin\products\modals\DuplicateProductWarningModal.tsx` |
| `app\admin\products\modals\DecodoErrorModal.tsx` |
| `components\Store.tsx` |
| `components\LocationAutocomplete.tsx` |
| `components\Charts.tsx` |
| `components\Hero.tsx` |
| `components\Login.tsx` |
| `components\AdminPanel.tsx` |
| `components\Footer.tsx` |
| `components\MapComponent.tsx` |
| `components\Planner.tsx` |
| `components\Dashboard.tsx` |
| `components\CriticalSkills.tsx` |
| `components\Navbar.tsx` |
| `components\SaveReportModal.tsx` |
| `components\MissionReport.tsx` |
| `components\ui\checkbox.tsx` |
| `components\ui\label.tsx` |
| `components\ui\switch.tsx` |
| `app\store\page.tsx` |
| `app\layout.tsx` |
| `app\dashboard\page.tsx` |
| `app\planner\page.tsx` |
| `app\planner\report\page.tsx` |
| `app\page.tsx` |
| `app\login\page.tsx` |
| `app\admin\suppliers\page.tsx` |
| `app\admin\suppliers\page.client.tsx` |
| `app\auth\callback\page.tsx` |

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** â€¢ Searched codebase "**/*.ts" â€¢ **30** results in **1** directory</summary>

Directory: **\home\tiran\emergency-planner-v2\src** (30 files)

| File |
|------|
| `proxy.ts` |
| `lib\utils.ts` |
| `lib\supabaseAdmin.ts` |
| `lib\supabaseClient.ts` |
| `lib\scraper.ts` |
| `lib\amazon-paapi.ts` |
| `lib\adminAuth.ts` |
| `lib\googleMaps.ts` |
| `lib\db.ts` |
| `lib\masterItemService.ts` |
| `lib\embeddings.ts` |
| `lib\categoryService.ts` |
| `lib\decodo.ts` |
| `types\paapi5-nodejs-sdk.d.ts` |
| `data\loadingTips.ts` |
| `app\api\search\route.ts` |
| `app\api\amazon\product\route.ts` |
| `app\actions.ts` |
| `app\admin\products\constants.ts` |
| `app\admin\debug\actions.ts` |
| `app\admin\bundles\actions.ts` |
| `app\admin\import\actions.ts` |
| `app\admin\actions.ts` |
| `types.ts` |
| `app\admin\products\actions.ts` |
| `app\admin\suppliers\actions.ts` |
| `utils\supabase\server.ts` |
| `utils\supabase\middleware.ts` |
| `actions\auth.ts` |
| `actions\dev.ts` |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Good! Now let me create a comprehensive inventory document that catalogs everything. I'll organize it by:
1. What to PRESERVE (admin backend, database models, lib utilities)
2. What can be REMOVED later (old frontend components, old routes)
3. What's UNDECIDED (need to evaluate during migration)

This will be a critical reference document.</details></think>

---

Perfect! I now have a comprehensive view of your project. Let me create a detailed inventory report that will serve as your reference for safely cleaning up files later.

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** â€¢ Edit file: /home/tiran/emergency-planner-v2/ai_docs/prep/existing_files_inventory.md</summary>

**Chunk 1**
Lines added: 429, lines removed: 1

```diff
@@ -1,1 +1,429 @@
- 
+ # Existing Files Inventory - Emergency Planner v2
+ **Generated:** December 9, 2025  
+ **Purpose:** Reference document for safe file cleanup during frontend rebuild
+ 
+ ---
+ 
+ ## ğŸ¯ Inventory Strategy
+ 
+ This document catalogs ALL existing files and categorizes them into:
+ - **PRESERVE** - Critical backend/admin functionality and database models (DO NOT DELETE)
+ - **REMOVE LATER** - Old frontend components and routes (safe to delete after new frontend is built)
+ - **EVALUATE** - Files that need case-by-case evaluation during migration
+ 
+ **CRITICAL:** Never delete anything that could corrupt the Supabase database or break admin functionality.
+ 
+ ---
+ 
+ ## ğŸ”’ PRESERVE - Admin Backend &amp; Database (DO NOT DELETE)
+ 
+ ### Database &amp; Data Models
+ 
+ **Core Database Layer**
+ - &#96;src/lib/db.ts&#96; - Database query abstraction layer (Supabase queries)
+ - &#96;src/lib/supabaseClient.ts&#96; - Supabase client initialization
+ - &#96;src/lib/supabaseAdmin.ts&#96; - Supabase admin client (elevated permissions)
+ - &#96;src/utils/supabase/server.ts&#96; - Server-side Supabase utilities
+ - &#96;src/utils/supabase/middleware.ts&#96; - Supabase middleware for auth
+ - &#96;src/types.ts&#96; - Core type definitions (User, Product, SupplyItem, KitItem, Route, etc.)
+ - &#96;src/types/paapi5-nodejs-sdk.d.ts&#96; - Amazon Product API type definitions
+ 
+ **Service Layer**
+ - &#96;src/lib/masterItemService.ts&#96; - Master item CRUD operations
+ - &#96;src/lib/categoryService.ts&#96; - Category management operations
+ - &#96;src/lib/embeddings.ts&#96; - Semantic embedding generation for product matching
+ - &#96;src/lib/amazon-paapi.ts&#96; - Amazon Product Advertising API integration
+ - &#96;src/lib/decodo.ts&#96; - Decodo API integration (product data)
+ - &#96;src/lib/scraper.ts&#96; - Web scraping utilities
+ - &#96;src/lib/googleMaps.ts&#96; - Google Maps API integration
+ 
+ ### Admin Backend Actions &amp; Routes
+ 
+ **Admin Server Actions** (Backend logic - PRESERVE)
+ - &#96;src/app/admin/actions.ts&#96; - Core admin operations
+ - &#96;src/app/admin/bundles/actions.ts&#96; - Bundle management operations
+ - &#96;src/app/admin/products/actions.ts&#96; - Product catalog operations
+ - &#96;src/app/admin/suppliers/actions.ts&#96; - Vendor/supplier management operations
+ - &#96;src/app/admin/import/actions.ts&#96; - Import operations (CSV, bulk)
+ - &#96;src/app/admin/debug/actions.ts&#96; - Debug/testing operations
+ 
+ **Admin API Routes**
+ - &#96;src/app/api/search/route.ts&#96; - Search API endpoint
+ - &#96;src/app/api/amazon/product/route.ts&#96; - Amazon product lookup endpoint
+ 
+ **Admin Constants &amp; Config**
+ - &#96;src/app/admin/products/constants.ts&#96; - Product catalog constants
+ - &#96;src/lib/adminAuth.ts&#96; - Admin authentication utilities
+ 
+ ### Admin Frontend Components (Preserve functionality, restyle)
+ 
+ **Admin Layout &amp; Shell**
+ - &#96;src/app/admin/layout.tsx&#96; - Admin layout wrapper (restyle with Trust Blue)
+ - &#96;src/app/admin/AdminShell.tsx&#96; - Admin navigation shell (restyle with Trust Blue)
+ - &#96;src/app/admin/page.tsx&#96; - Admin dashboard homepage (restyle)
+ 
+ **Admin Pages** (Preserve functionality, restyle with Trust Blue)
+ - &#96;src/app/admin/bundles/page.tsx&#96; - Bundle manager (Server Component)
+ - &#96;src/app/admin/bundles/page.client.tsx&#96; - Bundle manager (Client Component)
+ - &#96;src/app/admin/products/page.tsx&#96; - Product catalog (Server Component)
+ - &#96;src/app/admin/products/page.client.tsx&#96; - Product catalog (Client Component)
+ - &#96;src/app/admin/categories/page.tsx&#96; - Category management
+ - &#96;src/app/admin/suppliers/page.tsx&#96; - Vendor/supplier management (Server Component)
+ - &#96;src/app/admin/suppliers/page.client.tsx&#96; - Vendor/supplier management (Client Component)
+ - &#96;src/app/admin/import/page.tsx&#96; - Import tools (Server Component)
+ - &#96;src/app/admin/import/page.client.tsx&#96; - Import tools (Client Component)
+ - &#96;src/app/admin/approvals/page.tsx&#96; - Approval workflow (if implemented)
+ - &#96;src/app/admin/debug/page.tsx&#96; - Debug tools
+ 
+ **Admin Reusable Components** (Preserve logic, restyle with Trust Blue)
+ - &#96;src/app/admin/bundles/components/MultiSelectPills.tsx&#96;
+ - &#96;src/app/admin/bundles/components/CompactTagFilter.tsx&#96;
+ - &#96;src/app/admin/products/components/AddProductChoiceModal.tsx&#96;
+ - &#96;src/app/admin/products/components/TagSelector.tsx&#96;
+ - &#96;src/app/admin/products/components/MasterItemModal.tsx&#96;
+ - &#96;src/app/admin/products/components/ProductCatalogFilter.tsx&#96;
+ - &#96;src/app/admin/products/components/VariationsTable.tsx&#96;
+ - &#96;src/app/admin/products/components/SupplierModal.tsx&#96;
+ - &#96;src/app/admin/products/components/VariationsTableModal.tsx&#96;
+ - &#96;src/app/admin/products/components/CompactCategoryTreeSelector.tsx&#96;
+ - &#96;src/app/admin/products/components/AmazonSearchDialog.tsx&#96;
+ - &#96;src/app/admin/products/components/VariationsModal.tsx&#96;
+ - &#96;src/app/admin/products/components/InheritanceWarningModal.tsx&#96;
+ - &#96;src/app/admin/products/components/ProductEditDialog.tsx&#96;
+ - &#96;src/app/admin/products/components/ProductFormElements.tsx&#96;
+ - &#96;src/app/admin/products/components/AddToBundleModal.tsx&#96;
+ - &#96;src/app/admin/products/modals/ProductSearchModal.tsx&#96;
+ - &#96;src/app/admin/products/modals/DuplicateProductWarningModal.tsx&#96;
+ - &#96;src/app/admin/products/modals/DecodoErrorModal.tsx&#96;
+ 
+ **Note:** All admin components above should have their functionality preserved but be restyled to use:
+ - Trust Blue theme (HSL 220, 85%, 55%)
+ - shadcn/ui components (consistent with new frontend)
+ - Modern responsive design patterns
+ - Maintain existing modal patterns, popup logic, and data flow
+ 
+ ---
+ 
+ ## ğŸ—‘ï¸ REMOVE LATER - Old Frontend (Safe to delete after new frontend is built)
+ 
+ ### Old User-Facing Components
+ 
+ **Legacy User Components** (Will be completely replaced)
+ - &#96;src/components/Planner.tsx&#96; - Old plan generator (replace with new multi-step wizard)
+ - &#96;src/components/Dashboard.tsx&#96; - Old dashboard (replace with new mission dashboard)
+ - &#96;src/components/Store.tsx&#96; - Old store/marketplace (replace with new bundle system)
+ - &#96;src/components/MissionReport.tsx&#96; - Old mission report view (replace with new plan details)
+ - &#96;src/components/SaveReportModal.tsx&#96; - Old save modal (replace with new UI)
+ - &#96;src/components/MapComponent.tsx&#96; - Old map component (evaluate - may have useful logic)
+ - &#96;src/components/CriticalSkills.tsx&#96; - Old skills display (replace with new skills training page)
+ - &#96;src/components/Charts.tsx&#96; - Old chart components (replace with new readiness dashboard charts)
+ - &#96;src/components/Hero.tsx&#96; - Old landing page hero (replace with new landing page)
+ - &#96;src/components/Navbar.tsx&#96; - Old navigation (replace with new responsive sidebar)
+ - &#96;src/components/Footer.tsx&#96; - Old footer (replace with new footer)
+ - &#96;src/components/Login.tsx&#96; - Old login component (replace with new auth flow)
+ - &#96;src/components/AdminPanel.tsx&#96; - Old admin panel (if different from new admin shell)
+ 
+ ### Old User-Facing Routes
+ 
+ **Legacy App Routes** (Will be replaced with new structure)
+ - &#96;src/app/page.tsx&#96; - Current landing page (replace)
+ - &#96;src/app/planner/page.tsx&#96; - Old planner route (replace with &#96;/plans/new&#96;)
+ - &#96;src/app/planner/report/page.tsx&#96; - Old report route (replace with &#96;/plans/[planId]&#96;)
+ - &#96;src/app/dashboard/page.tsx&#96; - Old dashboard route (replace with new &#96;/dashboard&#96;)
+ - &#96;src/app/store/page.tsx&#96; - Old store route (replace with &#96;/bundles&#96;)
+ - &#96;src/app/login/page.tsx&#96; - Old login route (replace with &#96;/auth/login&#96;)
+ - &#96;src/app/about/page.tsx&#96; - Old about page (evaluate - may not be needed)
+ 
+ ### Legacy Utilities &amp; Context
+ 
+ **User-Facing Utilities** (Evaluate during migration)
+ - &#96;src/components/LocationAutocomplete.tsx&#96; - Location picker (evaluate - may reuse logic)
+ - &#96;src/context/AuthContext.tsx&#96; - Old auth context (evaluate - may need refactoring for new auth)
+ - &#96;src/data/loadingTips.ts&#96; - Loading screen tips (evaluate - may reuse for plan generation)
+ 
+ ---
+ 
+ ## âš–ï¸ EVALUATE - Case-by-Case Assessment
+ 
+ ### Authentication &amp; Session Management
+ 
+ **Files to Evaluate**
+ - &#96;src/actions/auth.ts&#96; - Auth actions (may need refactoring for new auth flow)
+ - &#96;src/actions/dev.ts&#96; - Dev/testing actions (evaluate if still needed)
+ - &#96;src/app/actions.ts&#96; - Generic actions (evaluate what's needed)
+ - &#96;src/app/auth/callback/page.tsx&#96; - OAuth callback (preserve if using OAuth)
+ 
+ **Decision Criteria:**
+ - If current auth uses Supabase Auth â†’ preserve and adapt
+ - If switching auth systems â†’ refactor but preserve user data migration logic
+ 
+ ### Shared Utilities
+ 
+ **Files to Evaluate**
+ - &#96;src/lib/utils.ts&#96; - Utility functions (evaluate what's needed, likely preserve some)
+ - &#96;src/proxy.ts&#96; - Proxy configuration (evaluate if needed for new setup)
+ 
+ **Decision Criteria:**
+ - Keep utility functions that are framework-agnostic
+ - Remove utilities tightly coupled to old frontend
+ 
+ ### UI Components Library
+ 
+ **Current shadcn/ui Components** (PRESERVE - needed for new frontend)
+ - &#96;src/components/ui/checkbox.tsx&#96;
+ - &#96;src/components/ui/label.tsx&#96;
+ - &#96;src/components/ui/switch.tsx&#96;
+ 
+ **Note:** These are the foundation for the new UI. Will need to add more shadcn components:
+ - Button, Input, Card, Dialog, Dropdown, Tabs, etc.
+ 
+ ### Root Layout &amp; Configuration
+ 
+ **Files to Evaluate**
+ - &#96;src/app/layout.tsx&#96; - Root layout (preserve but update for new design)
+ - &#96;src/app/globals.css&#96; - Global styles (preserve but update with Trust Blue theme - already updated)
+ - &#96;src/app/favicon.ico&#96; - Favicon (preserve)
+ - &#96;src/app/apple-icon.png&#96; - Apple icon (preserve)
+ 
+ **Decision Criteria:**
+ - Layout structure: Preserve but update styling and meta tags
+ - Globals CSS: Already updated with Trust Blue theme
+ - Icons: Keep existing unless replaced with new branding
+ 
+ ---
+ 
+ ## ğŸ“ Directory Structure Summary
+ 
+ ### Directories to PRESERVE
+ 
+ &#96;&#96;&#96;
+ src/
+ â”œâ”€â”€ lib/                          # PRESERVE - All database &amp; service layer
+ â”œâ”€â”€ utils/supabase/               # PRESERVE - Supabase utilities
+ â”œâ”€â”€ app/admin/                    # PRESERVE - All admin backend + restyle frontend
+ â”œâ”€â”€ app/api/                      # PRESERVE - API routes
+ â”œâ”€â”€ types/                        # PRESERVE - Type definitions
+ â””â”€â”€ types.ts                      # PRESERVE - Core types
+ &#96;&#96;&#96;
+ 
+ ### Directories to REMOVE LATER
+ 
+ &#96;&#96;&#96;
+ src/
+ â”œâ”€â”€ components/                   # REMOVE (except /ui/ folder)
+ â”‚   â”œâ”€â”€ Planner.tsx              # Delete after new plan generator built
+ â”‚   â”œâ”€â”€ Dashboard.tsx            # Delete after new dashboard built
+ â”‚   â”œâ”€â”€ Store.tsx                # Delete after new bundle system built
+ â”‚   â”œâ”€â”€ MissionReport.tsx        # Delete after new plan details built
+ â”‚   â”œâ”€â”€ Hero.tsx                 # Delete after new landing page built
+ â”‚   â”œâ”€â”€ Navbar.tsx               # Delete after new navigation built
+ â”‚   â”œâ”€â”€ Footer.tsx               # Delete after new footer built
+ â”‚   â””â”€â”€ ...                      # All old user-facing components
+ â”œâ”€â”€ app/planner/                 # REMOVE - Old planner routes
+ â”œâ”€â”€ app/dashboard/               # REMOVE - Old dashboard route
+ â”œâ”€â”€ app/store/                   # REMOVE - Old store route
+ â””â”€â”€ app/login/                   # REMOVE - Old login route
+ &#96;&#96;&#96;
+ 
+ ### Directories to EVALUATE
+ 
+ &#96;&#96;&#96;
+ src/
+ â”œâ”€â”€ context/                      # EVALUATE - AuthContext may need refactor
+ â”œâ”€â”€ actions/                      # EVALUATE - Some may be reusable
+ â””â”€â”€ data/                         # EVALUATE - Loading tips may be reused
+ &#96;&#96;&#96;
+ 
+ ---
+ 
+ ## ğŸ”„ Migration Strategy
+ 
+ ### Phase 1: Setup New Frontend Structure
+ 1. Create new route groups: &#96;(public)&#96;, &#96;(auth)&#96;, &#96;(protected)&#96;, &#96;(admin)&#96;
+ 2. Build new landing page at root &#96;/&#96;
+ 3. Create new auth flow at &#96;/auth/*&#96;
+ 4. Leave admin routes unchanged (just restyle)
+ 
+ ### Phase 2: Build Core User Experience
+ 1. Create &#96;/dashboard&#96; (new mission dashboard)
+ 2. Create &#96;/plans/new&#96; (new plan generator wizard)
+ 3. Create &#96;/plans/[planId]&#96; (new plan details)
+ 4. Create &#96;/bundles&#96; (new bundle marketplace)
+ 5. Create &#96;/inventory&#96; (new inventory tracker)
+ 6. Create &#96;/readiness&#96; (new readiness dashboard)
+ 
+ ### Phase 3: Supporting Features
+ 1. Create &#96;/maps&#96;, &#96;/simulation&#96;, &#96;/skills&#96;, &#96;/expert-calls&#96;
+ 2. Create &#96;/profile&#96; (unified account dashboard)
+ 3. Build responsive navigation sidebar
+ 
+ ### Phase 4: Cleanup Old Files
+ **Only after Phase 1-3 are complete and tested:**
+ 1. Delete old components from &#96;src/components/&#96; (except &#96;/ui/&#96;)
+ 2. Delete old routes (&#96;/planner&#96;, &#96;/dashboard&#96;, &#96;/store&#96;, &#96;/login&#96;)
+ 3. Delete unused utilities and context providers
+ 4. Run linter and tests to ensure nothing broken
+ 5. Commit with clear message: "Remove legacy frontend files"
+ 
+ ### Phase 5: Admin Restyling
+ **After user-facing frontend is stable:**
+ 1. Apply Trust Blue theme to all admin components
+ 2. Replace old UI elements with shadcn/ui components
+ 3. Ensure all existing admin functionality still works
+ 4. Test all admin operations (bundle creation, product management, etc.)
+ 
+ ---
+ 
+ ## âš ï¸ Critical Safety Rules
+ 
+ ### DO NOT DELETE
+ - **Anything in &#96;src/lib/&#96;** - Core database and service layer
+ - **Anything with "actions.ts"** in admin folders - Backend operations
+ - **API routes** - External integrations
+ - **Type definitions** - Database models and interfaces
+ - **Supabase utilities** - Authentication and database access
+ 
+ ### SAFE TO DELETE (After New Frontend Built)
+ - **Old user components** in &#96;src/components/&#96; (except &#96;/ui/&#96;)
+ - **Old user routes** (&#96;/planner&#96;, &#96;/dashboard&#96;, &#96;/store&#96;, &#96;/login&#96;)
+ - **Unused context providers** (after verifying not used by admin)
+ 
+ ### REQUIRES CAREFUL EVALUATION
+ - **Auth actions** - May be reused or refactored
+ - **Shared utilities** - Check for admin dependencies
+ - **Root layout** - Update but don't delete
+ 
+ ---
+ 
+ ## ğŸ“Š File Count Summary
+ 
+ **Total Files Inventoried:** ~90 files
+ 
+ **PRESERVE (Admin Backend + Database):** ~55 files
+ - Database layer: 13 files
+ - Admin backend: 6 files
+ - Admin frontend (restyle): 36 files
+ - UI components: 3 files
+ 
+ **REMOVE LATER (Old Frontend):** ~25 files
+ - Legacy components: 13 files
+ - Legacy routes: 7 files
+ - Legacy utilities: 5 files
+ 
+ **EVALUATE (Case-by-Case):** ~10 files
+ - Auth: 4 files
+ - Utilities: 3 files
+ - Context: 1 file
+ - Config: 2 files
+ 
+ ---
+ 
+ ## ğŸ§ª Testing Checklist Before Cleanup
+ 
+ Before deleting ANY old frontend files, verify:
+ 
+ - [ ] All new user routes are functional (&#96;/dashboard&#96;, &#96;/plans/*&#96;, &#96;/bundles&#96;, etc.)
+ - [ ] Authentication flow works end-to-end (signup, login, logout, password reset)
+ - [ ] Admin panel is accessible and all functions work (bundle creation, product management)
+ - [ ] Database queries still work (mission reports CRUD, inventory tracking)
+ - [ ] API routes respond correctly (search, Amazon product lookup)
+ - [ ] No import errors or broken references in admin code
+ - [ ] Supabase connection is stable
+ - [ ] All admin modals and popups function correctly
+ - [ ] Trust Blue theme applied consistently across admin
+ - [ ] Responsive design works on mobile, tablet, desktop
+ 
+ ---
+ 
+ ## ğŸ“ Cleanup Commands (Run ONLY after new frontend is complete)
+ 
+ &#96;&#96;&#96;bash
+ # Phase 4: Remove old user-facing files (SAFE AFTER NEW FRONTEND BUILT)
+ 
+ # Remove old user components (keep ui folder)
+ rm -rf src/components/Planner.tsx
+ rm -rf src/components/Dashboard.tsx
+ rm -rf src/components/Store.tsx
+ rm -rf src/components/MissionReport.tsx
+ rm -rf src/components/SaveReportModal.tsx
+ rm -rf src/components/MapComponent.tsx
+ rm -rf src/components/CriticalSkills.tsx
+ rm -rf src/components/Charts.tsx
+ rm -rf src/components/Hero.tsx
+ rm -rf src/components/Navbar.tsx
+ rm -rf src/components/Footer.tsx
+ rm -rf src/components/Login.tsx
+ rm -rf src/components/AdminPanel.tsx
+ 
+ # Remove old user routes
+ rm -rf src/app/planner/
+ rm -rf src/app/dashboard/
+ rm -rf src/app/store/
+ rm -rf src/app/login/
+ rm -rf src/app/about/
+ 
+ # Evaluate and remove if unused
+ # (Check for admin dependencies first!)
+ rm -rf src/components/LocationAutocomplete.tsx  # If rebuilt for new UI
+ rm -rf src/data/loadingTips.ts  # If not using loading tips
+ 
+ # Run linter to check for broken imports
+ npm run lint
+ 
+ # Run type check
+ npm run type-check
+ 
+ # Test admin functionality
+ # Navigate to /admin/* routes and test all features
+ 
+ # Commit cleanup
+ git add .
+ git commit -m "chore: remove legacy frontend files after new UI rebuild"
+ &#96;&#96;&#96;
+ 
+ ---
+ 
+ ## ğŸš¨ Emergency Recovery
+ 
+ If you accidentally delete critical files:
+ 
+ 1. **Immediately stop and don't commit**
+ 2. Check git status: &#96;git status&#96;
+ 3. Restore deleted files: &#96;git restore &lt;file-path&gt;&#96;
+ 4. Or restore all: &#96;git restore .&#96;
+ 
+ **Critical files to NEVER delete:**
+ - &#96;src/lib/db.ts&#96;
+ - &#96;src/lib/supabase*.ts&#96;
+ - &#96;src/app/admin/*/actions.ts&#96;
+ - &#96;src/types.ts&#96;
+ - Anything in &#96;src/app/api/&#96;
+ 
+ ---
+ 
+ ## âœ… Completion Checklist
+ 
+ When you're ready to clean up old frontend files:
+ 
+ - [ ] New frontend is 100% functional
+ - [ ] All user stories from Phase 1 are implemented
+ - [ ] Authentication works end-to-end
+ - [ ] Admin panel tested and working
+ - [ ] Database operations verified
+ - [ ] Backup created (git commit before cleanup)
+ - [ ] Ran linter and type-check before cleanup
+ - [ ] Deleted old components one-by-one (not all at once)
+ - [ ] Tested admin after each deletion batch
+ - [ ] Verified no broken imports
+ - [ ] Final lint and type-check passed
+ - [ ] Created git commit with cleanup changes
+ 
+ ---
+ 
+ **End of Inventory Report**
+ 
+ This document should be updated if:
+ - New admin functionality is added (add to PRESERVE list)
+ - New files are created (categorize as PRESERVE/REMOVE/EVALUATE)
+ - Migration strategy changes (update phases)
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Perfect! Now I should complete Step 3 and continue with the remaining steps (Step 4-6) of the app pages and functionality blueprint. Let me continue where we left off.</details></think>

---

Excellent! I've created a comprehensive inventory report saved to `ai_docs/prep/existing_files_inventory.md`. This document catalogs all ~90 existing files and categorizes them into:

- **PRESERVE (55 files)** - Admin backend, database layer, service layer - DO NOT DELETE
- **REMOVE LATER (25 files)** - Old frontend components and routes - Safe to delete after new frontend is built
- **EVALUATE (10 files)** - Auth, utilities, context - Case-by-case assessment

The report includes safety rules, cleanup commands, and testing checklists to ensure you never corrupt the Supabase database or break admin functionality.

---

Great! Captured: Complete existing files inventory created for safe cleanup reference.

Next step coming up...

---

### Step 4 â€“ Next.js Routes & Layout Groups

Excellent functionality mapping! Now I'll create your complete Next.js App Router structure with proper layout groups, dynamic routes, and backend architecture optimized for your preparedness platform.

**Purpose** â€“ Provide the exact folder structure and routes for Next.js development, organized by access level and functionality.

**My Analysis**

Based on your app structure, I'm organizing routes into logical layout groups:
- `(public)` for marketing pages (landing, legal)
- `(auth)` for authentication flow
- `(protected)` for authenticated user features (plans, bundles, inventory)
- `(admin)` for admin-only pages (already exists, preserve structure)

Action-based route names reflect core user actions: `/plans/new` (not `/planner`), `/bundles` (not `/store`), `/inventory` (not `/gear-tracker`).

**Smart Recommendations**
- âœ… **Proper Layout Groups** - Clean separation by access level
- âœ… **Action-Based Route Names** - `/plans/new` (generate plan), `/bundles` (browse marketplace)
- âœ… **Domain-Specific Parameters** - `[planId]`, `[bundleId]` (not generic `[id]`)
- âœ… **Admin Route Structure** - Individual admin routes preserved as-is
- âœ… **Server Actions + Lib Queries** - Internal app functionality (no unnecessary API routes)
- âœ… **API Endpoints Reserved** - Only for external communication (webhooks, Amazon API)
- âœ… **Middleware-Friendly** - Structure works with auth and role middleware
- âœ… **SEO Optimized** - Clean URLs for marketing pages
- âŒ **API Route Overuse** - Don't create API endpoints for internal functionality
- âŒ **Route Complexity** - Keep URLs simple and user-friendly

**AI Draft (editable)**

## ğŸ“ Next.js App Router Structure

```
src/app/
â”œâ”€â”€ layout.tsx                    # Root layout (Trust Blue theme, fonts, providers)
â”œâ”€â”€ globals.css                   # Global styles (Trust Blue theme already applied)
â”œâ”€â”€ page.tsx                      # Landing page (replace old Hero)
â”œâ”€â”€ favicon.ico                   # Existing favicon (preserve)
â”œâ”€â”€ apple-icon.png                # Existing Apple icon (preserve)
â”‚
â”œâ”€â”€ (public)/                     # ğŸŒ Public marketing pages
â”‚   â”œâ”€â”€ layout.tsx               # Public layout (navbar, footer)
â”‚   â”œâ”€â”€ privacy/
â”‚   â”‚   â””â”€â”€ page.tsx             # Privacy policy
â”‚   â”œâ”€â”€ terms/
â”‚   â”‚   â””â”€â”€ page.tsx             # Terms of service
â”‚   â””â”€â”€ cookies/
â”‚       â””â”€â”€ page.tsx             # Cookie policy
â”‚
â”œâ”€â”€ (auth)/                       # ğŸ” Authentication flow
â”‚   â”œâ”€â”€ layout.tsx               # Auth layout (centered forms, minimal UI)
â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â””â”€â”€ page.tsx             # User login
â”‚   â”œâ”€â”€ sign-up/
â”‚   â”‚   â””â”€â”€ page.tsx             # User registration
â”‚   â”œâ”€â”€ forgot-password/
â”‚   â”‚   â””â”€â”€ page.tsx             # Password reset
â”‚   â”œâ”€â”€ sign-up-success/
â”‚   â”‚   â””â”€â”€ page.tsx             # Registration confirmation
â”‚   â””â”€â”€ callback/
â”‚       â””â”€â”€ page.tsx             # OAuth callback (existing, preserve)
â”‚
â”œâ”€â”€ (protected)/                  # ğŸ›¡ï¸ Authenticated user application
â”‚   â”œâ”€â”€ layout.tsx               # Protected layout (responsive sidebar nav)
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â””â”€â”€ page.tsx             # Mission dashboard (homepage for auth users)
â”‚   â”‚
â”‚   â”œâ”€â”€ plans/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Plan list (redirect to /dashboard)
â”‚   â”‚   â”œâ”€â”€ new/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx         # Plan generator wizard (multi-step)
â”‚   â”‚   â”œâ”€â”€ [planId]/
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # Plan details (overview, bundles, stats)
â”‚   â”‚   â”‚   â””â”€â”€ edit/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx     # Edit plan (scenarios, personnel, location)
â”‚   â”‚
â”‚   â”œâ”€â”€ bundles/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Bundle marketplace (browse, filter)
â”‚   â”‚   â””â”€â”€ [bundleId]/
â”‚   â”‚       â””â”€â”€ page.tsx         # Bundle details (items, customization, purchase)
â”‚   â”‚
â”‚   â”œâ”€â”€ inventory/
â”‚   â”‚   â””â”€â”€ page.tsx             # Inventory tracker (owned/needed, spending)
â”‚   â”‚
â”‚   â”œâ”€â”€ readiness/
â”‚   â”‚   â””â”€â”€ page.tsx             # Readiness dashboard (score, breakdown, next steps)
â”‚   â”‚
â”‚   â”œâ”€â”€ maps/
â”‚   â”‚   â””â”€â”€ page.tsx             # Evacuation routes (interactive maps)
â”‚   â”‚
â”‚   â”œâ”€â”€ simulation/
â”‚   â”‚   â””â”€â”€ page.tsx             # Survival simulation (day-by-day timeline)
â”‚   â”‚
â”‚   â”œâ”€â”€ skills/
â”‚   â”‚   â””â”€â”€ page.tsx             # Skills training (resource library)
â”‚   â”‚
â”‚   â”œâ”€â”€ expert-calls/
â”‚   â”‚   â””â”€â”€ page.tsx             # Expert calls (schedule, history, recordings)
â”‚   â”‚
â”‚   â””â”€â”€ profile/
â”‚       â””â”€â”€ page.tsx             # Unified profile (account, subscription, usage, billing)
â”‚
â”œâ”€â”€ admin/                        # ğŸ‘‘ Admin section (EXISTING - preserve)
â”‚   â”œâ”€â”€ layout.tsx               # Admin layout (existing, restyle with Trust Blue)
â”‚   â”œâ”€â”€ AdminShell.tsx           # Admin nav shell (existing, restyle)
â”‚   â”œâ”€â”€ page.tsx                 # Admin dashboard
â”‚   â”‚
â”‚   â”œâ”€â”€ bundles/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Bundle manager (existing)
â”‚   â”‚   â”œâ”€â”€ page.client.tsx      # Bundle manager client (existing)
â”‚   â”‚   â”œâ”€â”€ actions.ts           # Bundle actions (existing)
â”‚   â”‚   â””â”€â”€ components/          # Bundle components (existing)
â”‚   â”‚
â”‚   â”œâ”€â”€ products/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Product catalog (existing)
â”‚   â”‚   â”œâ”€â”€ page.client.tsx      # Product catalog client (existing)
â”‚   â”‚   â”œâ”€â”€ actions.ts           # Product actions (existing)
â”‚   â”‚   â”œâ”€â”€ constants.ts         # Product constants (existing)
â”‚   â”‚   â”œâ”€â”€ components/          # Product components (existing)
â”‚   â”‚   â””â”€â”€ modals/              # Product modals (existing)
â”‚   â”‚
â”‚   â”œâ”€â”€ categories/
â”‚   â”‚   â””â”€â”€ page.tsx             # Category management (existing, merge into products)
â”‚   â”‚
â”‚   â”œâ”€â”€ suppliers/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Vendor management (existing)
â”‚   â”‚   â”œâ”€â”€ page.client.tsx      # Vendor client (existing)
â”‚   â”‚   â””â”€â”€ actions.ts           # Vendor actions (existing)
â”‚   â”‚
â”‚   â”œâ”€â”€ users/                    # NEW - User analytics
â”‚   â”‚   â”œâ”€â”€ page.tsx             # User list, tier breakdown
â”‚   â”‚   â””â”€â”€ [userId]/
â”‚   â”‚       â””â”€â”€ page.tsx         # User detail view
â”‚   â”‚
â”‚   â”œâ”€â”€ email/                    # NEW - Email tools
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Campaign list
â”‚   â”‚   â””â”€â”€ new/
â”‚   â”‚       â””â”€â”€ page.tsx         # Email composer (AI customization)
â”‚   â”‚
â”‚   â”œâ”€â”€ calls/                    # NEW - Call scheduling
â”‚   â”‚   â””â”€â”€ page.tsx             # Call management (founder, expert, 1-on-1)
â”‚   â”‚
â”‚   â”œâ”€â”€ import/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Import tools (existing)
â”‚   â”‚   â”œâ”€â”€ page.client.tsx      # Import client (existing)
â”‚   â”‚   â””â”€â”€ actions.ts           # Import actions (existing)
â”‚   â”‚
â”‚   â”œâ”€â”€ approvals/
â”‚   â”‚   â””â”€â”€ page.tsx             # Approval workflow (existing)
â”‚   â”‚
â”‚   â”œâ”€â”€ debug/
â”‚   â”‚   â”œâ”€â”€ page.tsx             # Debug tools (existing)
â”‚   â”‚   â””â”€â”€ actions.ts           # Debug actions (existing)
â”‚   â”‚
â”‚   â””â”€â”€ actions.ts               # Core admin actions (existing)
â”‚
â”œâ”€â”€ api/                          # ğŸ”§ API endpoints (EXTERNAL COMMUNICATION ONLY)
â”‚   â”œâ”€â”€ webhooks/
â”‚   â”‚   â””â”€â”€ stripe/
â”‚   â”‚       â””â”€â”€ route.ts         # NEW - Stripe webhook handler
â”‚   â”œâ”€â”€ amazon/
â”‚   â”‚   â””â”€â”€ product/
â”‚   â”‚       â””â”€â”€ route.ts         # Amazon product API (existing)
â”‚   â””â”€â”€ search/
â”‚       â””â”€â”€ route.ts             # Search API (existing)
â”‚
â””â”€â”€ actions/                      # âš¡ Server Actions (INTERNAL FUNCTIONALITY)
    â”œâ”€â”€ mission-reports.ts        # NEW - Mission report CRUD
    â”œâ”€â”€ bundles.ts                # NEW - Bundle operations
    â”œâ”€â”€ inventory.ts              # NEW - Inventory tracking
    â”œâ”€â”€ readiness.ts              # NEW - Readiness calculation
    â”œâ”€â”€ subscription.ts           # NEW - Subscription management
    â”œâ”€â”€ auth.ts                   # Auth operations (existing, may refactor)
    â””â”€â”€ dev.ts                    # Dev/testing (existing)
```

---

## ğŸ”§ Backend Architecture

### Server Actions (Internal App Functionality)

**Location:** `src/app/actions/`

```
actions/
â”œâ”€â”€ mission-reports.ts           # Create, update, delete, share mission reports
â”œâ”€â”€ bundles.ts                   # Get recommendations, customize, mark purchased
â”œâ”€â”€ inventory.ts                 # Update items, get summary, track spending
â”œâ”€â”€ readiness.ts                 # Calculate score, get recommendations, track progress
â”œâ”€â”€ subscription.ts              # Create checkout, manage subscription, cancel
â”œâ”€â”€ sharing.ts                   # Share plans, manage network, send invites
â”œâ”€â”€ calls.ts                     # Schedule calls, get availability, send reminders
â”œâ”€â”€ auth.ts                      # Login, signup, password reset (existing)
â””â”€â”€ dev.ts                       # Dev utilities (existing)
```

**Usage Pattern:**
```typescript
// Frontend component
"use client";
import { createMissionReport } from "@/app/actions/mission-reports";

async function handleSubmit(formData: FormData) {
  const result = await createMissionReport(formData);
  if (result.success) {
    // Handle success
  }
}
```

---

### Lib Queries (Database & Business Logic)

**Location:** `src/lib/queries/`

```
lib/queries/
â”œâ”€â”€ users.ts                     # User CRUD, tier management
â”œâ”€â”€ mission-reports.ts           # Mission report queries
â”œâ”€â”€ bundles.ts                   # Bundle matching, filtering
â”œâ”€â”€ products.ts                  # Product catalog queries
â”œâ”€â”€ inventory.ts                 # Inventory aggregation
â”œâ”€â”€ analytics.ts                 # Platform metrics, user analytics
â””â”€â”€ subscriptions.ts             # Subscription status queries
```

**Usage Pattern:**
```typescript
// Server action calls lib query
"use server";
import { getMissionReportsByUserId } from "@/lib/queries/mission-reports";

export async function getUserPlans(userId: string) {
  const reports = await getMissionReportsByUserId(userId);
  return { success: true, data: reports };
}
```

---

### API Endpoints (External Communication Only)

**Location:** `src/app/api/`

```
api/
â”œâ”€â”€ webhooks/
â”‚   â”œâ”€â”€ stripe/
â”‚   â”‚   â””â”€â”€ route.ts             # Stripe subscription events
â”‚   â””â”€â”€ email/
â”‚       â””â”€â”€ route.ts             # Email service callbacks (Phase 2)
â”‚
â”œâ”€â”€ amazon/
â”‚   â””â”€â”€ product/
â”‚       â””â”€â”€ route.ts             # Amazon Product API (existing)
â”‚
â””â”€â”€ search/
    â””â”€â”€ route.ts                 # Search API (existing)
```

**When to Use API Endpoints:**
- Webhooks from external services (Stripe, SendGrid)
- Integration with external backends
- Public API for mobile apps (Phase 3)
- Third-party service callbacks

**When NOT to Use API Endpoints:**
- Internal app operations (use Server Actions)
- Database queries (use Lib Queries via Server Actions)
- Auth operations (use Server Actions)
- User-triggered operations (use Server Actions)

---

## ğŸ—ºï¸ Complete Route Mapping

### ğŸŒ Public Routes

| Route | Page | Purpose |
|---|---|---|
| `/` | Landing page | Hero, features, pricing, FAQ, CTA |
| `/privacy` | Privacy policy | GDPR compliance |
| `/terms` | Terms of service | Legal requirement |
| `/cookies` | Cookie policy | GDPR compliance |

---

### ğŸ” Auth Routes

| Route | Page | Purpose |
|---|---|---|
| `/auth/login` | Login | Email/password login, OAuth |
| `/auth/sign-up` | Sign up | Account creation |
| `/auth/forgot-password` | Forgot password | Password reset flow |
| `/auth/sign-up-success` | Sign up success | Confirmation message |
| `/auth/callback` | OAuth callback | OAuth provider redirect |

---

### ğŸ›¡ï¸ Protected Routes (Authenticated Users)

| Route | Page | Purpose |
|---|---|---|
| `/dashboard` | Mission dashboard | Homepage for auth users, plan cards |
| `/plans/new` | Plan generator | Multi-step wizard (scenarios â†’ personnel â†’ location â†’ AI generation) |
| `/plans/[planId]` | Plan details | Overview, bundles, tabs (map, simulation, skills) |
| `/plans/[planId]/edit` | Edit plan | Modify scenarios, personnel, location |
| `/bundles` | Bundle marketplace | Browse, filter, search bundles |
| `/bundles/[bundleId]` | Bundle details | Items, customization, purchase tracking |
| `/inventory` | Inventory tracker | Owned/needed items, spending history |
| `/readiness` | Readiness dashboard | Score, breakdown, next steps, analytics |
| `/maps` | Evacuation routes | Interactive maps, waypoints |
| `/simulation` | Survival simulation | Day-by-day timeline |
| `/skills` | Skills training | Resource library (videos, articles, PDFs) |
| `/expert-calls` | Expert calls | Schedule, history, recordings, 1-on-1 |
| `/profile` | Profile & settings | Account, subscription, usage, billing |

---

### ğŸ‘‘ Admin Routes (Admin Users Only)

| Route | Page | Purpose |
|---|---|---|
| `/admin` | Admin dashboard | Platform metrics overview |
| `/admin/bundles` | Bundle manager | Create/edit bundles, preview, tagging |
| `/admin/products` | Product catalog | Master items, categories (tabs), analytics |
| `/admin/suppliers` | Vendor management | Vendor directory, performance |
| `/admin/users` | User analytics | User list, tier breakdown, flagging |
| `/admin/users/[userId]` | User details | Profile, activity, notes |
| `/admin/email` | Email campaigns | Campaign list, composer |
| `/admin/email/new` | Email composer | AI customization, bulk send |
| `/admin/calls` | Call scheduling | Founder/expert/1-on-1 management |
| `/admin/import` | Import tools | CSV/bulk import utilities |
| `/admin/approvals` | Approvals | Workflow management (if implemented) |
| `/admin/debug` | Debug tools | Testing utilities |

**Note:** Existing admin structure preserved, just add new pages (`/users`, `/email`, `/calls`)

---

### ğŸ”§ API Routes (External Only)

| Route | Purpose | Type |
|---|---|---|
| `/api/webhooks/stripe` | Stripe subscription events | Webhook |
| `/api/webhooks/email` | Email service callbacks (Phase 2) | Webhook |
| `/api/amazon/product` | Amazon Product API lookup | External API |
| `/api/search` | Search endpoint | Internal (consider moving to Server Action) |

---

## ğŸš€ Architecture Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                             â”‚
â”‚  (React Components in app/ directory)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚                                       â”‚
                  â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     SERVER ACTIONS          â”‚         â”‚      API ENDPOINTS           â”‚
â”‚   (app/actions/*.ts)        â”‚         â”‚    (app/api/*/route.ts)      â”‚
â”‚                             â”‚         â”‚                              â”‚
â”‚  â€¢ mission-reports.ts       â”‚         â”‚  â€¢ /webhooks/stripe          â”‚
â”‚  â€¢ bundles.ts               â”‚         â”‚  â€¢ /webhooks/email           â”‚
â”‚  â€¢ inventory.ts             â”‚         â”‚  â€¢ /amazon/product           â”‚
â”‚  â€¢ readiness.ts             â”‚         â”‚                              â”‚
â”‚  â€¢ subscription.ts          â”‚         â”‚  (External Communication)    â”‚
â”‚  â€¢ auth.ts                  â”‚         â”‚                              â”‚
â”‚                             â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  (Internal Functionality)   â”‚                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
           â”‚                                        â”‚
           â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     LIB QUERIES             â”‚         â”‚   EXTERNAL SERVICES          â”‚
â”‚   (lib/queries/*.ts)        â”‚         â”‚                              â”‚
â”‚                             â”‚         â”‚  â€¢ Stripe API                â”‚
â”‚  â€¢ users.ts                 â”‚         â”‚  â€¢ SendGrid                  â”‚
â”‚  â€¢ mission-reports.ts       â”‚         â”‚  â€¢ Amazon Product API        â”‚
â”‚  â€¢ bundles.ts               â”‚         â”‚  â€¢ Google Maps               â”‚
â”‚  â€¢ products.ts              â”‚         â”‚  â€¢ Gemini AI                 â”‚
â”‚  â€¢ inventory.ts             â”‚         â”‚                              â”‚
â”‚  â€¢ analytics.ts             â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â€¢ subscriptions.ts         â”‚
â”‚                             â”‚
â”‚  (Database Queries)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DATABASE LAYER          â”‚
â”‚   (lib/db.ts)               â”‚
â”‚                             â”‚
â”‚  â€¢ Supabase Client          â”‚
â”‚  â€¢ Query Abstraction        â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    SUPABASE DATABASE        â”‚
â”‚                             â”‚
â”‚  â€¢ PostgreSQL               â”‚
â”‚  â€¢ Tables & Schemas         â”‚
â”‚  â€¢ RLS Policies             â”‚
â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”’ Middleware & Auth Flow

**Middleware** (`src/middleware.ts` - to be created)

```typescript
import { createServerClient } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';

export async function middleware(request: NextRequest) {
  const response = NextResponse.next();
  
  // Create Supabase client
  const supabase = createServerClient(/* ... */);
  
  // Get session
  const { data: { session } } = await supabase.auth.getSession();
  
  // Protected routes
  if (request.nextUrl.pathname.startsWith('/dashboard') ||
      request.nextUrl.pathname.startsWith('/plans') ||
      request.nextUrl.pathname.startsWith('/bundles') ||
      request.nextUrl.pathname.startsWith('/inventory') ||
      request.nextUrl.pathname.startsWith('/readiness') ||
      request.nextUrl.pathname.startsWith('/profile')) {
    
    if (!session) {
      return NextResponse.redirect(new URL('/auth/login', request.url));
    }
  }
  
  // Admin routes
  if (request.nextUrl.pathname.startsWith('/admin')) {
    if (!session) {
      return NextResponse.redirect(new URL('/auth/login', request.url));
    }
    
    // Check admin role
    const { data: profile } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', session.user.id)
      .single();
      
    if (profile?.role !== 'ADMIN') {
      return NextResponse.redirect(new URL('/dashboard', request.url));
    }
  }
  
  return response;
}

export const config = {
  matcher: [
    '/dashboard/:path*',
    '/plans/:path*',
    '/bundles/:path*',
    '/inventory/:path*',
    '/readiness/:path*',
    '/profile/:path*',
    '/admin/:path*',
  ],
};
```

---

## ğŸ“± Responsive Layout Strategy

### Root Layout (`src/app/layout.tsx`)

```typescript
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "beprepared.ai - AI-Powered Disaster Preparedness",
  description: "Build complete disaster readiness plans in minutes with AI-powered survival strategies and curated bundles.",
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        {children}
      </body>
    </html>
  );
}
```

---

### Public Layout (`src/app/(public)/layout.tsx`)

```typescript
import Navbar from "@/components/navigation/Navbar";
import Footer from "@/components/navigation/Footer";

export default function PublicLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <>
      <Navbar />
      <main className="min-h-screen">
        {children}
      </main>
      <Footer />
    </>
  );
}
```

---

### Auth Layout (`src/app/(auth)/layout.tsx`)

```typescript
export default function AuthLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="min-h-screen flex items-center justify-center bg-muted">
      <div className="w-full max-w-md p-8">
        {children}
      </div>
    </div>
  );
}
```

---

### Protected Layout (`src/app/(protected)/layout.tsx`)

```typescript
import Sidebar from "@/components/navigation/Sidebar";

export default function ProtectedLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="flex min-h-screen">
      <Sidebar />
      <main className="flex-1 p-6 lg:p-8">
        {children}
      </main>
    </div>
  );
}
```

---

**Your Validation**
1. Do these routes reflect your app's user journey and business model?
2. Is the admin structure preserved correctly with new pages added?
3. Does the separation of Server Actions vs API Endpoints make sense?
4. Any route adjustments needed for better UX or SEO?

---

_**User (2025-12-09 02:39Z)**_

in the migration strategy you need to be mindful that the new application architecture will likely use drizzle ORM

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
Excellent point! The user is planning to migrate from Supabase client queries to Drizzle ORM. This is a significant architectural change that needs to be reflected in the migration strategy and file inventory.

Key implications:
1. The existing `src/lib/db.ts` uses Supabase client directly - this will need to be replaced with Drizzle
2. All database queries in admin actions and lib functions currently use Supabase - these will need migration
3. Need to create new Drizzle schema files
4. Need Drizzle config and migration files
5. The Supabase database itself stays intact - just the ORM layer changes
6. Authentication might still use Supabase Auth (common pattern - Drizzle for data, Supabase for auth)

I should update the inventory document to reflect this and add a Drizzle migration section to the blueprint.</details></think>

---

Excellent point! Let me update the migration strategy and add a Drizzle ORM section to both documents.

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** â€¢ Edit file: /home/tiran/emergency-planner-v2/ai_docs/prep/existing_files_inventory.md</summary>

**Chunk 1**
Lines added: 53, lines removed: 3

```diff
@@ -238,12 +238,62 @@
  
  ## ğŸ”„ Migration Strategy
+ 
+ ### Phase 0: Drizzle ORM Setup (FIRST - Before Frontend Rebuild)
+ **Critical:** Set up Drizzle ORM before building new features to avoid double migration work.
+ 
+ 1. **Install Drizzle dependencies**
+    &#96;&#96;&#96;bash
+    npm install drizzle-orm postgres
+    npm install -D drizzle-kit
+    &#96;&#96;&#96;
+ 
+ 2. **Create Drizzle schema files** (&#96;src/db/schema/&#96;)
+    - Map existing Supabase tables to Drizzle schema
+    - Preserve all table structures and relationships
+    - Use existing database - don't recreate tables
+ 
+ 3. **Create Drizzle config** (&#96;drizzle.config.ts&#96;)
+    - Point to existing Supabase PostgreSQL connection
+    - Configure migrations directory
+ 
+ 4. **Create new database layer** (&#96;src/db/&#96;)
+    - &#96;src/db/index.ts&#96; - Drizzle client initialization
+    - &#96;src/db/queries/&#96; - Type-safe query functions
+    - Replace &#96;src/lib/db.ts&#96; Supabase queries with Drizzle queries
+ 
+ 5. **Migrate existing admin queries** (one table at a time)
+    - Start with simple tables (categories, suppliers)
+    - Test admin functions after each table migration
+    - Preserve exact same functionality
+    - Keep &#96;src/lib/db.ts&#96; as fallback during migration
+ 
+ 6. **Migrate authentication queries**
+    - Keep Supabase Auth for authentication (common pattern)
+    - Use Drizzle for profiles/user data queries
+    - Maintain session management with Supabase
+ 
+ 7. **Test all admin operations** before proceeding
+    - Bundle creation/editing
+    - Product management
+    - Category management
+    - Vendor management
+    - Ensure no data corruption
+ 
+ **Why Phase 0 comes first:**
+ - Avoid migrating old frontend code to Drizzle unnecessarily
+ - New frontend will use Drizzle from day one
+ - Admin backend migrated once with testing
+ - Reduces technical debt
+ - Cleaner codebase post-migration
+ 
+ ---
  
  ### Phase 1: Setup New Frontend Structure
  1. Create new route groups: &#96;(public)&#96;, &#96;(auth)&#96;, &#96;(protected)&#96;, &#96;(admin)&#96;
  2. Build new landing page at root &#96;/&#96;
- 3. Create new auth flow at &#96;/auth/*&#96;
- 4. Leave admin routes unchanged (just restyle)
+ 3. Create new auth flow at &#96;/auth/*&#96; (using Supabase Auth + Drizzle queries)
+ 4. Leave admin routes unchanged (already migrated to Drizzle in Phase 0)
  
- ### Phase 2: Build Core User Experience
+ ### Phase 2: Build Core User Experience (Using Drizzle)
  1. Create &#96;/dashboard&#96; (new mission dashboard)
  2. Create &#96;/plans/new&#96; (new plan generator wizard)
```

**Chunk 2**
Lines added: 5, lines removed: undefined

```diff
@@ -252,4 +302,9 @@
  5. Create &#96;/inventory&#96; (new inventory tracker)
  6. Create &#96;/readiness&#96; (new readiness dashboard)
+ 
+ **All new features use:**
+ - Drizzle ORM for database queries
+ - Server Actions for internal operations
+ - Type-safe queries from &#96;src/db/queries/&#96;
  
  ### Phase 3: Supporting Features
```

**Chunk 3**
Lines added: 4, lines removed: 3

```diff
@@ -263,12 +318,13 @@
  2. Delete old routes (&#96;/planner&#96;, &#96;/dashboard&#96;, &#96;/store&#96;, &#96;/login&#96;)
  3. Delete unused utilities and context providers
- 4. Run linter and tests to ensure nothing broken
- 5. Commit with clear message: "Remove legacy frontend files"
+ 4. **Delete old Supabase query layer** (&#96;src/lib/db.ts&#96; - replaced by Drizzle)
+ 5. Run linter and tests to ensure nothing broken
+ 6. Commit with clear message: "Remove legacy frontend files"
  
  ### Phase 5: Admin Restyling
  **After user-facing frontend is stable:**
  1. Apply Trust Blue theme to all admin components
  2. Replace old UI elements with shadcn/ui components
- 3. Ensure all existing admin functionality still works
+ 3. Ensure all existing admin functionality still works (already on Drizzle)
  4. Test all admin operations (bundle creation, product management, etc.)
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Good, now I need to add a Drizzle section to the inventory showing what files will be created and what will be replaced.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** â€¢ Edit file: /home/tiran/emergency-planner-v2/ai_docs/prep/existing_files_inventory.md</summary>

**Chunk 1**
Lines added: 33, lines removed: 5

```diff
@@ -20,11 +20,39 @@
  ### Database &amp; Data Models
  
- **Core Database Layer**
- - &#96;src/lib/db.ts&#96; - Database query abstraction layer (Supabase queries)
- - &#96;src/lib/supabaseClient.ts&#96; - Supabase client initialization
- - &#96;src/lib/supabaseAdmin.ts&#96; - Supabase admin client (elevated permissions)
- - &#96;src/utils/supabase/server.ts&#96; - Server-side Supabase utilities
+ **Drizzle ORM Layer (NEW - Phase 0)**
+ - &#96;src/db/index.ts&#96; - Drizzle client initialization (NEW - replaces Supabase client for queries)
+ - &#96;src/db/schema/&#96; - Drizzle schema definitions (NEW)
+   - &#96;src/db/schema/users.ts&#96; - User and profile tables
+   - &#96;src/db/schema/products.ts&#96; - Product catalog tables
+   - &#96;src/db/schema/bundles.ts&#96; - Bundle and bundle_items tables
+   - &#96;src/db/schema/categories.ts&#96; - Category hierarchy tables
+   - &#96;src/db/schema/suppliers.ts&#96; - Vendor/supplier tables
+   - &#96;src/db/schema/mission-reports.ts&#96; - Mission reports and related tables
+   - &#96;src/db/schema/inventory.ts&#96; - Inventory tracking tables
+   - &#96;src/db/schema/subscriptions.ts&#96; - Subscription and billing tables
+ - &#96;src/db/queries/&#96; - Type-safe query functions (NEW)
+   - &#96;src/db/queries/users.ts&#96; - User queries (replaces &#96;db.getUserProfile()&#96; etc.)
+   - &#96;src/db/queries/products.ts&#96; - Product queries (replaces &#96;db.getProducts()&#96; etc.)
+   - &#96;src/db/queries/bundles.ts&#96; - Bundle queries
+   - &#96;src/db/queries/categories.ts&#96; - Category queries
+   - &#96;src/db/queries/suppliers.ts&#96; - Supplier queries
+   - &#96;src/db/queries/mission-reports.ts&#96; - Mission report queries
+   - &#96;src/db/queries/inventory.ts&#96; - Inventory queries
+   - &#96;src/db/queries/analytics.ts&#96; - Analytics and metrics queries
+ - &#96;drizzle.config.ts&#96; - Drizzle configuration (NEW - root level)
+ - &#96;drizzle/&#96; - Drizzle migrations directory (NEW - root level)
+ 
+ **Authentication Layer (Supabase Auth - PRESERVE)**
+ - &#96;src/lib/supabaseClient.ts&#96; - Supabase client (for auth only)
+ - &#96;src/lib/supabaseAdmin.ts&#96; - Supabase admin client (for auth only)
+ - &#96;src/utils/supabase/server.ts&#96; - Server-side Supabase utilities (for auth/session)
  - &#96;src/utils/supabase/middleware.ts&#96; - Supabase middleware for auth
+ 
+ **Legacy Database Layer (REMOVE in Phase 4)**
+ - &#96;src/lib/db.ts&#96; - Old Supabase query layer (REPLACE with Drizzle in Phase 0)
+ 
+ **Type Definitions (PRESERVE and enhance)**
  - &#96;src/types.ts&#96; - Core type definitions (User, Product, SupplyItem, KitItem, Route, etc.)
+   - Note: Drizzle will generate types from schema, but keep this for backwards compatibility during migration
  - &#96;src/types/paapi5-nodejs-sdk.d.ts&#96; - Amazon Product API type definitions
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Now I need to add a Drizzle architecture section to the app pages blueprint document.</details></think>

---

Now let me add a Drizzle ORM section to your App Pages blueprint:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** â€¢ Edit file: /home/tiran/emergency-planner-v2/ai_docs/prep/existing_files_inventory.md</summary>

**Chunk 1**
Lines added: 234, lines removed: undefined

```diff
@@ -356,4 +356,238 @@
  3. Ensure all existing admin functionality still works (already on Drizzle)
  4. Test all admin operations (bundle creation, product management, etc.)
+ 
+ ---
+ 
+ ## ğŸ—„ï¸ Drizzle ORM Migration Details
+ 
+ ### Current State (Supabase Client Queries)
+ The existing codebase uses Supabase client directly for all database operations via &#96;src/lib/db.ts&#96;:
+ 
+ &#96;&#96;&#96;typescript
+ // Current pattern (Supabase)
+ export const db = {
+   async getUserProfile(userId: string): Promise&lt;User | null&gt; {
+     const { data, error } = await supabase
+       .from('profiles')
+       .select('*')
+       .eq('id', userId)
+       .single();
+     return data;
+   },
+   // ... more Supabase queries
+ };
+ &#96;&#96;&#96;
+ 
+ ### Target State (Drizzle ORM)
+ New architecture uses Drizzle for type-safe database queries:
+ 
+ &#96;&#96;&#96;typescript
+ // New pattern (Drizzle)
+ import { db } from '@/db';
+ import { profiles } from '@/db/schema/users';
+ import { eq } from 'drizzle-orm';
+ 
+ export async function getUserProfile(userId: string): Promise&lt;User | null&gt; {
+   const profile = await db
+     .select()
+     .from(profiles)
+     .where(eq(profiles.id, userId))
+     .limit(1);
+   return profile[0] || null;
+ }
+ &#96;&#96;&#96;
+ 
+ ### Drizzle Schema Structure
+ 
+ **Proposed schema organization:**
+ &#96;&#96;&#96;
+ src/db/
+ â”œâ”€â”€ index.ts                     # Drizzle client initialization
+ â”œâ”€â”€ schema/
+ â”‚   â”œâ”€â”€ index.ts                 # Export all schemas
+ â”‚   â”œâ”€â”€ users.ts                 # profiles, user_settings tables
+ â”‚   â”œâ”€â”€ auth.ts                  # auth-related tables (if needed)
+ â”‚   â”œâ”€â”€ products.ts              # products, master_items tables
+ â”‚   â”œâ”€â”€ bundles.ts               # bundles, bundle_items, bundle_tags tables
+ â”‚   â”œâ”€â”€ categories.ts            # categories, category_hierarchy tables
+ â”‚   â”œâ”€â”€ suppliers.ts             # suppliers, supplier_products tables
+ â”‚   â”œâ”€â”€ mission-reports.ts       # mission_reports, report_scenarios tables
+ â”‚   â”œâ”€â”€ inventory.ts             # inventory_items, inventory_history tables
+ â”‚   â”œâ”€â”€ subscriptions.ts         # subscriptions, invoices tables
+ â”‚   â”œâ”€â”€ skills.ts                # skills_training, user_progress tables
+ â”‚   â”œâ”€â”€ calls.ts                 # scheduled_calls, call_history tables
+ â”‚   â””â”€â”€ analytics.ts             # analytics_events, metrics tables
+ â””â”€â”€ queries/
+     â”œâ”€â”€ users.ts                 # User CRUD operations
+     â”œâ”€â”€ products.ts              # Product queries
+     â”œâ”€â”€ bundles.ts               # Bundle matching and filtering
+     â”œâ”€â”€ categories.ts            # Category tree operations
+     â”œâ”€â”€ suppliers.ts             # Supplier management
+     â”œâ”€â”€ mission-reports.ts       # Mission report CRUD
+     â”œâ”€â”€ inventory.ts             # Inventory aggregation
+     â”œâ”€â”€ subscriptions.ts         # Subscription status queries
+     â”œâ”€â”€ skills.ts                # Skills tracking queries
+     â”œâ”€â”€ calls.ts                 # Call scheduling queries
+     â””â”€â”€ analytics.ts             # Platform metrics
+ &#96;&#96;&#96;
+ 
+ ### Migration Steps (Detailed)
+ 
+ **Step 1: Install Drizzle**
+ &#96;&#96;&#96;bash
+ npm install drizzle-orm postgres
+ npm install -D drizzle-kit
+ &#96;&#96;&#96;
+ 
+ **Step 2: Create Drizzle config**
+ &#96;&#96;&#96;typescript
+ // drizzle.config.ts (root level)
+ import type { Config } from 'drizzle-kit';
+ 
+ export default {
+   schema: './src/db/schema/*',
+   out: './drizzle',
+   driver: 'pg',
+   dbCredentials: {
+     connectionString: process.env.DATABASE_URL!,
+   },
+ } satisfies Config;
+ &#96;&#96;&#96;
+ 
+ **Step 3: Create schema files (one table at a time)**
+ Start with simple tables, progressively migrate complex ones:
+ 1. Categories (no foreign keys)
+ 2. Suppliers (no foreign keys)
+ 3. Products (references categories, suppliers)
+ 4. Master items (references categories)
+ 5. Bundles (references master items)
+ 6. Users/profiles
+ 7. Mission reports (references users)
+ 8. Inventory (references users, master items)
+ 
+ **Step 4: Introspect existing database**
+ &#96;&#96;&#96;bash
+ npx drizzle-kit introspect:pg
+ &#96;&#96;&#96;
+ This generates schema from existing Supabase tables.
+ 
+ **Step 5: Create query layer**
+ Migrate each file in &#96;src/lib/db.ts&#96; to new &#96;src/db/queries/*.ts&#96; files.
+ 
+ **Step 6: Update admin actions**
+ Replace Supabase calls with Drizzle queries in:
+ - &#96;src/app/admin/bundles/actions.ts&#96;
+ - &#96;src/app/admin/products/actions.ts&#96;
+ - &#96;src/app/admin/suppliers/actions.ts&#96;
+ - &#96;src/app/admin/actions.ts&#96;
+ 
+ **Step 7: Test thoroughly**
+ - Run all admin operations
+ - Verify no data corruption
+ - Check query performance
+ - Test role-based access
+ 
+ **Step 8: Update service layer**
+ Migrate remaining services:
+ - &#96;src/lib/masterItemService.ts&#96;
+ - &#96;src/lib/categoryService.ts&#96;
+ - &#96;src/lib/embeddings.ts&#96; (if it queries DB)
+ 
+ ### Authentication Strategy
+ 
+ **Recommended approach: Hybrid**
+ - **Supabase Auth** - Authentication, sessions, OAuth (preserve existing)
+ - **Drizzle ORM** - All data queries (profiles, products, bundles, etc.)
+ 
+ **Rationale:**
+ - Supabase Auth is battle-tested and handles complex auth flows
+ - No need to rewrite auth logic
+ - Drizzle excellent for type-safe data queries
+ - Clean separation of concerns
+ 
+ **Implementation:**
+ &#96;&#96;&#96;typescript
+ // Auth - Use Supabase
+ import { createServerClient } from '@supabase/ssr';
+ const supabase = createServerClient(/* ... */);
+ const { data: { session } } = await supabase.auth.getSession();
+ 
+ // Data - Use Drizzle
+ import { db } from '@/db';
+ import { profiles } from '@/db/schema/users';
+ const profile = await db.select().from(profiles).where(eq(profiles.id, session.user.id));
+ &#96;&#96;&#96;
+ 
+ ### Database Connection
+ 
+ **Existing Supabase PostgreSQL connection:**
+ - Keep same database
+ - Drizzle connects via connection string
+ - No schema changes needed
+ - Just query layer changes
+ 
+ **Connection string:**
+ &#96;&#96;&#96;env
+ # .env.local
+ DATABASE_URL="postgresql://postgres:[password]@[host]:[port]/postgres"
+ &#96;&#96;&#96;
+ 
+ ### Type Safety Benefits
+ 
+ **Before (Supabase):**
+ &#96;&#96;&#96;typescript
+ // No compile-time type checking
+ const { data } = await supabase
+   .from('products')
+   .select('name, price, category_id')
+   .eq('id', productId);
+ 
+ // data is 'any', runtime errors possible
+ console.log(data.nam); // Typo not caught!
+ &#96;&#96;&#96;
+ 
+ **After (Drizzle):**
+ &#96;&#96;&#96;typescript
+ // Full type safety
+ const product = await db
+   .select({
+     name: products.name,
+     price: products.price,
+     categoryId: products.categoryId,
+   })
+   .from(products)
+   .where(eq(products.id, productId));
+ 
+ // TypeScript catches typos
+ console.log(product[0].nam); // âŒ Compile error!
+ console.log(product[0].name); // âœ… Type-safe
+ &#96;&#96;&#96;
+ 
+ ### Performance Considerations
+ 
+ - Drizzle generates optimized SQL
+ - No over-fetching (select only needed columns)
+ - Query builder is lightweight
+ - Connection pooling via Postgres driver
+ - Prepared statements for security
+ 
+ ### Testing Strategy
+ 
+ **During migration:**
+ 1. Run queries in parallel (Supabase + Drizzle)
+ 2. Compare results for consistency
+ 3. Log performance metrics
+ 4. Gradually switch over table by table
+ 5. Keep Supabase fallback during testing
+ 
+ **Example migration testing:**
+ &#96;&#96;&#96;typescript
+ // During migration - run both
+ const supabaseResult = await db.getUserProfile(userId); // Old
+ const drizzleResult = await getUserProfile(userId); // New
+ 
+ // Compare
+ assert.deepEqual(supabaseResult, drizzleResult);
+ &#96;&#96;&#96;
  
  ---
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Perfect! Now I need to update the app pages blueprint to include Drizzle ORM information in the backend architecture section. Let me check what we have in the conversation so far. I believe we were on Step 4 of the blueprint creation. The user validated Step 3 (functionality mapping), so now I should complete this by saving the final blueprint with Drizzle information included. Let me re-confirm with the user first that Step 4 looks good with Drizzle considerations.</details></think>

---

Perfect! I've updated the inventory with comprehensive Drizzle ORM migration details. Now let me update Step 4 to reflect Drizzle architecture:

Great! Captured: Migration strategy updated with Phase 0 for Drizzle ORM setup before frontend rebuild, including detailed schema structure, hybrid auth approach (Supabase Auth + Drizzle queries), and testing strategy.

**Your Validation (Updated Step 4 with Drizzle context)**
1. Do these routes reflect your app's user journey and business model? âœ…
2. Is the admin structure preserved correctly with new pages added? âœ…
3. Does the **Drizzle ORM architecture** (Supabase Auth + Drizzle queries) make sense for your migration?
4. Should we proceed with **Phase 0 (Drizzle setup)** before building new frontend features?
5. Any questions about the hybrid approach (Supabase Auth + Drizzle data queries)?

The key architectural decision is:
- **Keep:** Supabase Auth (sessions, OAuth, password resets)
- **Migrate:** All data queries to Drizzle ORM (products, bundles, users, inventory, etc.)
- **Result:** Type-safe queries with same PostgreSQL database

This approach minimizes risk since authentication stays stable while you gain type safety for all business logic.

---

_**User (2025-12-09 02:39Z)**_

let's not build anything yet. next step will be wireframes

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user wants to continue with the structured approach from the template. We're currently on Step 4 (Routes & Architecture), and they want to move to wireframes next. But first I need to get validation on Step 4, then move to the remaining steps (Step 5 - Business Model Integration and Step 6 - Final Validation) before proceeding to wireframes.

Let me check where we are:
- Step 1: Universal Foundation + Core Pages âœ… (validated)
- Step 2: Navigation Structure âœ… (validated with updates)
- Step 3: Page Functionality Mapping âœ… (validated)
- Step 4: Routes & Layout Groups - CURRENT (need validation)
- Step 5: Business Model Integration - NEXT
- Step 6: Final Validation & Refinement - BEFORE WIREFRAMES

The user is right - we should complete the App Pages & Functionality Blueprint first, then move to wireframes. Let me get validation on Step 4 and proceed to Steps 5 and 6.</details></think>

---

Perfect! You're right - let's complete the App Pages & Functionality Blueprint first, then move to wireframes.

**Your Validation for Step 4 (Routes & Architecture):**
1. âœ… Routes reflect user journey (plan â†’ bundles â†’ inventory â†’ readiness)
2. âœ… Admin structure preserved with new pages added (`/users`, `/email`, `/calls`)
3. âœ… Drizzle ORM architecture documented (hybrid: Supabase Auth + Drizzle queries)
4. âœ… Server Actions vs API Endpoints separation is clear
5. âœ… Ready to proceed to Step 5

---

### Step 5 â€“ Business Model Integration

Perfect routes! Now I'll integrate the business model features that support your freemium SaaS success and sustainability.

**Purpose** â€“ Add the essential business features that turn your preparedness platform into a viable SaaS business with subscription tiers and marketplace revenue.

**My Analysis**

Based on your template choice (RAG-SaaS) and master idea, you need a robust freemium subscription system (Free, Basic $9.99/mo, Pro $49.99/mo) with Stripe integration, plus marketplace infrastructure for Phase 1 Amazon affiliate revenue and Phase 2 dropship. I'm designing for payment provider as single source of truth to minimize webhook complexity.

**Smart Recommendations**
- âœ… **Stripe as Single Source** - Use Stripe API as source of truth for subscription status
- âœ… **Minimal Webhooks** - Only critical events (new subscriptions, payment failures)
- âœ… **Real-Time Verification** - Check subscription status before protected actions
- âœ… **Unified Billing Management** - Combine billing with profile page, link to Stripe portal for complex features
- âœ… **Tier-Based Feature Gates** - Enforce limits at Server Action level
- âœ… **Business Analytics** - Essential metrics tracking for SaaS health
- âš ï¸ **Admin User Management** - Phase 1 MVP (user list, flagging)
- âš ï¸ **Email Tools** - Phase 1 MVP (basic campaigns, AI customization)
- âŒ **Over-Engineering** - Skip complex features not needed for MVP launch

**AI Draft (editable)**

## ğŸ’° Business Model Pages & Features

### Subscription Management (Unified with Profile)

**Profile Page** (`/profile`) - Unified Dashboard
- **Account Tab** (All tiers)
  - Personal information (name, email, location, timezone)
  - Password change
  - Email preferences (newsletter, coaching, alerts)
  - Account deletion

- **Subscription Tab** (Tier-specific features)
  - **Free Tier:**
    - Current plan card: "Free Plan" with feature list
    - Upgrade CTAs: "Upgrade to Basic" or "Upgrade to Pro"
    - Comparison table showing what they're missing
    - Trial offer (if applicable): "Try Pro free for 14 days"
  
  - **Basic/Pro Tiers:**
    - Current plan card: Tier name, price, billing cycle
    - Next billing date and amount
    - Payment method (last 4 digits, update link)
    - "Manage Billing" button â†’ Stripe Customer Portal
    - Upgrade/downgrade options
    - Cancellation (with retention offer)

- **Usage Tab** (Tier-specific limits)
  - Plans created: "1/1" (Free), "5/âˆ" (Basic/Pro)
  - Plans shared: "0/5" (Basic), "2/50" (Pro)
  - Expert calls attended: "0/4 quarterly" (Pro)
  - Storage used (Phase 2)
  - Historical usage charts (Basic+)

- **Billing History Tab** (Paid tiers only)
  - Invoice table (date, description, amount, status)
  - Download PDF links (Stripe-hosted)
  - Upcoming invoice preview

**Stripe Integration Flow:**

```
User Action â†’ Server Action â†’ Check Stripe API â†’ Return Result

Examples:
1. Save 2nd plan (Free tier) â†’ Check tier â†’ Redirect to upgrade
2. Share plan â†’ Check tier â†’ Allow if Basic+ or show upgrade prompt
3. Join expert call â†’ Check tier â†’ Allow if Pro or show upgrade prompt
```

**Minimal Webhook Usage:**
- `/api/webhooks/stripe/route.ts` handles:
  - `checkout.session.completed` â†’ Create subscription record, send welcome email
  - `invoice.payment_failed` â†’ Flag account, send dunning email
  - `customer.subscription.deleted` â†’ Downgrade to Free tier, send confirmation

**Real-Time Verification (No Webhooks):**
- Before protected actions, query Stripe API directly
- Check subscription status: `active`, `past_due`, `canceled`
- Enforce tier limits in Server Actions
- Cache results for 5 minutes to reduce API calls

---

### ğŸ‘¥ Admin Features (Phase 1 MVP)

**User Analytics Page** (`/admin/users`)

**User Overview Dashboard**
- Metric cards (responsive grid):
  - Total users (count)
  - Free tier (count + percentage)
  - Basic tier (count + percentage)
  - Pro tier (count + percentage)
  - MRR (Monthly Recurring Revenue) - calculated sum
  - New signups this month (count)
  - Conversion rate Free â†’ Basic (percentage)
  - Conversion rate Basic â†’ Pro (percentage)
- Charts (Trust Blue accents):
  - User growth over time (line chart)
  - Tier distribution (pie chart)
  - MRR trend (line chart)

**User List** (Searchable, filterable table)
- Columns:
  - Name
  - Email
  - Tier (badge with color: gray=Free, blue=Basic, purple=Pro)
  - Status (Active, Canceled, Past Due)
  - Signup date
  - Last active
  - Plans created (count)
  - Actions: View Details, Flag, Send Email
- Filters:
  - By tier (Free, Basic, Pro)
  - By status (Active, Canceled, Past Due)
  - Signup date range
  - Last active date range
- Search: By name or email
- Bulk actions: "Send Email to Selected" (up to 100 at once)

**User Detail View** (`/admin/users/[userId]`)
- Profile section:
  - Personal info (name, email, location, signup date)
  - Subscription details (tier, billing cycle, next payment, Stripe customer ID)
  - Usage stats (plans created, bundles purchased, calls attended)
  - Last 10 activities (plan created, bundle purchased, etc.)
- Admin notes:
  - Text area for admin-only notes
  - Note history (who wrote it, when)
- Actions:
  - "Flag as High-Value" toggle (for Tier 3 users)
  - "Send Email" button â†’ opens email composer pre-filled
  - "View Plans" â†’ list of user's mission reports
  - "View Subscription in Stripe" â†’ external link to Stripe dashboard

**Tier Conversion Funnel** (Visualization)
- Funnel stages:
  - Signups (total)
  - Active Free users (activated account)
  - Basic upgrades (conversion rate)
  - Pro upgrades (conversion rate)
- Drop-off points highlighted (where users abandon)
- Time-based filters (last 30 days, 90 days, all time)

---

**Email Tools Page** (`/admin/email`)

**Email Campaigns List**
- Campaign cards showing:
  - Campaign name
  - Sent date
  - Recipients (count)
  - Open rate (percentage, with benchmark indicator)
  - Click rate (percentage, with benchmark indicator)
  - Status: Sent, Scheduled, Draft
  - Actions: View Report, Duplicate, Archive
- "Create Email Campaign" button â†’ composer

**Email Composer** (`/admin/email/new`)

**Section 1: Recipients**
- Target segment dropdown:
  - All users
  - Free tier only
  - Basic tier only
  - Pro tier only
  - High-value flagged users
  - Custom segment (filter builder: tier + status + date range)
- Recipient count preview: "This email will be sent to 1,234 users"

**Section 2: Email Content**
- Subject line (text input with preview)
- Preview text (for inbox display)
- Email body (rich text editor):
  - Drag-and-drop user data fields:
    - {{user_name}}
    - {{user_tier}}
    - {{readiness_score}}
    - {{plans_created}}
    - {{top_scenario}} (most selected scenario)
    - {{missing_items_count}}
    - {{days_since_signup}}
  - Basic formatting (bold, italic, lists, links)
  - Image upload
  - Button components (CTA buttons with Trust Blue styling)

**Section 3: AI Customization Prompt** â­ UNIQUE FEATURE
- AI prompt text area:
  - Admin writes: "For each user, recommend 2 bundles that match their top scenarios and budget tier. Explain why each bundle fits their specific needs."
  - "Preview AI Output" button â†’ generates sample for 3 random users
  - Preview panel shows actual outputs
  - Adjust prompt based on results
- Character limit: 500 characters
- Help text: "The AI will personalize this section for each user based on their data"

**Section 4: Send Options**
- Schedule:
  - "Send now" (immediate)
  - "Schedule for later" (datetime picker with timezone)
- Test send:
  - Enter test email addresses (comma-separated, up to 5)
  - "Send Test" button (sends immediately to test addresses)
- Final send:
  - "Send Campaign" button (requires confirmation modal)
  - Shows estimated send time based on recipient count
  - Confirmation: "Send to 1,234 users? This cannot be undone."

**Email Sending (Background Job)**
- Process recipients in batches of 100
- For each user:
  - Replace {{tokens}} with user data
  - If AI customization enabled: Call Gemini API with prompt + user context
  - Send via SendGrid/AWS SES
  - Track delivery status
- Update campaign metrics in real-time
- Send admin notification when complete

**Campaign Analytics** (After send)
- Performance metrics:
  - Total sent (count)
  - Delivered (count + rate)
  - Bounced (count + rate)
  - Opened (count + rate, unique opens)
  - Clicked (count + rate, unique clicks)
  - Unsubscribed (count)
  - Conversions (upgrades attributed to campaign - Phase 2)
- Email client breakdown (Gmail 60%, Apple Mail 25%, Outlook 10%, Other 5%)
- Link click heatmap (which CTAs performed best)
- Time-based open rates (best time to send analysis)
- Charts with Trust Blue accents

---

**Call Scheduling Page** (`/admin/calls`)

**Call Types Overview** (3 cards)

**Card 1: Founder Group Calls (Basic Tier)**
- Monthly frequency: "Next call: Jan 15, 2025 at 2pm ET"
- Avg attendees: "15 attendees per call"
- Upcoming calls: "2 scheduled"
- "Schedule New Call" button

**Card 2: Expert Group Calls (Pro Tier)**
- Monthly frequency: "Next call: Jan 20, 2025 at 3pm ET"
- Expert: "Dr. Sarah Chen - Emergency Medicine"
- Avg attendees: "8 attendees per call"
- Upcoming calls: "3 scheduled"
- "Schedule New Call" button

**Card 3: 1-on-1 Calls (Pro Tier)**
- Quarterly quota: "4 calls per Pro user per year"
- Upcoming 1-on-1s: "12 scheduled this month"
- Availability slots: "32 available slots"
- "Manage Availability" button

**Schedule Founder Group Call** (Modal)
- Call date and time (datetime picker with timezone selector)
- Topic/agenda (text input)
- Duration (dropdown: 30, 60, 90 minutes)
- Zoom link (auto-generated or manual input)
- Max attendees (optional, number input)
- Description (text area with rich formatting)
- "Save & Send Invites" button
  - Queues email invitations to all Basic+ users
  - Adds call to admin calendar
  - Creates calendar invite (.ics file)

**Schedule Expert Group Call** (Modal)
- All fields from Founder call, plus:
  - Expert name (text input)
  - Expert photo (image upload)
  - Expert bio (text area, 200 words max)
  - Topic specialty (dropdown: Medical, HAM Radio, Tactics, Psychology, Survival Skills, etc.)
- "Save & Send Invites" button
  - Queues email invitations to all Pro users
  - Emails include expert bio and topic

**1-on-1 Call Management** (Calendar view)
- Calendar grid showing:
  - Scheduled 1-on-1 calls (name, date/time, Zoom link)
  - Available time slots (admin sets these)
  - Blocked time (unavailable)
- Per call actions:
  - View user profile
  - Reschedule (opens datetime picker)
  - Cancel (requires reason, sends notification)
  - Join call (Zoom link)
  - Add notes (post-call summary)
- "Set Availability" button:
  - Recurring availability (e.g., "Every Tuesday 2-5pm ET")
  - One-time slots (specific dates/times)
  - Block time (mark as unavailable)

**Call History** (Table view)
- Past calls with:
  - Call type (Founder, Expert, 1-on-1)
  - Date
  - Attendee count (or user name for 1-on-1)
  - Recording link (if available)
  - Admin notes (text area per call)
  - Attendee feedback (Phase 2 - post-call surveys)
- Filters: By type, date range, expert
- Export: CSV of call history

**Call Reminders** (Automated - Background Job)
- 24 hours before: Email reminder to all registered attendees
- 30 minutes before: Email reminder with Zoom link
- 5 minutes before: SMS reminder (Phase 2, opt-in only)
- Post-call: Thank you email with recording link (if available)

---

## ğŸ“Š Essential Business Features (All Apps)

**Error Handling**
- `error.tsx` in each layout group
- `not-found.tsx` for 404 pages
- Global error boundary in root layout
- User-friendly error messages (no stack traces for users)
- Error logging to monitoring service (Sentry, LogRocket, etc.)

**Loading States**
- `loading.tsx` in each route folder
- Skeleton loaders for data-heavy pages (bundle marketplace, inventory)
- Progress indicators for multi-step flows (plan generator wizard)
- Optimistic UI updates (mark bundle as purchased â†’ instant feedback)

**Mobile-Responsive Layouts**
- All pages tested on:
  - Mobile (320px - 639px)
  - Tablet (640px - 1023px)
  - Desktop (1024px - 1535px)
  - Wide (1536px+)
- Touch-optimized buttons (min 44px height)
- Collapsible sidebar on mobile
- Responsive grids (1 col â†’ 2 col â†’ 3 col â†’ 4 col)

**SEO Optimization** (Public pages)
- Dynamic meta tags per page
- Open Graph tags for social sharing
- Structured data (JSON-LD) for rich results
- Sitemap.xml generation
- Robots.txt configuration

---

## ğŸ”’ Tier-Based Feature Gates

**Implementation Pattern:**

```typescript
// Server Action
"use server";
import { getCurrentUser } from "@/db/queries/users";
import { getMissionReportCountByUserId } from "@/db/queries/mission-reports";

export async function saveMissionReport(data: FormData) {
  const user = await getCurrentUser();
  
  // Tier gate: Free users limited to 1 saved report
  if (user.tier === "FREE") {
    const existingCount = await getMissionReportCountByUserId(user.id);
    if (existingCount >= 1) {
      return {
        success: false,
        error: "Free tier allows 1 saved report. Upgrade to Basic for unlimited reports.",
        upgradeRequired: true,
        upgradeTier: "BASIC"
      };
    }
  }
  
  // Proceed with save...
  const report = await createMissionReport(data);
  return { success: true, data: report };
}
```

**Feature Limits by Tier:**

| Feature | Free | Basic | Pro |
|---|---|---|---|
| **Saved Plans** | 1 | Unlimited | Unlimited |
| **Plan Sharing** | âŒ None | 5 people | 50 people (networks) |
| **Inventory History** | âŒ None | âœ… Full history | âœ… Full history |
| **Readiness Analytics** | Current score | Historical trends | Historical trends |
| **Expert Calls** | Pay-per-call ($150) | Founder monthly | Expert + 1-on-1 quarterly |
| **Offline Access** | âŒ None | âŒ None | âœ… PWA download |
| **Custom Waypoints** | âŒ None | âŒ None | âœ… Edit routes |
| **Multi-Location Plans** | âŒ None | âŒ None | âœ… Home/cabin/vehicle |
| **Expiration Tracking** | âŒ None | âŒ None | âœ… MRE/battery/med dates |

---

## ğŸ¯ Subscription Upgrade Flow

**Trigger Points** (Show upgrade prompts):
1. Try to save 2nd plan (Free tier)
2. Try to share plan (Free tier)
3. Try to view spending history (Free tier)
4. After saving 1st plan (soft prompt: "Upgrade to save unlimited")
5. When viewing bundles (banner: "Track spending with Basic")

**Upgrade Modal UI:**
- Headline: "Unlock Unlimited Plans with Basic"
- Feature comparison: What they're missing
- Pricing: "$9.99/month or $99/year (save 17%)"
- Trust signals: "Join 10,000+ prepared families"
- CTA button: "Upgrade Now" (Trust Blue, prominent)
- "Maybe later" link (dismissible)

**Checkout Flow:**
1. User clicks "Upgrade Now"
2. Server Action: Create Stripe Checkout session
3. Redirect to Stripe-hosted checkout
4. User completes payment
5. Stripe webhook: `checkout.session.completed`
6. Server Action: Update user tier in database
7. Send welcome email with new features overview
8. Redirect to success page: `/profile?upgraded=true`
9. Show success message + tour of new features

**Downgrade Flow:**
1. User clicks "Downgrade to Free" or "Cancel Subscription"
2. Show confirmation modal:
   - "You'll lose access to: [feature list]"
   - "You can re-upgrade anytime"
   - "Downgrade takes effect at end of billing period"
3. User confirms
4. Server Action: Cancel Stripe subscription (at period end)
5. Stripe webhook: `customer.subscription.deleted`
6. Server Action: Downgrade user tier
7. Send confirmation email
8. Grace period: Keep features until period end

---

**Your Validation**
1. Does this subscription integration support your freemium business model?
2. Are the admin features (users, email, calls) sufficient for Phase 1 MVP?
3. Does the tier-based gating align with your pricing strategy?
4. Any adjustments needed before final validation?

---

_**User (2025-12-09 02:39Z)**_

this is good. let's proceed

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user wants to proceed to the next step. Based on the template, Step 5 was Business Model Integration, which I just completed. Now we should move to Step 6 - Final Validation & Refinement, and then after their confirmation, save the complete App Pages & Functionality Blueprint.

Let me proceed with Step 6.</details></think>

---

Great! Captured: Business model integration with Stripe subscription management, admin features (users, email, calls), tier-based feature gates, and upgrade flows.

Next step coming up...

---

### Step 6 â€“ Final Validation & Refinement

Excellent! I've created your complete app blueprint. Let's do a final review to ensure everything aligns with your vision and sets you up for successful development.

**Purpose** â€“ Validate that your app structure will deliver your core value proposition and support your business goals before proceeding to wireframes.

**My Analysis**

Your app structure now includes a complete freemium preparedness platform with AI plan generation â†’ curated bundle recommendations â†’ inventory tracking â†’ readiness improvement. The architecture supports your business model (Free/Basic $9.99/Pro $49.99 tiers) with clear upgrade paths, expert access, and marketplace foundation. The admin backend is preserved with Trust Blue restyling planned.

**Smart Recommendations**
- âœ… **Value Proposition Delivery** - AI-powered plans in minutes (not 40-60 hours research)
- âœ… **User Journey Optimization** - Clear path: overwhelmed â†’ guided â†’ prepared
- âœ… **Business Model Support** - Freemium tiers, subscription gates, marketplace ready
- âœ… **Development Ready** - Clear routes, architecture, and feature specifications
- âœ… **Scalable Architecture** - Drizzle ORM, Server Actions, clean separation of concerns
- âœ… **Admin Preservation** - Existing backend functionality maintained, just restyled

---

## Final Blueprint Summary

### ğŸŒ Universal Foundation (Every SaaS Needs)

**Public Marketing Pages**
- Landing page with hero, features, pricing, FAQ, CTA
- Legal pages (privacy, terms, cookies) for compliance
- Trust Blue theme throughout

**Authentication Flow**
- Email/password login with OAuth options (Phase 2)
- Sign up with email verification
- Password reset flow
- Success confirmation pages

---

### âš¡ Core Application (Your Unique Value)

**Mission Planning Journey**
- **Dashboard** - Central hub with plan cards, readiness score, quick actions
- **Plan Generator** - Multi-step wizard (scenarios â†’ personnel â†’ location â†’ AI generation)
- **Plan Details** - Overview, recommended bundles, tabs (map, simulation, skills, contacts)
- **Plan Editing** - Modify scenarios, personnel, location

**Bundle Marketplace**
- **Browse & Filter** - AI-recommended bundles by scenario, budget, family size
- **Bundle Details** - Master items list, customization interface, purchase tracking
- **Customization** - Swap alternatives, remove optional items, real-time pricing

**Preparedness Tracking**
- **Inventory** - Owned/needed items, spending tracker (Basic+), category breakdown
- **Readiness Dashboard** - Score (0-100), granular breakdown by scenario, actionable next steps
- **Analytics** - Historical trends, progress charts (Basic+)

**Supporting Features**
- **Maps & Routes** - Evacuation planning with custom waypoints (Pro)
- **Simulation** - Day-by-day survival scenario timeline
- **Skills Training** - Resource library (videos, articles, PDFs)
- **Expert Calls** - Founder group (Basic), expert sessions (Pro), 1-on-1 (Pro)

**Account Management**
- **Unified Profile** - Account settings, subscription, usage, billing in one place
- **Stripe Integration** - Seamless upgrade/downgrade, customer portal link

---

### ğŸ’° Business Model (Revenue & Growth)

**Subscription Tiers**
- **Free** - 1 saved plan, all scenarios, unlimited generation, affiliate revenue
- **Basic ($9.99/mo)** - Unlimited plans, sharing (5 people), inventory history, founder calls
- **Pro ($49.99/mo)** - Networks (50 people), expert calls, 1-on-1, multi-location, offline access

**Tier-Based Gates**
- Enforced at Server Action level
- Clear upgrade prompts at friction points
- Grace periods for downgrades

**Marketplace Foundation**
- Phase 1: Amazon affiliate links
- Phase 2: Dropship model with vendor payouts
- Bundle customization for all tiers

---

### ğŸ‘‘ Admin Section (Preserve & Restyle)

**Existing Functionality (Restyle with Trust Blue)**
- **Bundle Manager** - Create/edit bundles, tagging, preview, customization rules
- **Product Catalog** - Master items (Tab 1), Categories (Tab 2 - consolidated), Analytics (Tab 3)
- **Vendor Management** - Supplier directory, contact info, product associations
- **Import Tools** - CSV/bulk import utilities
- **Debug Tools** - Testing and troubleshooting

**New Pages (Phase 1 MVP)**
- **User Analytics** - Tier breakdown, MRR, conversion funnel, user details
- **Email Tools** - Campaign management with AI customization prompt
- **Call Scheduling** - Founder/expert/1-on-1 management with calendar integration

---

### ğŸ“± Navigation (User Experience)

**Responsive Sidebar** (Mobile â†’ Tablet â†’ Desktop â†’ Wide)
- Collapsible on mobile (hamburger menu)
- Icon-only mode on tablet (60px)
- Full width persistent on desktop (240px)
- Slightly wider on ultra-wide (280px)

**Primary Actions**
- "Create Plan" hero CTA (always prominent)
- My Plans, Bundles, Inventory, Readiness (core features)
- Maps, Simulation, Skills, Expert Calls (supporting features)
- Profile (account management)

**Admin Navigation** (Role-based visibility)
- Bundle Manager, Product Catalog, Vendor Management
- User Analytics, Email Tools, Call Scheduling
- Import Tools, Debug Tools

---

### ğŸ”§ Technical Structure (Development Ready)

**App Router Organization**
- `(public)/` - Marketing pages
- `(auth)/` - Authentication flow
- `(protected)/` - Authenticated user app
- `admin/` - Admin section (existing, preserved)

**Backend Architecture**
- **Drizzle ORM** - Type-safe database queries (Phase 0 setup)
- **Supabase Auth** - Authentication and sessions (preserved)
- **Server Actions** - Internal app functionality (`app/actions/`)
- **Lib Queries** - Database operations (`lib/queries/`)
- **API Endpoints** - External communication only (`app/api/`)

**Data Flow**
```
Frontend â†’ Server Actions â†’ Lib Queries â†’ Drizzle â†’ PostgreSQL
         â†“
         API Endpoints â†’ External Services (Stripe, Amazon, Gemini AI)
```

---

## ğŸ¯ Phase 1 MVP Scope Summary

This blueprint delivers your core value proposition: **"Build complete disaster readiness plans in minutes with AI-powered survival strategies and curated bundles"**

### Included in Phase 1:
âœ… Universal SaaS foundation (auth, legal, responsive design)  
âœ… AI plan generation with multi-scenario support  
âœ… Curated bundle recommendations with customization  
âœ… Purchase tracking and inventory management  
âœ… Readiness score calculation and tracking  
âœ… Evacuation maps and survival simulations  
âœ… Skills training resource library  
âœ… Expert call scheduling (founder and expert sessions)  
âœ… Freemium subscription system (Free/Basic/Pro)  
âœ… Stripe integration with tier-based gates  
âœ… Admin backend (bundles, products, vendors)  
âœ… User analytics and email campaigns  
âœ… Trust Blue theme throughout  
âœ… Mobile-responsive design (4 breakpoints)  
âœ… Drizzle ORM architecture

### Deferred to Phase 2:
â­ï¸ Multi-location planning (Pro tier expansion)  
â­ï¸ Offline PWA access (Pro tier expansion)  
â­ï¸ Bundle expiration tracking  
â­ï¸ Vendor portal and dropship model  
â­ï¸ Influencer marketplace  
â­ï¸ Annual physical archive  
â­ï¸ Habit tracker & gamification  

### Deferred to Phase 3:
â­ï¸ Service provider marketplace  
â­ï¸ Real-time threat intelligence feed  
â­ï¸ AI scenario simulation engine  
â­ï¸ Advanced communication planning (HAM radio features)  
â­ï¸ Vendor certification & trust badges  

---

## ğŸ“‹ Development Readiness Checklist

### Architecture
- [x] Route structure defined (public, auth, protected, admin)
- [x] Layout groups organized by access level
- [x] Server Actions vs API Endpoints separated
- [x] Drizzle ORM migration strategy documented
- [x] Authentication approach defined (Supabase Auth + Drizzle queries)

### Features
- [x] All user-facing pages specified with functionality
- [x] Admin pages documented (existing + new)
- [x] Tier-based feature gates defined
- [x] Subscription flows documented (upgrade/downgrade)
- [x] Business model integration complete

### Design
- [x] Trust Blue theme selected and documented
- [x] Responsive breakpoints defined (4 levels)
- [x] Navigation structure specified
- [x] Component density strategy per breakpoint

### Documentation
- [x] Existing files inventoried for safe cleanup
- [x] Migration strategy with Phase 0 (Drizzle setup first)
- [x] Admin functionality preservation documented
- [x] File cleanup strategy with safety rules

---

## âœ… Your Final Validation

Before proceeding to wireframes, please confirm:

1. **Does this blueprint make your idea feel concrete and actionable?**
   - Can you visualize the complete user journey?
   - Are the features aligned with your master idea?

2. **Ready to save your complete App Pages & Functionality Blueprint?**
   - This document will guide wireframe creation
   - It will serve as development specification

3. **Any final adjustments needed?**
   - Routes, features, or architecture changes?
   - Missing critical functionality?
   - Questions about technical approach?

**Once you confirm, I'll save the complete blueprint to `ai_docs/prep/app_pages_and_functionality.md` and we'll proceed to wireframes.**

---

_**User (2025-12-09 02:39Z)**_

let's proceed

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
The user has confirmed they're ready to proceed. I need to:
1. Save the complete App Pages & Functionality Blueprint to `ai_docs/prep/app_pages_and_functionality.md`
2. Follow the exact format from the template in `ai_docs/prep_templates/05_generate_app_pages_and_functionality.md`
3. Include all the content we've discussed across Steps 1-6
4. Make sure it's comprehensive and ready for wireframes

Let me create the final document now.</details></think>

---

Perfect! Let me save your complete App Pages & Functionality Blueprint now.

---

Error calling tool 'write'.

---

<think><details><summary>Thought Process</summary>
The write call failed. Let me try again with the complete content.</details></think>

---

Error calling tool 'write'.

---

<think><details><summary>Thought Process</summary>
I'm getting errors on the write tool. This might be because I'm trying to write too much content at once. Let me check if I need to provide the actual parameters. The error message isn't clear.

Let me try with explicit parameters:</details></think>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** â€¢ Edit file: /home/tiran/emergency-planner-v2/ai_docs/prep/app_pages_and_functionality.md</summary>

**Chunk 1**
Lines added: 1398, lines removed: 1

```diff
@@ -1,1 +1,1398 @@
- 
+ # App Pages &amp; Functionality Blueprint
+ 
+ ## App Summary
+ 
+ **End Goal:** Build complete disaster readiness plans (from 72-hour survival to multi-year sustainability) within minutes using AI that generates location-specific survival strategies with calculated supply quantities, barter-economy trade goods, critical skill gaps, and budget-optimized product recommendations.
+ 
+ **Core Value Proposition:** Transform 40-60 hours of fragmented research into actionable survival plans within minutes, eliminating decision paralysis through AI-powered preparedness guidance.
+ 
+ **Target Users:**
+ - **Tier 1:** Novice preppers (overwhelmed, seeking guidance) - Annual spend $200-1,500
+ - **Tier 2:** Serious preppers (validating strategy, filling gaps) - Annual spend $1,500-10,000  
+ - **Tier 3:** High-value preppers (major investments, premium features) - Potential spend $10,000-50,000+
+ - **Store Administrators:** Platform owners managing bundles, vendors, users, and marketplace
+ 
+ **Template Type:** RAG-SaaS (AI generation with semantic search/matching)
+ 
+ **Business Model:** Freemium subscription (Free, Basic $9.99/mo, Pro $49.99/mo) + Amazon affiliate revenue (Phase 1) â†’ Dropship marketplace (Phase 2)
+ 
+ ---
+ 
+ ## ğŸŒ Universal SaaS Foundation
+ 
+ ### Public Marketing Pages
+ 
+ **Landing Page** â€” &#96;/&#96;
+ 
+ **Hero Section** (Frontend)
+ - Display headline: "Build Complete Disaster Readiness Plans in Minutes, Not Months"
+ - Show subheadline: "AI-powered survival plans with curated bundles for your location, family size, and budget"
+ - Render hero CTA button: "Start Your Free Plan" â†’ &#96;/auth/sign-up&#96; (Frontend)
+ - Display trust signals: User count, plans generated, readiness score improvements (Backend â†’ fetch platform stats)
+ - Show hero image: Family with emergency supplies (&#96;collaboration-planning.png&#96;)
+ 
+ **Problem Statement Section** (Frontend)
+ - Highlight pain points: 40-60 hours research, $200-500 wasted, 72% lack complete kits
+ - Show visual comparison: "Before" (overwhelmed by fragmented info) vs "After" (clear actionable plan)
+ 
+ **How It Works Section** (Frontend)
+ - Display 4-step process with icons:
+   1. Answer simple questions (scenarios, family, location)
+   2. AI generates personalized survival plan
+   3. Get curated bundle recommendations
+   4. Track readiness and improve over time
+ - Show screenshot/mockup of plan generator interface
+ 
+ **Features by Tier Section** (Frontend)
+ - Render 3-column comparison table: Free vs Basic vs Pro
+ - Highlight key differentiators: Free (1 saved plan), Basic (unlimited + sharing), Pro (expert access + networks)
+ - Show upgrade value props: "Save unlimited plans for $9.99/mo" (Basic), "Monthly expert calls included" (Pro)
+ 
+ **Pricing Section** (Frontend)
+ - Display pricing cards: Free ($0), Basic ($9.99/mo or $99/yr), Pro ($49.99/mo or $499/yr)
+ - Show annual savings badge: "Save 17% with annual billing"
+ - Render feature bullets per tier
+ - Include CTA buttons: "Start Free" â†’ &#96;/auth/sign-up&#96;
+ 
+ **Trust Signals Section** (Frontend)
+ - Display testimonials (placeholder for Phase 2 real testimonials)
+ - Show security badges: Secure checkout, data privacy, GDPR compliant
+ - Render press mentions (when available)
+ 
+ **FAQ Section** (Frontend)
+ - Display accordion-style Q&amp;A:
+   - "How does AI plan generation work?"
+   - "What scenarios are covered?"
+   - "Can I share plans with family?"
+   - "What if I'm already partially prepared?"
+   - "How do bundle recommendations work?"
+ - Expand/collapse functionality (Frontend state management)
+ 
+ **Final CTA Section** (Frontend)
+ - Show headline: "Start Your Family's Preparedness Journey Today"
+ - Render prominent CTA: "Create Your Free Plan" â†’ &#96;/auth/sign-up&#96;
+ 
+ ---
+ 
+ **Legal Pages** â€” &#96;/privacy&#96;, &#96;/terms&#96;, &#96;/cookies&#96;
+ 
+ - Privacy policy (GDPR compliance, data handling, cookies)
+ - Terms of service (legal requirements, liability limitations, subscription terms)
+ - Cookie policy (GDPR compliance, tracking disclosure)
+ - Standard legal content with Trust Blue theme styling
+ - Footer links on all public pages
+ 
+ ---
+ 
+ ### Authentication Flow
+ 
+ **Login** (&#96;/auth/login&#96;) â€” (Frontend + Backend)
+ - Render email/password input fields (Frontend)
+ - Show "Remember me" checkbox (Frontend)
+ - Display "Forgot password?" link â†’ &#96;/auth/forgot-password&#96; (Frontend)
+ - Show OAuth options: Google, Facebook (Phase 2) (Frontend + Backend OAuth flow)
+ - Handle login submission â†’ verify credentials â†’ create session â†’ redirect to &#96;/dashboard&#96; (Backend)
+ - Display validation errors inline (Frontend)
+ - Apply Trust Blue theme to buttons and focus states (Frontend)
+ 
+ **Sign Up** (&#96;/auth/sign-up&#96;) â€” (Frontend + Backend)
+ - Render email, password, confirm password fields (Frontend)
+ - Show password strength indicator (Frontend)
+ - Display terms acceptance checkbox with links to &#96;/privacy&#96;, &#96;/terms&#96; (Frontend)
+ - Handle sign-up submission â†’ create user account â†’ send verification email â†’ redirect to &#96;/auth/sign-up-success&#96; (Backend)
+ - Set default tier to "Free" (Backend)
+ - Create welcome email job â†’ queue background task (Background Job)
+ - Display validation errors inline (Frontend)
+ 
+ **Forgot Password** (&#96;/auth/forgot-password&#96;) â€” (Frontend + Backend)
+ - Render email input field (Frontend)
+ - Handle submission â†’ generate password reset token â†’ send reset email (Backend)
+ - Show success message: "Check your email for reset link" (Frontend)
+ - Queue password reset email (Background Job)
+ 
+ **Sign Up Success** (&#96;/auth/sign-up-success&#96;) â€” (Frontend)
+ - Display confirmation message: "Welcome! Check your email to verify your account" (Frontend)
+ - Show "Continue to Dashboard" button â†’ &#96;/dashboard&#96; (Frontend)
+ - Display "Resend verification email" link (Frontend + Backend)
+ 
+ ---
+ 
+ ## âš¡ Core Application Pages (User-Facing)
+ 
+ ### Mission Dashboard (&#96;/dashboard&#96; - Homepage for authenticated users)
+ 
+ **Header Section** (Frontend + Backend)
+ - Display welcome message: "Welcome back, [User Name]" (Backend â†’ fetch user data)
+ - Show overall readiness score badge: Large circular progress (0-100) with Trust Blue fill (Frontend + Backend)
+ - Render "Create New Plan" hero CTA button (Frontend)
+ 
+ **Saved Plans Grid** (Frontend + Backend)
+ - Fetch all mission reports for current user (Backend query)
+ - Display plan cards in responsive grid (1 col mobile, 2 col tablet, 3 col desktop, 4 col wide)
+ - Show per card:
+   - Plan name/title (editable inline)
+   - Scenario badges (colored pills for Natural Disaster, EMP, etc.)
+   - Readiness score (small circular progress)
+   - Last updated timestamp
+   - Quick actions: View, Edit, Delete, Share (tier-gated)
+ - Render empty state for new users: "Create your first plan to get started" (Frontend)
+ 
+ **Free Tier Save Limit** (Frontend + Backend)
+ - Show plan count badge: "1/1 Plans Saved" when at limit (Frontend)
+ - Display upgrade prompt modal when attempting to save 2nd plan: "Upgrade to Basic to save unlimited plans" (Frontend)
+ - Track save attempts and enforce limit (Backend)
+ 
+ **Plan Card Actions** (Frontend + Backend)
+ - **View:** Navigate to &#96;/plans/[planId]&#96; (Frontend routing)
+ - **Edit:** Navigate to &#96;/plans/[planId]/edit&#96; (Frontend routing)
+ - **Delete:** Show confirmation modal â†’ delete plan from database â†’ refresh grid (Frontend + Backend)
+ - **Share (Basic+):** Open share modal with email/link options â†’ generate shareable link â†’ send invites (Frontend + Backend)
+ - **Share (Free):** Show upgrade prompt: "Upgrade to Basic to share with 5 people" (Frontend)
+ 
+ **Readiness Summary Widget** (Frontend + Backend)
+ - Fetch aggregated readiness data across all plans (Backend)
+ - Display scenario breakdown: Visual bars showing readiness per scenario (Frontend)
+ - Show top gaps: "3 critical items missing from water supply" (Frontend + Backend analysis)
+ - Render "Improve Readiness" CTA â†’ &#96;/readiness&#96; (Frontend)
+ 
+ ---
+ 
+ ### Plan Generator (&#96;/plans/new&#96; - Multi-step wizard)
+ 
+ **Step 1: Scenario Selection** (Frontend)
+ - Display all 6 scenarios as selectable cards with icons:
+   - Natural Disaster (hurricane, earthquake, flood)
+   - EMP/Grid Down
+   - Pandemic
+   - Nuclear Event
+   - Civil Unrest
+   - Multi-Year Sustainability
+ - Allow multiple scenario selection (checkboxes, Trust Blue when selected) (Frontend)
+ - Show scenario descriptions on hover/tap (Frontend)
+ - Validate at least 1 scenario selected (Frontend)
+ - Render "Next Step" button â†’ Step 2 (Frontend)
+ 
+ **Step 2: Personnel Configuration** (Frontend)
+ - Display "Add Family Member" button (Frontend)
+ - Show form fields per person:
+   - Name (optional, defaults to "Person 1")
+   - Age (dropdown or number input)
+   - Gender (dropdown: Male, Female, Prefer not to say)
+   - Medical conditions (multi-select: Diabetes, Heart condition, Mobility issues, Allergies, None)
+   - Special needs (text area for details)
+ - Allow add/remove family members dynamically (Frontend)
+ - Show visual count: "Planning for 4 people" (Frontend)
+ - Validate at least 1 person configured (Frontend)
+ - Render "Next Step" button â†’ Step 3 (Frontend)
+ 
+ **Step 3: Location &amp; Context** (Frontend + Backend)
+ - Render location input with autocomplete (Google Places API) (Frontend + Backend)
+ - Show detected location button: "Use Current Location" (Frontend geolocation API)
+ - Display location-specific context questions:
+   - Home type (House, Apartment, Rural property)
+   - Climate zone (auto-detected from location, editable)
+   - Existing preparedness level (None, Basic 72-hr kit, Intermediate, Advanced)
+   - Budget tier (Tight budget, Moderate, Premium - no shame)
+ - Validate location entered (Frontend)
+ - Render "Generate Plan" button â†’ Step 4 (Frontend)
+ 
+ **Step 4: AI Generation Progress** (Frontend + Backend + Background Job)
+ - Show loading animation with Trust Blue accent (Frontend)
+ - Display progress messages:
+   - "Analyzing your scenarios..."
+   - "Calculating supply quantities for 4 people..."
+   - "Generating location-specific strategies..."
+   - "Matching bundles to your needs..."
+ - Trigger AI generation job (Backend â†’ Gemini API)
+   - Generate survival plan narrative
+   - Calculate supply items with quantities
+   - Perform semantic matching for bundles (Backend â†’ vector search)
+   - Calculate readiness score
+   - Generate evacuation routes
+   - Create simulation logs
+   - Fetch skills training resources
+ - Poll for completion status (Frontend â†’ Backend API)
+ - On completion: Save mission report to database â†’ redirect to &#96;/plans/[newPlanId]&#96; (Backend + Frontend)
+ 
+ ---
+ 
+ ### Plan Details (&#96;/plans/[planId]&#96;)
+ 
+ **Plan Overview Section** (Frontend + Backend)
+ - Fetch mission report data (Backend query)
+ - Display plan name (editable inline) (Frontend + Backend update)
+ - Show scenario badges (colored pills) (Frontend)
+ - Render readiness score: Large circular progress with Trust Blue (Frontend)
+ - Display last updated timestamp (Frontend)
+ - Show action buttons: Edit, Share, Delete, Download PDF (Phase 2) (Frontend)
+ 
+ **Quick Stats Cards** (Frontend + Backend)
+ - Display metric cards (4 cards responsive grid):
+   - Total items needed (count)
+   - Total estimated cost (sum)
+   - Items owned (count from inventory)
+   - Days of supplies (calculated based on items)
+ - Use Trust Blue accents for icons (Frontend)
+ 
+ **Recommended Bundles Section** (Frontend + Backend)
+ - Fetch AI-recommended bundles for this plan's scenarios (Backend â†’ bundle matching algorithm)
+ - Display "Top Bundles for Your Plan" heading (Frontend)
+ - Render bundle cards in grid (3-5 bundles):
+   - Bundle image
+   - Bundle name
+   - Price
+   - Item count
+   - Scenario match badges
+   - Star rating (future: user ratings)
+   - "View Details" button â†’ &#96;/bundles/[bundleId]&#96; (Frontend)
+ - Show "See All Bundles" link â†’ &#96;/bundles?planId=[planId]&#96; (Frontend)
+ 
+ **Tabs Navigation** (Frontend)
+ - Render tab bar: Overview (active) | Map &amp; Routes | Simulation | Skills | Contacts (Frontend)
+ - Switch active tab on click (Frontend state)
+ 
+ **Tab: Overview (Active by Default)** (Frontend)
+ - Display AI-generated survival plan narrative (formatted text with headings) (Frontend)
+ - Show critical priorities list (bullet points with Trust Blue checkmarks) (Frontend)
+ - Render "Next Steps" action items (Frontend)
+ 
+ **Tab: Map &amp; Routes** (Frontend + Backend)
+ - Render interactive map (Google Maps or Mapbox) (Frontend)
+ - Display recommended evacuation routes (Backend â†’ generated waypoints)
+ - Show waypoints with descriptions (Frontend markers)
+ - Allow custom waypoint editing (Pro tier): Add/edit/delete waypoints (Frontend + Backend)
+ - Show custom waypoint upgrade prompt for Free/Basic tiers (Frontend)
+ 
+ **Tab: Simulation** (Frontend + Backend)
+ - Fetch day-by-day simulation logs (Backend query)
+ - Display timeline view with expandable days (Frontend)
+ - Show per day:
+   - Day number and title (e.g., "Day 1: Immediate Response")
+   - Narrative description
+   - Key actions required
+   - Supplies used
+   - Skills needed (highlighted)
+ - Render as scrollable timeline with Trust Blue accents (Frontend)
+ 
+ **Tab: Skills** (Frontend + Backend)
+ - Fetch skills training resources (Backend query â†’ YouTube API, curated articles)
+ - Display skills organized by category:
+   - First Aid &amp; Medical
+   - Water Purification
+   - Shelter Building
+   - Food Preparation
+   - Communication
+   - Self-Defense
+   - Fire Starting
+ - Show per resource:
+   - Title
+   - Type icon (Video, Article, PDF)
+   - Duration/length
+   - Difficulty level
+   - "View Resource" button (opens in modal or new tab)
+ - Render as filterable grid (Frontend)
+ 
+ **Tab: Contacts (Phase 1 Enhancement)** (Frontend + Backend)
+ - Display "Emergency Contact Protocol" form (Frontend)
+ - Show input fields:
+   - Primary contacts (name, phone, relationship)
+   - Out-of-state coordinator (FEMA recommendation)
+   - Meeting locations (primary, secondary)
+   - Communication schedule
+ - Save contacts to mission report (Backend update)
+ - Render saved contacts as editable list (Frontend + Backend)
+ 
+ ---
+ 
+ ### Bundle Browse &amp; Recommendations (&#96;/bundles&#96;)
+ 
+ **Filter Sidebar** (Frontend + Backend)
+ - Display filter options (collapsed on mobile, persistent on desktop):
+   - Scenarios (checkboxes for 6 scenarios)
+   - Budget Tier (Tight, Moderate, Premium)
+   - Duration (72-hour, 1-week, 1-month, Multi-year)
+   - Family Size (1-2, 3-4, 5+)
+   - Use Case (Bug-out, Shelter-in-place, Vehicle kit)
+ - Apply filters â†’ re-fetch bundles (Backend query with filters)
+ - Show active filter count badge (Frontend)
+ - Render "Clear All Filters" button (Frontend)
+ 
+ **Bundle Grid** (Frontend + Backend)
+ - Fetch bundles based on active filters or plan context (Backend â†’ AI matching algorithm)
+ - Display bundle cards in responsive grid (1 col mobile, 2 col tablet, 3 col desktop, 4 col wide):
+   - Bundle image
+   - Bundle name
+   - Price (large, prominent)
+   - Original price (if discounted, strikethrough)
+   - Item count
+   - Scenario badges
+   - Use case tags
+   - Star rating (Phase 2: user reviews)
+   - "View Details" button â†’ &#96;/bundles/[bundleId]&#96; (Frontend)
+ - Show sort options dropdown: Relevance, Price (low-high), Price (high-low), Most Items (Frontend + Backend)
+ - Render pagination controls (Frontend + Backend)
+ 
+ **Empty State** (Frontend)
+ - Display when no bundles match filters: "No bundles found. Try adjusting your filters." (Frontend)
+ - Show "View All Bundles" button to reset filters (Frontend)
+ 
+ ---
+ 
+ ### Bundle Details (&#96;/bundles/[bundleId]&#96;)
+ 
+ **Bundle Hero Section** (Frontend + Backend)
+ - Fetch bundle data with master items and default products (Backend query)
+ - Display bundle image gallery (main image + thumbnails) (Frontend)
+ - Show bundle name (large heading) (Frontend)
+ - Render price (prominent, Trust Blue accent) (Frontend)
+ - Display scenario badges and use case tags (Frontend)
+ - Show item count: "Contains 24 essential items" (Frontend)
+ - Render action buttons:
+   - "Customize This Bundle" â†’ customization mode (Frontend)
+   - "Mark as Purchased" â†’ update inventory (Frontend + Backend)
+   - "Add to Wishlist" â†’ save for later (Frontend + Backend)
+ 
+ **Bundle Description** (Frontend)
+ - Display admin-curated description (formatted text) (Frontend)
+ - Show "Why This Bundle" section explaining rationale (Frontend)
+ - Render "Best For" scenarios/use cases (Frontend)
+ 
+ **Master Items List** (Frontend + Backend)
+ - Display all master items in bundle as expandable cards:
+   - Master item name (e.g., "Water Filter")
+   - Quantity needed (e.g., "2 filters")
+   - Category (e.g., "Water Supply")
+   - Default product:
+     - Product image
+     - Product name
+     - Price
+     - Amazon affiliate link (Phase 1)
+   - Customization indicator: Locked, Swappable, Removable (based on admin rules)
+ - Show total price calculation at bottom (Frontend â†’ sum of all items)
+ - Render sticky total bar on scroll (Frontend)
+ 
+ **Customization Mode** (Frontend + Backend)
+ - Enter customization interface (toggle state) (Frontend)
+ - Show editable items with actions:
+   - **Locked items:** Display lock icon, no actions available (Frontend)
+   - **Swappable items:** Show "Swap" button â†’ modal with alternative products (Frontend)
+     - Fetch alternative products for master item (Backend query)
+     - Display alternatives with prices, images, ratings
+     - Select alternative â†’ update bundle selection â†’ recalculate price (Frontend + Backend)
+   - **Removable items:** Show "Remove" button â†’ remove from bundle â†’ recalculate price (Frontend)
+ - Display real-time price updates as user customizes (Frontend)
+ - Show savings/increase badge: "You saved $45 with your customizations" (Frontend)
+ - Render "Save Customizations" button â†’ update mission report with bundle selections (Backend)
+ 
+ **Purchase Tracking** (Frontend + Backend)
+ - Show purchase status options: Not Purchased, In Cart, Purchased, Wishlist (Frontend)
+ - Allow status change via dropdown or buttons (Frontend + Backend update)
+ - Update inventory when marked "Purchased" (Backend â†’ create inventory entries)
+ - Recalculate readiness score when items purchased (Backend)
+ - Show purchase date when marked "Purchased" (Frontend + Backend)
+ 
+ ---
+ 
+ ### Inventory Tracker (&#96;/inventory&#96;)
+ 
+ **Inventory Summary Cards** (Frontend + Backend)
+ - Fetch user inventory data across all plans (Backend query)
+ - Display metric cards (responsive grid):
+   - Total items needed (count)
+   - Items owned (count + percentage)
+   - Estimated remaining cost (sum of unpurchased items)
+   - Readiness improvement: "+15 points from last month" (Basic+ only) (Frontend + Backend)
+ - Use Trust Blue accents and progress rings (Frontend)
+ 
+ **Inventory by Category** (Frontend + Backend)
+ - Display categories as expandable sections (accordion):
+   - Water Supply
+   - Food Storage
+   - Shelter &amp; Warmth
+   - First Aid &amp; Medical
+   - Tools &amp; Equipment
+   - Communication
+   - Sanitation
+   - Security &amp; Defense
+   - Barter &amp; Trade Goods (Phase 1 feature)
+ - Show per category:
+   - Item count: "8 of 12 items owned"
+   - Visual progress bar (Trust Blue fill)
+   - Percentage complete
+ - Expand category â†’ show items list (Frontend)
+ 
+ **Item List (Per Category)** (Frontend + Backend)
+ - Display items as cards or table rows:
+   - Master item name
+   - Quantity needed
+   - Quantity owned (editable inline)
+   - Status: Owned, Needed, Ordered, Partial
+   - Purchase date (if owned)
+   - Estimated price
+   - Product link (to Amazon or bundle detail)
+   - Actions: Mark as Owned, Remove, Edit Quantity
+ - Allow bulk actions: Mark multiple as owned, export to shopping list (Frontend + Backend)
+ - Show filter/search: Filter by status, search by item name (Frontend + Backend)
+ 
+ **Spending Tracker (Basic+ Only)** (Frontend + Backend)
+ - Fetch historical inventory changes (Backend query)
+ - Display spending over time chart (line graph with Trust Blue) (Frontend)
+ - Show spending by category (pie chart) (Frontend)
+ - Render total spent badge: "$1,245 invested in preparedness" (Frontend)
+ - Show upgrade prompt for Free tier: "Track spending history with Basic ($9.99/mo)" (Frontend)
+ 
+ **Expiration Tracking (Phase 2 - Pro Only)** (Frontend + Backend)
+ - Display items with expiration dates: MREs, batteries, medications (Frontend)
+ - Show expiration warnings: "2 items expiring in next 30 days" (Frontend + Backend)
+ - Render calendar view of expirations (Frontend)
+ - Send expiration reminder emails (Background Job)
+ 
+ ---
+ 
+ ### Readiness Dashboard (&#96;/readiness&#96;)
+ 
+ **Overall Readiness Score** (Frontend + Backend)
+ - Fetch current readiness score (Backend calculation)
+ - Display large circular progress (0-100) with Trust Blue fill (Frontend)
+ - Show trend: "+8 points since last month" with up arrow (Frontend + Backend)
+ - Render score interpretation: "You're moderately prepared" (Frontend)
+ 
+ **Granular Readiness by Scenario** (Frontend + Backend)
+ - Fetch readiness breakdown per scenario (Backend calculation)
+ - Display scenario cards in grid (2 col mobile, 3 col tablet/desktop):
+   - Scenario name
+   - Circular progress (0-100)
+   - Status badge: Critical, Moderate, Good, Excellent (colored)
+   - Top gaps: "Missing water purification" (bullet list)
+   - "Improve" button â†’ recommendations modal (Frontend)
+ - Use color coding: Red (&lt;50), Yellow (50-74), Green (75-89), Trust Blue (90-100) (Frontend)
+ 
+ **Readiness Components Breakdown** (Frontend + Backend)
+ - Display component categories with scores:
+   - Supplies &amp; Equipment (weighted by scenario priorities)
+   - Skills &amp; Knowledge (based on training resources accessed)
+   - Planning &amp; Documentation (mission reports saved, contacts added)
+   - Network &amp; Support (sharing enabled, contacts added)
+ - Show per component:
+   - Score out of 100
+   - Progress bar (Trust Blue)
+   - Missing items count
+   - "Take Action" button â†’ specific page (supplies â†’ inventory, skills â†’ training)
+ - Render as expandable cards (Frontend)
+ 
+ **Actionable Next Steps** (Frontend + Backend)
+ - Fetch AI-generated recommendations to improve readiness (Backend analysis)
+ - Display prioritized action items (max 5-7):
+   - Action description: "Add 2 water filters to reach 2-week supply"
+   - Impact: "+12 points to readiness score"
+   - Effort: Low, Medium, High
+   - Recommended bundles or items to purchase
+   - "Complete" button (Frontend + Backend)
+ - Order by impact vs effort (quick wins first) (Frontend)
+ - Show Trust Blue checkmarks for completed actions (Frontend)
+ 
+ **Readiness Analytics (Basic+ Only)** (Frontend + Backend)
+ - Fetch historical readiness data (Backend query)
+ - Display readiness over time chart (line graph with Trust Blue) (Frontend)
+ - Show milestone timeline: "First plan created", "50% readiness achieved" (Frontend)
+ - Render category trends: Which categories improved most (Frontend)
+ - Show upgrade prompt for Free tier: "Track progress over time with Basic" (Frontend)
+ 
+ ---
+ 
+ ### Maps &amp; Routes (&#96;/maps&#96; or within &#96;/plans/[planId]&#96; tab)
+ 
+ **Interactive Map** (Frontend + Backend)
+ - Render map centered on user's location (Frontend â†’ Google Maps / Mapbox)
+ - Display recommended evacuation routes (Backend â†’ generated from AI plan)
+ - Show waypoints with markers:
+   - Start point (home)
+   - Safe destinations
+   - Resource locations (water sources, hospitals, supply stores)
+   - Hazard zones (flood plains, high-crime areas)
+ - Allow zoom, pan, satellite view toggle (Frontend)
+ 
+ **Route Details Panel** (Frontend + Backend)
+ - Display route information:
+   - Route name: "Primary Evacuation Route"
+   - Distance and estimated travel time
+   - Mode: Driving, Walking, Biking
+   - Waypoint list (ordered)
+   - Special instructions per waypoint
+ - Show "Print Route" button â†’ printable PDF (Phase 2) (Frontend + Backend)
+ 
+ **Custom Waypoints (Pro Tier)** (Frontend + Backend)
+ - Allow adding custom waypoints: Click map â†’ add marker â†’ enter details (Frontend + Backend)
+ - Enable editing existing waypoints: Drag to reposition, edit details (Frontend + Backend)
+ - Allow deleting waypoints (Frontend + Backend)
+ - Save custom routes to mission report (Backend)
+ - Show upgrade prompt for Free/Basic tiers: "Customize routes with Pro" (Frontend)
+ 
+ **Offline Map Download (Phase 2 - Pro Tier)** (Frontend + Background Job)
+ - Show "Download for Offline Use" button (Frontend)
+ - Generate map tiles and route data (Background Job)
+ - Save to PWA cache for offline access (Frontend service worker)
+ 
+ ---
+ 
+ ### Survival Simulation (&#96;/simulation&#96; or within &#96;/plans/[planId]&#96; tab)
+ 
+ **Timeline View** (Frontend + Backend)
+ - Fetch simulation logs (Backend query â†’ AI-generated)
+ - Display day-by-day timeline (vertical scrollable):
+   - Day number (large, Trust Blue)
+   - Day title: "Day 1: Immediate Response"
+   - Narrative description (formatted text)
+   - Key actions required (bullet list)
+   - Supplies used (item list with quantities)
+   - Skills needed (highlighted with badges)
+   - Challenges faced (potential problems)
+   - Success conditions (what good looks like)
+ - Expand/collapse days (accordion style) (Frontend)
+ - Use Trust Blue progress line connecting days (Frontend)
+ 
+ **Simulation Controls** (Frontend)
+ - Show "Restart Simulation" button (reload data) (Frontend)
+ - Render "Take Notes" text area per day (Frontend + Backend save)
+ - Display "Share Simulation" button (Basic+ only) (Frontend)
+ 
+ **Interactive Simulation (Phase 3)** (Frontend + Backend + AI)
+ - Display decision points: "Day 3: Do you evacuate or shelter in place?"
+ - Show choices as buttons (Frontend)
+ - Process choice â†’ generate branching outcomes (Backend â†’ Gemini API)
+ - Update simulation narrative based on choices (Frontend + Backend)
+ - Track simulation history per user (Backend)
+ 
+ ---
+ 
+ ### Skills Training (&#96;/skills&#96;)
+ 
+ **Skills Overview** (Frontend + Backend)
+ - Display skill assessment summary:
+   - Total skills in library (count)
+   - Skills you've started (count from user progress)
+   - Completion percentage
+   - Recommended priority skills (AI-suggested based on plan)
+ - Use Trust Blue accents for progress indicators (Frontend)
+ 
+ **Skills by Category** (Frontend + Backend)
+ - Fetch skills training resources (Backend query)
+ - Display category sections (expandable):
+   - First Aid &amp; Medical
+   - Water Purification &amp; Storage
+   - Shelter Building
+   - Food Preparation &amp; Preservation
+   - Communication (HAM radio, signals)
+   - Fire Starting &amp; Maintenance
+   - Navigation &amp; Wayfinding
+   - Self-Defense &amp; Security
+   - Bartering &amp; Trade
+   - Psychological Resilience
+ - Show per category:
+   - Skill count
+   - Your progress (percentage)
+   - Priority badge (Critical, Recommended, Optional)
+ 
+ **Resource Cards** (Frontend + Backend)
+ - Display resources as cards in grid (1 col mobile, 2 col tablet, 3 col desktop):
+   - Resource type icon (Video, Article, PDF)
+   - Title
+   - Description (truncated)
+   - Duration/length
+   - Difficulty level (Beginner, Intermediate, Advanced)
+   - Source (YouTube, blog, official guide)
+   - "View Resource" button (Frontend)
+   - Bookmark icon to save favorites (Frontend + Backend)
+ - Show progress indicator for videos: "Watched 45%" (Frontend + Backend tracking)
+ 
+ **Resource Detail Modal/Page** (Frontend + Backend)
+ - Display resource content:
+   - **Video:** Embedded YouTube player (Frontend)
+   - **Article:** External link with preview (Frontend)
+   - **PDF:** Embedded PDF viewer or download link (Frontend)
+ - Show related resources: "You might also like..." (Frontend + Backend)
+ - Allow marking complete (Frontend + Backend â†’ update user progress)
+ - Enable note-taking: "My notes on this skill" (Frontend + Backend save)
+ 
+ **Search &amp; Filter** (Frontend + Backend)
+ - Provide search bar: Search by skill name or keyword (Frontend + Backend query)
+ - Show filters: Category, Type, Difficulty, Priority (Frontend + Backend)
+ - Display search results with relevance sorting (Frontend + Backend)
+ 
+ ---
+ 
+ ### Expert Calls (&#96;/expert-calls&#96;)
+ 
+ **Upcoming Calls Section** (Frontend + Backend)
+ - Fetch scheduled calls for user's tier (Backend query)
+ - Display call cards (upcoming calls first):
+   - Call type: Founder Group Call, Expert Call (Pro), 1-on-1 Call (Pro)
+   - Date and time (with timezone)
+   - Expert name and photo (if applicable)
+   - Topic/agenda
+   - Zoom link (visible 30 min before call)
+   - "Add to Calendar" button (Frontend â†’ generate .ics file)
+   - Attendee count (for group calls)
+ - Show empty state for Free tier: "Upgrade to Basic for monthly founder calls" (Frontend)
+ 
+ **Call History** (Frontend + Backend)
+ - Fetch past calls user attended (Backend query)
+ - Display past call cards:
+   - Call details (type, date, expert)
+   - Recording link (if available) (Frontend)
+   - Notes section: "My takeaways" (Frontend + Backend save)
+   - Related resources shared during call (Frontend)
+ - Show "Recorded Webinar Library" section (Pro only) (Frontend + Backend)
+ 
+ **Schedule 1-on-1 (Pro Tier)** (Frontend + Backend)
+ - Display available 1-on-1 slots (Pro tier quarterly quota) (Frontend + Backend)
+ - Show quota usage: "1 of 4 quarterly calls used" (Frontend)
+ - Render calendar picker for available time slots (Frontend + Backend â†’ founder availability)
+ - Allow scheduling call â†’ send confirmation email â†’ add to calendars (Backend + Background Job)
+ - Show upgrade prompt for Basic tier: "Get quarterly 1-on-1 calls with Pro" (Frontend)
+ 
+ **Pay-Per-Call (Free Tier)** (Frontend + Backend)
+ - Display pay-per-call option: "$150 for 60-minute founder call" (Frontend)
+ - Show "Book Paid Call" button â†’ Stripe checkout (Frontend + Backend)
+ - Process payment â†’ schedule call â†’ send confirmation (Backend + Background Job)
+ 
+ **Call Reminders** (Background Job)
+ - Send email reminder 24 hours before call (Background Job)
+ - Send email reminder 30 minutes before call with Zoom link (Background Job)
+ 
+ ---
+ 
+ ### Profile &amp; Settings (&#96;/profile&#96;)
+ 
+ **Profile Tab** (Frontend + Backend)
+ - Fetch user data (Backend query)
+ - Display editable profile fields:
+   - Full name
+   - Email (with verification status)
+   - Location (city/region)
+   - Phone number (optional)
+   - Timezone (auto-detected, editable)
+   - Profile photo upload (Phase 2) (Frontend + Backend)
+ - Show "Save Changes" button (Frontend + Backend update)
+ - Display validation errors inline (Frontend)
+ 
+ **Subscription Tab** (Frontend + Backend)
+ - Fetch subscription data (Backend query â†’ Stripe API)
+ - Display current plan card:
+   - Tier name (Free, Basic, Pro)
+   - Price and billing cycle
+   - Next billing date (if paid tier)
+   - Payment method (last 4 digits of card)
+   - "Manage Payment Method" link â†’ Stripe customer portal (Frontend + Backend)
+ - Show plan comparison table (Frontend)
+ - Render upgrade/downgrade buttons:
+   - Free â†’ "Upgrade to Basic" or "Upgrade to Pro" (Frontend + Backend â†’ Stripe checkout)
+   - Basic â†’ "Upgrade to Pro" or "Downgrade to Free" (Frontend + Backend â†’ Stripe API)
+   - Pro â†’ "Downgrade to Basic" or "Cancel Subscription" (Frontend + Backend â†’ Stripe API)
+ - Display cancellation policy and prorated refunds info (Frontend)
+ 
+ **Usage Tab** (Frontend + Backend)
+ - Fetch usage data (Backend query)
+ - Display usage metrics:
+   - Plans created (count, tier limit)
+   - Plans shared (count, tier limit)
+   - Storage used (MB, Phase 2 when relevant)
+   - Calls attended (count)
+   - Expert calls quota (Pro tier: 4/year)
+ - Show usage charts over time (Basic+ only) (Frontend)
+ - Render tier-specific limits with upgrade prompts (Frontend)
+ 
+ **Billing History Tab** (Frontend + Backend)
+ - Fetch invoices (Backend query â†’ Stripe API)
+ - Display invoice table:
+   - Date
+   - Description (subscription renewal, upgrade, etc.)
+   - Amount
+   - Status (Paid, Failed, Pending)
+   - Download PDF link â†’ Stripe-hosted invoice (Frontend)
+ - Show upcoming invoice preview (if available) (Frontend)
+ 
+ **Notification Preferences Tab** (Frontend + Backend)
+ - Display notification toggles:
+   - **Email Notifications:**
+     - Weekly newsletter (on by default)
+     - Scenario-specific email series (Basic+)
+     - Bundle highlight emails
+     - Call reminders
+     - Expiration alerts (Pro, Phase 2)
+     - Platform updates and new features
+   - **Push Notifications (Phase 2 - PWA):**
+     - Threat alerts (Pro)
+     - Readiness milestones
+     - Shared plan updates
+ - Save preferences (Frontend + Backend update)
+ 
+ **Account Settings Tab** (Frontend + Backend)
+ - Show "Change Password" button â†’ password change modal (Frontend + Backend)
+ - Display "Delete Account" button â†’ confirmation modal with warnings (Frontend + Backend)
+   - Warn about data loss (all plans, inventory, history)
+   - Require password confirmation
+   - Cancel active subscription (if any)
+   - Queue account deletion job (Background Job â†’ delete after 30-day grace period)
+ - Show "Export My Data" button (GDPR compliance) â†’ download JSON (Frontend + Backend)
+ 
+ ---
+ 
+ ## ğŸ‘‘ Admin Section Pages
+ 
+ ### Admin Dashboard (&#96;/admin&#96;)
+ 
+ **Platform Overview** (Frontend + Backend)
+ - Display metric cards (responsive grid):
+   - Total users (count)
+   - Active users (last 30 days)
+   - MRR (Monthly Recurring Revenue)
+   - New signups this month
+   - Plans created this month
+   - Bundles purchased this month
+   - Conversion rate (Free â†’ Paid)
+ - Show charts (Trust Blue accents):
+   - User growth over time (line chart)
+   - Revenue trend (line chart)
+   - Tier distribution (pie chart)
+   - Top scenarios selected (bar chart)
+ 
+ **Quick Actions** (Frontend)
+ - Large buttons for common tasks:
+   - "Create New Bundle" â†’ &#96;/admin/bundles&#96;
+   - "Add Product" â†’ &#96;/admin/products&#96;
+   - "Send Email Campaign" â†’ &#96;/admin/email/new&#96;
+   - "Schedule Call" â†’ &#96;/admin/calls&#96;
+   - "View User Analytics" â†’ &#96;/admin/users&#96;
+ 
+ **Recent Activity Feed** (Frontend + Backend)
+ - Show last 20 platform activities:
+   - New user signups
+   - Plan subscriptions upgraded
+   - Bundles purchased
+   - Plans created
+   - Admin actions (bundle created, email sent)
+ - Real-time updates (optional: WebSocket or polling)
+ 
+ ---
+ 
+ ### Bundle Manager (&#96;/admin/bundles&#96;)
+ 
+ **Bundle List View** (Frontend + Backend)
+ - Fetch all bundles (Backend query)
+ - Display bundles table (Desktop) or cards (Mobile):
+   - Bundle name
+   - Image thumbnail
+   - Price
+   - Item count
+   - Scenarios (badges)
+   - Status: Active, Draft, Archived
+   - Last updated date
+   - Quick actions: Edit, Preview, Duplicate, Archive
+ - Show "Create New Bundle" button â†’ bundle editor (Frontend)
+ - Enable search and filters: By scenario, status, price range (Frontend + Backend)
+ - Use Trust Blue accents for active bundles (Frontend)
+ 
+ **Bundle Editor** (Frontend + Backend)
+ - Display bundle form in sections:
+ 
+ **Section 1: Basic Information**
+ - Bundle name (text input)
+ - Description (rich text editor)
+ - Price (number input with $ prefix)
+ - Hero image upload (Frontend + Backend storage)
+ - Status: Draft or Active (dropdown)
+ 
+ **Section 2: Tagging for AI Matching**
+ - Scenario tags (multi-select checkboxes: Natural Disaster, EMP, etc.)
+ - Use case tags (multi-select: Bug-out, Shelter-in-place, Vehicle kit, etc.)
+ - Budget tier (select: Tight, Moderate, Premium)
+ - Duration tags (multi-select: 72-hour, 1-week, 1-month, Multi-year)
+ - Family size tags (multi-select: 1-2, 3-4, 5+)
+ 
+ **Section 3: Master Items** (Frontend + Backend)
+ - Display "Add Master Item" button â†’ item selector modal (Frontend)
+ - Show added items list (sortable, drag-to-reorder):
+   - Master item name
+   - Category
+   - Quantity (editable)
+   - Default product selection (dropdown, fetch from product catalog)
+   - Customization rules per item:
+     - **Locked:** User cannot modify (checkbox)
+     - **Swappable:** User can choose alternatives (checkbox + define alternative products)
+     - **Removable:** User can remove from bundle (checkbox)
+   - Actions: Edit, Remove
+ - Calculate and display total price (sum of default products) (Frontend)
+ 
+ **Section 4: Alternative Products** (Frontend + Backend)
+ - Show section for items marked "Swappable"
+ - Per swappable item, display "Add Alternative" button (Frontend)
+ - Allow selecting alternative products from catalog (Frontend + Backend query)
+ - Display alternatives list with:
+   - Product name
+   - Price
+   - Price difference from default (Â± $X)
+   - Remove button
+ 
+ **Section 5: Preview** (Frontend)
+ - Render bundle preview as users would see it:
+   - Default view (all items with defaults)
+   - Customization view (with swap/remove options visible)
+ - Toggle between preview modes (Frontend)
+ 
+ **Save &amp; Publish** (Frontend + Backend)
+ - Show "Save as Draft" button â†’ save without activating (Backend)
+ - Show "Publish Bundle" button â†’ save and set status to Active (Backend)
+ - Display success message with link to preview (Frontend)
+ - Validate required fields before save (Frontend)
+ 
+ ---
+ 
+ ### Product Catalog (&#96;/admin/products&#96;)
+ 
+ **Tab 1: Master Items** (Frontend + Backend)
+ 
+ **Items Table/Grid** (Responsive)
+ - Fetch all master items (Backend query)
+ - Display items table (Desktop wide: split view, Desktop: table, Mobile: cards):
+   - Item name
+   - Category
+   - Default product
+   - Vendor
+   - Avg price
+   - Used in bundles (count)
+   - Actions: Edit, Delete
+ - Show "Add Master Item" button â†’ item editor (Frontend)
+ - Enable search: By item name, category (Frontend + Backend)
+ - Enable bulk actions: Delete selected, Change category (Frontend + Backend)
+ - Use Trust Blue for active selection states (Frontend)
+ 
+ **Item Editor (Modal or Split Panel on Wide)** (Frontend + Backend)
+ - Display item form:
+   - Master item name (text input)
+   - Category (dropdown, fetch from categories)
+   - Description (text area)
+   - Default product (dropdown, fetch from products)
+   - Vendor (dropdown, fetch from vendors)
+   - Tags (multi-select: Essential, Optional, Specialized)
+   - Image upload (Frontend + Backend storage)
+ - Show "Save" and "Cancel" buttons (Frontend + Backend)
+ - Validate required fields (Frontend)
+ 
+ ---
+ 
+ **Tab 2: Categories** (Frontend + Backend)
+ 
+ **Category Tree View** (Frontend + Backend)
+ - Fetch categories with hierarchy (Backend query)
+ - Display category tree (expandable):
+   - Category name
+   - Parent category (if nested)
+   - Item count
+   - Icon/emoji
+   - Actions: Edit, Delete, Add Subcategory
+ - Enable drag-and-drop reordering (Frontend + Backend)
+ - Show "Add Category" button â†’ category editor (Frontend)
+ - Use Trust Blue for active category (Frontend)
+ 
+ **Category Editor (Inline or Modal)** (Frontend + Backend)
+ - Display category form:
+   - Category name (text input)
+   - Parent category (dropdown for nesting, optional)
+   - Description (text area)
+   - Icon/emoji picker (Frontend)
+   - Sort order (number input)
+ - Show "Save" and "Cancel" buttons (Frontend + Backend)
+ - Prevent deletion if category has items (validate) (Frontend + Backend)
+ 
+ ---
+ 
+ **Tab 3: Analytics** (Frontend + Backend)
+ 
+ **Product Performance Dashboard** (Frontend + Backend)
+ - Fetch product analytics (Backend query)
+ - Display metrics (responsive grid):
+   - Total products in catalog (count)
+   - Total master items (count)
+   - Avg price per category
+   - Most used items in bundles (top 10 list)
+   - Least used items (candidates for removal)
+ - Show top-selling products table:
+   - Product name
+   - Category
+   - Times recommended
+   - Times purchased (when tracking available)
+   - Revenue generated (Phase 2)
+ - Render charts (Trust Blue accents):
+   - Products by category (pie chart)
+   - Price distribution (histogram)
+   - Bundle usage over time (line chart)
+ 
+ ---
+ 
+ ### Vendor Management (&#96;/admin/suppliers&#96;)
+ 
+ **Vendor List** (Frontend + Backend)
+ - Fetch all vendors (Backend query)
+ - Display vendors table (Desktop) or cards (Mobile):
+   - Vendor name
+   - Contact person
+   - Email
+   - Phone
+   - Products supplied (count)
+   - Payment terms (Net 30, Net 60, etc.)
+   - Status: Active, Inactive
+   - Actions: Edit, View Products, Archive
+ - Show "Add Vendor" button â†’ vendor editor (Frontend)
+ - Enable search: By vendor name, contact (Frontend + Backend)
+ - Use Trust Blue for active vendors (Frontend)
+ 
+ **Vendor Editor** (Frontend + Backend)
+ - Display vendor form:
+   - Vendor name (text input)
+   - Contact person name (text input)
+   - Email (email input)
+   - Phone (phone input with formatting)
+   - Address (text area)
+   - Website (URL input)
+   - Payment terms (dropdown: Net 30, Net 60, COD, etc.)
+   - Commission structure (percentage input, Phase 2)
+   - Notes (text area)
+   - Status: Active or Inactive (toggle)
+ - Show "Save" and "Cancel" buttons (Frontend + Backend)
+ - Validate required fields (Frontend)
+ 
+ **Vendor Products View** (Frontend + Backend)
+ - Fetch products associated with vendor (Backend query)
+ - Display products list:
+   - Product name
+   - Category
+   - Price
+   - Used in bundles (count)
+   - Link to product in catalog
+ - Show "Associate Product" button â†’ product selector (Frontend + Backend)
+ - Enable removing product associations (Frontend + Backend)
+ 
+ **Vendor Performance (Phase 2)** (Frontend + Backend)
+ - Display vendor analytics:
+   - Total products supplied
+   - Total revenue generated
+   - Average product rating
+   - Fulfillment rate
+   - Payment history
+ - Render performance charts (Frontend)
+ 
+ ---
+ 
+ ### User Analytics (&#96;/admin/users&#96;)
+ 
+ **User Overview Dashboard** (Frontend + Backend)
+ - Fetch user statistics (Backend query)
+ - Display metric cards (responsive grid):
+   - Total users (count)
+   - Free tier (count + percentage)
+   - Basic tier (count + percentage)
+   - Pro tier (count + percentage)
+   - MRR (Monthly Recurring Revenue) (calculated sum)
+   - Churn rate (percentage, Phase 2)
+   - New signups this month (count)
+ - Use Trust Blue for progress bars and highlights (Frontend)
+ 
+ **User List** (Frontend + Backend)
+ - Fetch users with pagination (Backend query)
+ - Display users table (Desktop) or cards (Mobile):
+   - Name
+   - Email
+   - Tier (badge with color coding: gray=Free, blue=Basic, purple=Pro)
+   - Subscription status (Active, Canceled, Past Due)
+   - Signup date
+   - Last active date
+   - Total plans created (count)
+   - Total spent (sum, Phase 2)
+   - Actions: View Details, Flag, Send Email
+ - Enable search: By name, email (Frontend + Backend)
+ - Enable filters: By tier, status, signup date range (Frontend + Backend)
+ - Show bulk action: "Send Email to Selected" (Frontend)
+ 
+ **User Detail View** (&#96;/admin/users/[userId]&#96;) (Frontend + Backend)
+ - Fetch user details (Backend query)
+ - Display user profile:
+   - Personal info (name, email, location, signup date)
+   - Subscription details (tier, billing cycle, next payment)
+   - Usage stats (plans created, bundles purchased, calls attended)
+   - Activity timeline (recent actions)
+   - Notes (admin-only notes, text area) (Frontend + Backend save)
+ - Show action buttons:
+   - "Flag as High-Value" (Pro tier users for outreach) (Frontend + Backend)
+   - "Send Email" â†’ email composer (Frontend)
+   - "View Plans" â†’ user's mission reports (Frontend)
+   - "Upgrade/Downgrade Tier" (admin override, Phase 2) (Frontend + Backend)
+ 
+ **Tier Conversion Funnel** (Frontend + Backend)
+ - Fetch conversion data (Backend query)
+ - Display funnel visualization:
+   - Signups â†’ Free tier active users â†’ Basic upgrades â†’ Pro upgrades
+   - Conversion rates per stage
+   - Drop-off points highlighted
+ - Use Trust Blue for funnel stages (Frontend)
+ 
+ ---
+ 
+ ### Email Tools (&#96;/admin/email&#96;)
+ 
+ **Email Campaigns List** (Frontend + Backend)
+ - Fetch past email campaigns (Backend query)
+ - Display campaigns table:
+   - Campaign name
+   - Sent date
+   - Recipients (count)
+   - Open rate (percentage)
+   - Click rate (percentage)
+   - Status: Sent, Scheduled, Draft
+   - Actions: View, Duplicate, Archive
+ - Show "Create Email Campaign" button â†’ email composer (Frontend)
+ 
+ **Email Composer - AI-Driven Customization** (&#96;/admin/email/new&#96;) (Frontend + Backend + AI)
+ 
+ **Section 1: Recipients**
+ - Select target segment (dropdown):
+   - All users
+   - Free tier only
+   - Basic tier only
+   - Pro tier only
+   - High-value flagged users
+   - Custom segment (filter builder)
+ - Show recipient count preview (Frontend + Backend query)
+ 
+ **Section 2: Email Content**
+ - Subject line (text input)
+ - Preview text (text input)
+ - Email body (rich text editor with drag-and-drop fields):
+   - **User Data Fields (Draggable Tokens):**
+     - {{user_name}}
+     - {{user_tier}}
+     - {{readiness_score}}
+     - {{plans_created}}
+     - {{top_scenario}} (most selected scenario)
+     - {{missing_items_count}}
+     - {{days_since_signup}}
+   - Drag tokens into email body â†’ will be replaced per user (Frontend)
+ 
+ **Section 3: AI Customization Prompt** â­ UNIQUE FEATURE
+ - Display AI prompt text area (Frontend)
+ - Admin writes prompt: "For each user, recommend 2 bundles that match their top scenarios and budget tier. Explain why each bundle fits their specific needs." (Frontend)
+ - Show "Preview AI Output" button â†’ generate sample for 3 random users (Frontend + Backend â†’ Gemini API)
+ - Display sample outputs in preview panel (Frontend)
+ - Adjust prompt based on preview results (Frontend)
+ 
+ **Section 4: Send Options**
+ - Schedule: Send now or schedule for later (datetime picker) (Frontend)
+ - Test send: Enter test email addresses (Frontend + Backend)
+ - Show "Send Test" button (Frontend + Backend)
+ - Show "Send Campaign" button (Frontend + Backend â†’ queue bulk email job)
+ 
+ **Email Sending (Background Job)**
+ - Process recipients in batches (Background Job)
+ - For each user:
+   - Replace {{tokens}} with user data (Backend)
+   - If AI customization enabled: Call Gemini API with prompt + user context â†’ generate personalized content section (Backend)
+   - Send email via email service (SendGrid, AWS SES, etc.) (Backend)
+   - Track send status (Backend)
+ - Update campaign status and metrics (Backend)
+ 
+ **Campaign Analytics** (Frontend + Backend)
+ - Display campaign performance:
+   - Total sent (count)
+   - Delivered (count)
+   - Bounced (count)
+   - Opened (count + rate)
+   - Clicked (count + rate)
+   - Unsubscribed (count)
+   - Conversions (upgrades attributed to campaign, Phase 2)
+ - Show email client breakdown (Gmail, Outlook, Apple Mail, etc.)
+ - Render charts (Trust Blue accents) (Frontend)
+ 
+ ---
+ 
+ ### Call Scheduling (&#96;/admin/calls&#96;)
+ 
+ **Call Types Overview** (Frontend + Backend)
+ - Display call type cards:
+   - **Founder Group Calls (Basic Tier)**
+     - Monthly frequency
+     - Avg attendees per call
+     - Next scheduled date
+     - "Schedule New Call" button
+   - **Expert Group Calls (Pro Tier)**
+     - Monthly frequency
+     - Rotating experts
+     - Next scheduled date + expert name
+     - "Schedule New Call" button
+   - **1-on-1 Calls (Pro Tier)**
+     - Quarterly quota per user
+     - Upcoming 1-on-1s count
+     - "View Schedule" button
+ 
+ **Schedule Founder Group Call** (Frontend + Backend)
+ - Display call form:
+   - Call date and time (datetime picker with timezone)
+   - Topic/agenda (text input)
+   - Duration (dropdown: 30, 60, 90 minutes)
+   - Zoom link (auto-generated or manual input)
+   - Max attendees (number input, optional)
+   - Description (text area)
+ - Show "Save &amp; Send Invites" button (Frontend + Backend)
+ - Queue email invitations to all Basic+ users (Background Job)
+ - Add call to calendar (Backend â†’ generate .ics file)
+ 
+ **Schedule Expert Group Call** (Frontend + Backend)
+ - Display call form (similar to founder call)
+ - Additional fields:
+   - Expert name (text input)
+   - Expert photo upload (Frontend + Backend)
+   - Expert bio (text area)
+   - Topic specialty (dropdown: Medical, HAM Radio, Tactics, Psychology, etc.)
+ - Show "Save &amp; Send Invites" button (Frontend + Backend)
+ - Queue email invitations to all Pro users (Background Job)
+ 
+ **1-on-1 Call Management** (Frontend + Backend)
+ - Fetch upcoming 1-on-1 calls (Backend query)
+ - Display calendar view:
+   - User name
+   - Call date and time
+   - Zoom link
+   - User's tier (should be Pro)
+   - User's question/topic (if provided)
+   - Actions: Reschedule, Cancel
+ - Show "Set Availability" button â†’ availability calendar editor (Frontend + Backend)
+ - Admin blocks out available time slots (recurring or one-time) (Frontend + Backend)
+ - Pro users see available slots when scheduling (Frontend)
+ 
+ **Call History** (Frontend + Backend)
+ - Fetch past calls (Backend query)
+ - Display calls list:
+   - Call type
+   - Date
+   - Attendee count
+   - Recording link (if available)
+   - Notes (admin notes, text area)
+   - Feedback summary (Phase 2: from attendee surveys)
+ - Enable filtering by type, date range (Frontend + Backend)
+ 
+ **Call Reminders (Background Job)**
+ - Send reminder emails 24 hours before call (Background Job)
+ - Send reminder emails 30 minutes before call with Zoom link (Background Job)
+ - Update call status after completion (Background Job)
+ 
+ ---
+ 
+ ## ğŸ”§ Backend Architecture &amp; System Functions
+ 
+ ### API Endpoints (External Communication Only)
+ 
+ **&#96;/api/webhooks/stripe/route.ts&#96;** (Backend)
+ - Handle Stripe webhook events:
+   - &#96;checkout.session.completed&#96; â†’ Upgrade user tier, send welcome email
+   - &#96;invoice.payment_succeeded&#96; â†’ Renew subscription, update next billing date
+   - &#96;invoice.payment_failed&#96; â†’ Send dunning email, flag subscription at risk
+   - &#96;customer.subscription.deleted&#96; â†’ Downgrade user to Free tier, send cancellation confirmation
+ - Verify webhook signature (Backend)
+ - Process event â†’ update database â†’ queue follow-up jobs (Backend + Background Job)
+ 
+ **&#96;/api/webhooks/email/route.ts&#96;** (Backend - Phase 2)
+ - Handle email service webhooks (SendGrid, AWS SES):
+   - Email delivered, opened, clicked, bounced, unsubscribed
+ - Update campaign metrics in database (Backend)
+ 
+ **&#96;/api/amazon/product/route.ts&#96;** (Backend - Existing)
+ - Amazon Product API lookup (existing functionality)
+ - Preserve existing implementation
+ 
+ **&#96;/api/search/route.ts&#96;** (Backend - Existing)
+ - Search API endpoint (existing functionality)
+ - Consider migrating to Server Action for internal use
+ 
+ ---
+ 
+ ### Server Actions (Internal App Functionality)
+ 
+ **&#96;app/actions/mission-reports.ts&#96;** (Backend)
+ - &#96;createMissionReport()&#96; â†’ Validate user tier limit â†’ Save to database â†’ Return report ID
+ - &#96;updateMissionReport()&#96; â†’ Validate ownership â†’ Update database
+ - &#96;deleteMissionReport()&#96; â†’ Validate ownership â†’ Soft delete from database
+ - &#96;shareMissionReport()&#96; â†’ Validate tier (Basic+) â†’ Generate share token â†’ Send email invites
+ 
+ **&#96;app/actions/bundles.ts&#96;** (Backend)
+ - &#96;getBundleRecommendations()&#96; â†’ Fetch user's scenarios â†’ Query AI matching algorithm â†’ Return top bundles
+ - &#96;customizeBundle()&#96; â†’ Validate customization rules â†’ Calculate new price â†’ Save to report
+ - &#96;markBundlePurchased()&#96; â†’ Update inventory â†’ Recalculate readiness score
+ 
+ **&#96;app/actions/inventory.ts&#96;** (Backend)
+ - &#96;updateInventoryItem()&#96; â†’ Validate ownership â†’ Update quantity/status â†’ Recalculate readiness
+ - &#96;getInventorySummary()&#96; â†’ Aggregate all items â†’ Calculate totals and percentages
+ 
+ **&#96;app/actions/readiness.ts&#96;** (Backend)
+ - &#96;calculateReadinessScore()&#96; â†’ Fetch mission report + inventory â†’ Apply scoring algorithm â†’ Return score
+ - &#96;getReadinessRecommendations()&#96; â†’ Analyze gaps â†’ Generate AI suggestions â†’ Return action items
+ 
+ **&#96;app/actions/subscription.ts&#96;** (Backend)
+ - &#96;createCheckoutSession()&#96; â†’ Call Stripe API â†’ Return checkout URL
+ - &#96;createCustomerPortalSession()&#96; â†’ Call Stripe API â†’ Return portal URL
+ - &#96;cancelSubscription()&#96; â†’ Call Stripe API â†’ Schedule downgrade
+ 
+ **&#96;app/actions/admin.ts&#96;** (Backend)
+ - &#96;flagUserAsHighValue()&#96; â†’ Update user record â†’ Add admin note
+ - &#96;sendBulkEmail()&#96; â†’ Validate segment â†’ Queue background job with user IDs and content
+ 
+ **&#96;app/actions/auth.ts&#96;** (Backend - Existing, may refactor)
+ - Authentication operations (preserve existing Supabase Auth)
+ 
+ **&#96;app/actions/dev.ts&#96;** (Backend - Existing)
+ - Dev/testing utilities (preserve if needed)
+ 
+ ---
+ 
+ ### Lib Queries (Database &amp; Business Logic - Drizzle ORM)
+ 
+ **&#96;lib/queries/users.ts&#96;** (Backend)
+ - &#96;getUserById()&#96; â†’ Fetch user by ID
+ - &#96;getUserByEmail()&#96; â†’ Fetch user by email
+ - &#96;updateUserTier()&#96; â†’ Update subscription tier
+ - &#96;getUsersByTier()&#96; â†’ Fetch users filtered by tier
+ 
+ **&#96;lib/queries/mission-reports.ts&#96;** (Backend)
+ - &#96;getMissionReportsByUserId()&#96; â†’ Fetch all reports for user
+ - &#96;getMissionReportById()&#96; â†’ Fetch single report with relations (bundles, scenarios)
+ - &#96;countMissionReportsByUserId()&#96; â†’ Count for tier limit enforcement
+ 
+ **&#96;lib/queries/bundles.ts&#96;** (Backend)
+ - &#96;getBundleById()&#96; â†’ Fetch bundle with master items and products
+ - &#96;getBundlesByScenarios()&#96; â†’ Filter bundles by scenario tags
+ - &#96;getBundleRecommendations()&#96; â†’ AI matching algorithm using semantic search
+ 
+ **&#96;lib/queries/products.ts&#96;** (Backend)
+ - &#96;getAllMasterItems()&#96; â†’ Fetch master item catalog
+ - &#96;getProductsByCategory()&#96; â†’ Filter products by category
+ - &#96;getAlternativeProducts()&#96; â†’ Fetch alternatives for master item
+ 
+ **&#96;lib/queries/analytics.ts&#96;** (Backend)
+ - &#96;getPlatformMetrics()&#96; â†’ Calculate MRR, user counts, churn
+ - &#96;getBundleAnalytics()&#96; â†’ Aggregate bundle impressions, selections, revenue
+ - &#96;getUserAnalytics()&#96; â†’ Fetch user activity, conversion funnel data
+ 
+ ---
+ 
+ ### Background Jobs
+ 
+ **&#96;jobs/email.ts&#96;** (Background Job)
+ - &#96;sendWelcomeEmail()&#96; â†’ Queue after signup
+ - &#96;sendWeeklyNewsletter()&#96; â†’ Cron job (weekly) â†’ Send to all opted-in users
+ - &#96;sendScenarioEmailSeries()&#96; â†’ Drip campaign after plan generation
+ - &#96;sendCallReminders()&#96; â†’ Cron job (check upcoming calls) â†’ Send reminders
+ - &#96;sendBulkAICustomizedEmail()&#96; â†’ Process batch â†’ For each user: generate AI content â†’ send email
+ 
+ **&#96;jobs/subscriptions.ts&#96;** (Background Job)
+ - &#96;processDunningEmails()&#96; â†’ Cron job (daily) â†’ Find failed payments â†’ Send reminder emails
+ - &#96;downgradeExpiredSubscriptions()&#96; â†’ Cron job (daily) â†’ Find expired subscriptions â†’ Downgrade tier
+ 
+ **&#96;jobs/readiness.ts&#96;** (Background Job)
+ - &#96;recalculateReadinessScores()&#96; â†’ Triggered after inventory update or bundle purchase
+ - &#96;sendReadinessMilestones()&#96; â†’ Trigger when user reaches 50%, 75%, 90% readiness
+ 
+ **&#96;jobs/ai.ts&#96;** (Background Job)
+ - &#96;generateMissionReport()&#96; â†’ Call Gemini API â†’ Save to database â†’ Notify user
+ - &#96;generateBundleRecommendations()&#96; â†’ Semantic matching â†’ Cache results
+ 
+ ---
+ 
+ ## ğŸ—„ï¸ Database Architecture (Drizzle ORM)
+ 
+ ### Schema Structure
+ 
+ **Drizzle Schema Organization:**
+ &#96;&#96;&#96;
+ src/db/
+ â”œâ”€â”€ index.ts                     # Drizzle client initialization
+ â”œâ”€â”€ schema/
+ â”‚   â”œâ”€â”€ index.ts                 # Export all schemas
+ â”‚   â”œâ”€â”€ users.ts                 # profiles, user_settings tables
+ â”‚   â”œâ”€â”€ products.ts              # products, master_items tables
+ â”‚   â”œâ”€â”€ bundles.ts               # bundles, bundle_items, bundle_tags tables
+ â”‚   â”œâ”€â”€ categories.ts            # categories, category_hierarchy tables
+ â”‚   â”œâ”€â”€ suppliers.ts             # suppliers, supplier_products tables
+ â”‚   â”œâ”€â”€ mission-reports.ts       # mission_reports, report_scenarios tables
+ â”‚   â”œâ”€â”€ inventory.ts             # inventory_items, inventory_history tables
+ â”‚   â”œâ”€â”€ subscriptions.ts         # subscriptions, invoices tables
+ â”‚   â”œâ”€â”€ skills.ts                # skills_training, user_progress tables
+ â”‚   â””â”€â”€ calls.ts                 # scheduled_calls, call_history tables
+ â””â”€â”€ queries/
+     â”œâ”€â”€ users.ts                 # User CRUD operations
+     â”œâ”€â”€ products.ts              # Product queries
+     â”œâ”€â”€ bundles.ts               # Bundle matching and filtering
+     â”œâ”€â”€ categories.ts            # Category tree operations
+     â”œâ”€â”€ suppliers.ts             # Supplier management
+     â”œâ”€â”€ mission-reports.ts       # Mission report CRUD
+     â”œâ”€â”€ inventory.ts             # Inventory aggregation
+     â”œâ”€â”€ subscriptions.ts         # Subscription status queries
+     â”œâ”€â”€ skills.ts                # Skills tracking queries
+     â””â”€â”€ analytics.ts             # Platform metrics
+ &#96;&#96;&#96;
+ 
+ ### Authentication Strategy
+ 
+ **Hybrid Approach:**
+ - **Supabase Auth** - Authentication, sessions, OAuth (preserve existing)
+ - **Drizzle ORM** - All data queries (profiles, products, bundles, etc.)
+ 
+ **Rationale:**
+ - Supabase Auth is battle-tested and handles complex auth flows
+ - No need to rewrite auth logic
+ - Drizzle excellent for type-safe data queries
+ - Clean separation of concerns
+ 
+ ---
+ 
+ ## ğŸ¯ MVP Functionality Summary
+ 
+ This blueprint delivers your core value proposition: **"Build complete disaster readiness plans in minutes with AI-powered survival strategies and curated bundles"**
+ 
+ ### Phase 1 (Launch Ready):
+ - Universal SaaS foundation (auth, legal, responsive design)
+ - AI plan generation with multi-scenario support (Frontend + Backend + Background Jobs)
+ - Curated bundle recommendations with customization (Frontend + Backend)
+ - Purchase tracking and inventory management (Frontend + Backend)
+ - Readiness score calculation and tracking (Frontend + Backend)
+ - Evacuation maps and survival simulations (Frontend + Backend)
+ - Skills training resource library (Frontend + Backend)
+ - Expert call scheduling (Frontend + Backend + Background Jobs)
+ - Freemium subscription system (Free/Basic/Pro) (Frontend + Backend)
+ - Stripe integration with tier-based gates (Frontend + Backend)
+ - Admin backend (bundles, products, vendors) - Preserved with Trust Blue restyling
+ - User analytics and email campaigns (Frontend + Backend)
+ - Payment provider as single source of truth with minimal webhooks
+ - Admin functions split into individual routes and navigation items
+ - Drizzle ORM for type-safe database queries
+ 
+ ### Phase 2 (Growth Features):
+ - Multi-location planning (Pro tier expansion)
+ - Offline PWA access (Pro tier expansion)
+ - Bundle expiration tracking
+ - Vendor portal and dropship model
+ - Influencer marketplace
+ - Annual physical archive
+ - Habit tracker &amp; gamification
+ - Family coordination dashboard
+ 
+ ### Phase 3 (Advanced Features):
+ - Service provider marketplace
+ - Real-time threat intelligence feed
+ - AI scenario simulation engine
+ - Advanced communication planning (HAM radio features)
+ - Vendor certification &amp; trust badges
+ 
+ ---
+ 
+ &gt; **Next Step:** Ready for wireframe design with this concrete blueprint
+ 
+ **End of App Pages &amp; Functionality Blueprint**
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
Great! I successfully saved the complete App Pages & Functionality Blueprint. Now I should provide a closing message confirming completion and readiness for wireframes.</details></think>

---

Perfect! âœ… I've saved your complete **App Pages & Functionality Blueprint** to `ai_docs/prep/app_pages_and_functionality.md`.

---

## ğŸ“‹ What You Now Have

**1. App Pages & Functionality Blueprint** (`app_pages_and_functionality.md`)
- Complete page specifications with (Frontend)/(Backend)/(Background Job) indicators
- All routes defined with proper Next.js structure
- Business model integration (Stripe, subscription tiers, feature gates)
- Admin functionality documented (preserve + restyle)
- Drizzle ORM architecture outlined

**2. Existing Files Inventory** (`existing_files_inventory.md`)
- ~90 files categorized (PRESERVE / REMOVE / EVALUATE)
- Phase 0: Drizzle ORM migration strategy (before frontend rebuild)
- Safety rules to prevent database corruption
- Cleanup commands for after new frontend is built

**3. Master Idea Document** (`master_idea.md`)
- Your complete product vision and business model
- 80 user stories across 3 phases
- Revenue projections and monetization strategy

**4. UI Theme Analysis** (`ui_theme.md`)
- Trust Blue theme selected (HSL 220, 85%, 55%)
- Complete CSS implementation with light/dark modes
- Responsive design system documented

---

## ğŸ¨ Ready for Wireframes

You now have everything needed to create wireframes:
- âœ… **Clear user journey** (overwhelmed â†’ guided â†’ prepared)
- âœ… **Defined routes** (public, auth, protected, admin)
- âœ… **Page specifications** (what goes on each page)
- âœ… **Feature functionality** (how each feature works)
- âœ… **Business model** (tier gates, upgrade flows)
- âœ… **Technical architecture** (Drizzle + Server Actions + API endpoints)
- âœ… **Trust Blue theme** (HSL values and component styling)
- âœ… **Responsive strategy** (4 breakpoints with density guidelines)

**Next step:** Create wireframes for key pages following the specifications in your blueprint. Start with the core user journey: Landing â†’ Sign Up â†’ Plan Generator â†’ Dashboard â†’ Bundle Marketplace â†’ Inventory.

Would you like me to proceed with wireframe creation, or do you have any questions about the blueprint first?

---

