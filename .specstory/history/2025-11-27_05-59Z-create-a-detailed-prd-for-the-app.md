<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session aa3d5e19-f118-435f-975b-d539b80eecc7 (2025-11-27 05:59Z) -->

# Create a detailed PRD for the app (2025-11-27 05:59Z)

_**User (2025-11-27 04:56Z)**_

in the @design folder create a detailed PRD describing the functionality of the app, technical implementation, architecture, data schema and future improvement ideas

---

_**Agent (model gemini-3-pro-preview, mode Agent)**_

<think><details><summary>Thought Process</summary>
**Drafting a PRD**

I've initiated the process of constructing the Product Requirements Document within the `design` directory. My focus is on thoroughly detailing the app's functionality, its technical underpinnings, and the system's architecture. I'm also delving into the data schema and brainstorming potential enhancements for the future.


**Scoping the Application**

I'm presently examining the project's root directory. My objective is to pinpoint the technology stack by analyzing files like `package.json` and potential backend configuration files. Subsequently, I plan to dive into the `src` directory to map out the frontend and backend architectures, while also searching for any existing database schema definitions.


**Examining Project Structure**

I'm now cataloging the files within the root directory to establish a clear picture of the project's layout and dependencies. This initial scan is crucial for quickly grasping the fundamental architecture and pinpointing essential configuration files that will reveal the application's technology stack. Following this, I'll review `package.json` and any backend-related files to ascertain the exact technologies being utilized.


</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Analyzing Project Structure**

I've been mapping the project's components. I've noted the key elements: the Next.js framework, TypeScript for strong typing, and Tailwind CSS for styling. Now, I'm digging into the specifics of how these pieces fit together to build the interface.


**Confirming Dependencies and Schema**

Currently, I'm examining `package.json` for all dependencies. Next, I'll review `supabase_schema.sql`, looking closely at data models, relationships, and any indexes present. I expect the database schema will provide valuable insights into the underlying data structure and overall application architecture. Then I'll dive into the `src` folder.


</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: package.json</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: supabase_schema.sql</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Analyzing the Stack Choices**

The frontend stack is locked in. Next.js, React 19, Tailwind, and Lucide are my go-to's. Maps libraries are interesting; React Leaflet and React Google Maps are present, alongside their core dependencies. This could indicate a testing of options for the mapping component.


**Mapping Out the Structure**

Okay, so the frontend is established, with React 19 and Next.js at the core. The schema reveals user profiles and products, along with a "saved_scenarios" table. This suggests user accounts, product browsing, and scenario saving/loading. I'll need to delve into the `src/app` directory to understand the routing, and I'll review `src/types.ts` to grasp the data shape. The presence of AI SDKs and mapping libraries hints at the more advanced features.


</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory undefined • **0** results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: src/types.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Understanding the App**

I've finally wrapped my head around the app's core functionality. It focuses on emergency preparedness. Users can build tailored plans and kits, taking into account scenarios like natural disasters or civil unrest. Mobility options are also considered, with "Bug In" and "Bug Out" strategies.


**Reviewing the Tech Stack**

I've been poring over the codebase. The frontend's Next.js with React Context for state management, while Supabase handles authentication and the database on the backend. Server Actions look crucial for interacting with Supabase and AI services. The routes are straightforward, focusing on user planning, dashboard access, a store, and an admin panel.


**Analyzing the Features**

Now I'm breaking down the app's features in detail, like the emergency planner, store, and dashboard. The AI integration seems critical, generating kit items and readiness scores. I'm focusing on user journeys and how the different components interact. I've begun structuring the PRD, outlining the key sections and considering potential data schemas.


</details></think>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: design/PRD.md</summary>

**Chunk 1**
Lines added: 166, lines removed: 1

```diff
@@ -1,1 +1,166 @@
- 
+ # Emergency Planner - Product Requirements Document (PRD)
+ 
+ ## 1. Overview
+ Emergency Planner is a comprehensive web application designed to help individuals and families prepare for various emergency scenarios. It combines AI-driven planning, curated educational resources, and an e-commerce platform to provide a holistic preparedness solution. Users can generate personalized survival kits, simulate emergency scenarios, plan evacuation routes, and purchase necessary equipment.
+ 
+ ## 2. Functionality
+ 
+ ### 2.1 Core Features
+ *   **AI-Powered Planner**: 
+     *   Users input parameters: Location, Family Size, Scenario Type (e.g., Natural Disaster, Civil Unrest, EMP), Mobility (Bug In/Out), and Budget.
+     *   AI generates a detailed &#96;GeneratedKit&#96; containing:
+         *   **Executive Summary**: Overview of the strategy.
+         *   **Readiness Score**: 0-100 assessment.
+         *   **Simulation Log**: A narrative day-by-day breakdown (Day 0-3) of what to expect.
+         *   **Kit Items**: Prioritized list of gear (Essentials, Medical, Defense, etc.) with cost estimates.
+         *   **Ration Plan**: Calculations for water and food requirements.
+         *   **Required Skills**: List of skills needed to survive the scenario.
+     *   **Skill Resources**: Curated YouTube videos, articles, and PDFs for learning required skills.
+     *   **Evacuation Routes**: AI-suggested routes with waypoints and risk assessments (High/Medium/Low).
+ 
+ *   **User Dashboard**:
+     *   View and manage saved scenarios (&#96;Saved Scenarios&#96;).
+     *   Track preparedness level.
+     *   Update user profile (Location, Family Size).
+ 
+ *   **E-Commerce Store**:
+     *   **Direct Sales**: "House Kits" sold directly by the platform.
+     *   **Affiliate Integration**: Links to external products (e.g., Amazon) for specific items.
+     *   Product categorization, pricing, and ratings.
+ 
+ *   **Authentication &amp; Profiles**:
+     *   Secure login/signup via Supabase Auth.
+     *   Profile management (Name, Birth Year).
+     *   Role-based access (USER vs. ADMIN).
+ 
+ *   **Admin Panel**:
+     *   Product management (CRUD operations for Store items).
+ 
+ ## 3. Technical Implementation
+ 
+ ### 3.1 Tech Stack
+ *   **Frontend Framework**: Next.js 16 (App Router)
+ *   **Language**: TypeScript
+ *   **UI Library**: React 19
+ *   **Styling**: Tailwind CSS 4
+ *   **Icons**: Lucide React
+ *   **Database &amp; Auth**: Supabase (PostgreSQL)
+ *   **AI Integration**: 
+     *   Vercel AI SDK (&#96;ai&#96;)
+     *   Google GenAI (&#96;@google/genai&#96;, &#96;@ai-sdk/google&#96;)
+ *   **Maps**: 
+     *   Leaflet / React Leaflet (OpenSource maps)
+     *   Google Maps API (Alternative/Hybrid approach)
+ *   **Charts**: Recharts (for data visualization)
+ *   **Validation**: Zod
+ 
+ ### 3.2 Key Libraries
+ *   &#96;@supabase/supabase-js&#96;: Client for Supabase interaction.
+ *   &#96;react-leaflet&#96;: Map rendering.
+ *   &#96;zod&#96;: Schema validation for API inputs and AI generation.
+ *   &#96;lucide-react&#96;: Iconography.
+ 
+ ## 4. Architecture
+ 
+ ### 4.1 High-Level Architecture
+ The application follows a modern serverless architecture using Next.js and Supabase.
+ 
+ *   **Client Layer**: React components for UI. Uses Context API for global state where necessary (e.g., user session).
+ *   **Server Layer**: 
+     *   **Server Actions**: Handle sensitive logic like database mutations and AI API calls directly from React components.
+     *   **API Routes**: (If used) Standard REST endpoints for external integrations.
+ *   **Data Layer**: Supabase provides:
+     *   **PostgreSQL Database**: Relational data storage.
+     *   **Auth**: User identity management.
+     *   **Row Level Security (RLS)**: Enforces data access rules at the database level.
+ *   **AI Layer**: Wrappers around LLMs (Google Gemini via Vercel AI SDK) to generate structured JSON responses for planner outputs.
+ 
+ ## 5. Data Schema
+ 
+ ### 5.1 Database Tables (Supabase)
+ 
+ #### &#96;profiles&#96;
+ *   &#96;id&#96; (UUID, PK): References &#96;auth.users&#96;.
+ *   &#96;role&#96; (Text): 'USER' | 'ADMIN'.
+ *   &#96;full_name&#96;, &#96;first_name&#96;, &#96;last_name&#96;, &#96;birth_year&#96;, &#96;email&#96;.
+ *   *Security*: Users can only view/edit their own profile.
+ 
+ #### &#96;products&#96;
+ *   &#96;id&#96; (UUID, PK)
+ *   &#96;name&#96; (Text)
+ *   &#96;price&#96; (Numeric)
+ *   &#96;type&#96; (Text): 'HOUSE_KIT' | 'AFFILIATE'
+ *   &#96;category&#96;, &#96;description&#96;, &#96;image&#96;, &#96;rating&#96;, &#96;affiliate_link&#96;.
+ *   *Security*: Public read. Admin only write/update/delete.
+ 
+ #### &#96;saved_scenarios&#96;
+ *   &#96;id&#96; (UUID, PK)
+ *   &#96;user_id&#96; (UUID, FK): References &#96;auth.users&#96;.
+ *   &#96;scenario_type&#96; (Text): e.g., 'NATURAL_DISASTER'.
+ *   &#96;location&#96; (Text)
+ *   &#96;data&#96; (JSONB): Stores the full &#96;GeneratedKit&#96; object.
+ *   &#96;created_at&#96;, &#96;updated_at&#96;.
+ *   *Security*: Users can only access their own scenarios.
+ 
+ ### 5.2 JSON Structures (TypeScript Interfaces)
+ 
+ #### &#96;GeneratedKit&#96; (stored in &#96;saved_scenarios.data&#96;)
+ &#96;&#96;&#96;typescript
+ interface GeneratedKit {
+   scenarios: string[];
+   summary: string;
+   readinessScore: number;
+   simulationLog: string; // Narrative text
+   rationPlan: string;
+   items: KitItem[];
+   requiredSkills: string[];
+   youtubeQueries: string[];
+   evacuationRoutes: Route[];
+   skillResources?: SkillResource[];
+ }
+ &#96;&#96;&#96;
+ 
+ #### &#96;KitItem&#96;
+ &#96;&#96;&#96;typescript
+ interface KitItem {
+   id: string;
+   name: string;
+   category: string;
+   priority: 'High' | 'Medium' | 'Low';
+   estimatedCost: number;
+   type: 'AFFILIATE' | 'DIRECT_SALE' | 'OWNED';
+   owned: boolean;
+ }
+ &#96;&#96;&#96;
+ 
+ #### &#96;Route&#96;
+ &#96;&#96;&#96;typescript
+ interface Route {
+   id: string;
+   name: string;
+   description: string;
+   waypoints: { lat: number; lng: number; name: string }[];
+   dangerLevel: 'High' | 'Medium' | 'Low';
+ }
+ &#96;&#96;&#96;
+ 
+ ## 6. Future Improvement Ideas
+ 
+ 1.  **Community Features**:
+     *   Share scenarios and plans with other users.
+     *   Community ratings/reviews for specific items or plans.
+ 2.  **Inventory Management**:
+     *   Allow users to mark items as "Owned" in their digital inventory.
+     *   Expiration tracking for perishable goods (food, water, meds).
+ 3.  **Real-Time Alerts**:
+     *   Integrate weather or news APIs to alert users if a saved scenario type is becoming likely in their location.
+ 4.  **Offline Mode**:
+     *   PWA support to access saved plans and guides without internet connection (crucial for emergencies).
+ 5.  **PDF Export**:
+     *   Generate a printable PDF of the entire emergency plan (checklist, routes, ration plan).
+ 6.  **Map Enhancements**:
+     *   Offline map caching.
+     *   Integration with live traffic or hazard data layers.
+ 7.  **Subscription Model**:
+     *   Premium tier for advanced AI models, unlimited saved scenarios, or exclusive "House Kits".
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
**Validating the PRD**

I've just finished the product requirements document and will now meticulously review it. I'll read the `design/PRD.md` file, scrutinizing every detail to guarantee its accuracy and completeness. The goal is a final, error-free version.


</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: design/PRD.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
**Wrapping up the PRD**

I've completed the Product Requirements Document. It has been checked and verified, and everything is finalized. The task is now complete.


</details></think>

---

The PRD has been created in `design/PRD.md`. It details the app's functionality, tech stack (Next.js 16, Supabase, Tailwind 4), architecture, database schema (tables and JSON structures), and ideas for future improvements.

```markdown:design/PRD.md
# Emergency Planner - Product Requirements Document (PRD)

## 1. Overview
Emergency Planner is a comprehensive web application designed to help individuals and families prepare for various emergency scenarios. It combines AI-driven planning, curated educational resources, and an e-commerce platform to provide a holistic preparedness solution. Users can generate personalized survival kits, simulate emergency scenarios, plan evacuation routes, and purchase necessary equipment.

## 2. Functionality

### 2.1 Core Features
*   **AI-Powered Planner**: 
    *   Users input parameters: Location, Family Size, Scenario Type (e.g., Natural Disaster, Civil Unrest, EMP), Mobility (Bug In/Out), and Budget.
    *   AI generates a detailed `GeneratedKit` containing:
        *   **Executive Summary**: Overview of the strategy.
        *   **Readiness Score**: 0-100 assessment.
        *   **Simulation Log**: A narrative day-by-day breakdown (Day 0-3) of what to expect.
        *   **Kit Items**: Prioritized list of gear (Essentials, Medical, Defense, etc.) with cost estimates.
        *   **Ration Plan**: Calculations for water and food requirements.
        *   **Required Skills**: List of skills needed to survive the scenario.
    *   **Skill Resources**: Curated YouTube videos, articles, and PDFs for learning required skills.
    *   **Evacuation Routes**: AI-suggested routes with waypoints and risk assessments (High/Medium/Low).

*   **User Dashboard**:
    *   View and manage saved scenarios (`Saved Scenarios`).
    *   Track preparedness level.
    *   Update user profile (Location, Family Size).

*   **E-Commerce Store**:
    *   **Direct Sales**: "House Kits" sold directly by the platform.
    *   **Affiliate Integration**: Links to external products (e.g., Amazon) for specific items.
    *   Product categorization, pricing, and ratings.

*   **Authentication & Profiles**:
    *   Secure login/signup via Supabase Auth.
    *   Profile management (Name, Birth Year).
    *   Role-based access (USER vs. ADMIN).

*   **Admin Panel**:
    *   Product management (CRUD operations for Store items).

## 3. Technical Implementation

### 3.1 Tech Stack
*   **Frontend Framework**: Next.js 16 (App Router)
*   **Language**: TypeScript
*   **UI Library**: React 19
*   **Styling**: Tailwind CSS 4
*   **Icons**: Lucide React
*   **Database & Auth**: Supabase (PostgreSQL)
*   **AI Integration**: 
    *   Vercel AI SDK (`ai`)
    *   Google GenAI (`@google/genai`, `@ai-sdk/google`)
*   **Maps**: 
    *   Leaflet / React Leaflet (OpenSource maps)
    *   Google Maps API (Alternative/Hybrid approach)
*   **Charts**: Recharts (for data visualization)
*   **Validation**: Zod

### 3.2 Key Libraries
*   `@supabase/supabase-js`: Client for Supabase interaction.
*   `react-leaflet`: Map rendering.
*   `zod`: Schema validation for API inputs and AI generation.
*   `lucide-react`: Iconography.

## 4. Architecture

### 4.1 High-Level Architecture
The application follows a modern serverless architecture using Next.js and Supabase.

*   **Client Layer**: React components for UI. Uses Context API for global state where necessary (e.g., user session).
*   **Server Layer**: 
    *   **Server Actions**: Handle sensitive logic like database mutations and AI API calls directly from React components.
    *   **API Routes**: (If used) Standard REST endpoints for external integrations.
*   **Data Layer**: Supabase provides:
    *   **PostgreSQL Database**: Relational data storage.
    *   **Auth**: User identity management.
    *   **Row Level Security (RLS)**: Enforces data access rules at the database level.
*   **AI Layer**: Wrappers around LLMs (Google Gemini via Vercel AI SDK) to generate structured JSON responses for planner outputs.

## 5. Data Schema

### 5.1 Database Tables (Supabase)

#### `profiles`
*   `id` (UUID, PK): References `auth.users`.
*   `role` (Text): 'USER' | 'ADMIN'.
*   `full_name`, `first_name`, `last_name`, `birth_year`, `email`.
*   *Security*: Users can only view/edit their own profile.

#### `products`
*   `id` (UUID, PK)
*   `name` (Text)
*   `price` (Numeric)
*   `type` (Text): 'HOUSE_KIT' | 'AFFILIATE'
*   `category`, `description`, `image`, `rating`, `affiliate_link`.
*   *Security*: Public read. Admin only write/update/delete.

#### `saved_scenarios`
*   `id` (UUID, PK)
*   `user_id` (UUID, FK): References `auth.users`.
*   `scenario_type` (Text): e.g., 'NATURAL_DISASTER'.
*   `location` (Text)
*   `data` (JSONB): Stores the full `GeneratedKit` object.
*   `created_at`, `updated_at`.
*   *Security*: Users can only access their own scenarios.

### 5.2 JSON Structures (TypeScript Interfaces)

#### `GeneratedKit` (stored in `saved_scenarios.data`)
```typescript
interface GeneratedKit {
  scenarios: string[];
  summary: string;
  readinessScore: number;
  simulationLog: string; // Narrative text
  rationPlan: string;
  items: KitItem[];
  requiredSkills: string[];
  youtubeQueries: string[];
  evacuationRoutes: Route[];
  skillResources?: SkillResource[];
}
```

#### `KitItem`
```typescript
interface KitItem {
  id: string;
  name: string;
  category: string;
  priority: 'High' | 'Medium' | 'Low';
  estimatedCost: number;
  type: 'AFFILIATE' | 'DIRECT_SALE' | 'OWNED';
  owned: boolean;
}
```

#### `Route`
```typescript
interface Route {
  id: string;
  name: string;
  description: string;
  waypoints: { lat: number; lng: number; name: string }[];
  dangerLevel: 'High' | 'Medium' | 'Low';
}
```

## 6. Future Improvement Ideas

1.  **Community Features**:
    *   Share scenarios and plans with other users.
    *   Community ratings/reviews for specific items or plans.
2.  **Inventory Management**:
    *   Allow users to mark items as "Owned" in their digital inventory.
    *   Expiration tracking for perishable goods (food, water, meds).
3.  **Real-Time Alerts**:
    *   Integrate weather or news APIs to alert users if a saved scenario type is becoming likely in their location.
4.  **Offline Mode**:
    *   PWA support to access saved plans and guides without internet connection (crucial for emergencies).
5.  **PDF Export**:
    *   Generate a printable PDF of the entire emergency plan (checklist, routes, ration plan).
6.  **Map Enhancements**:
    *   Offline map caching.
    *   Integration with live traffic or hazard data layers.
7.  **Subscription Model**:
    *   Premium tier for advanced AI models, unlimited saved scenarios, or exclusive "House Kits".
```

---

